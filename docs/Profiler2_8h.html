<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Pyrogenesis: /home/sathyam/0ad.svn/source/ps/Profiler2.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Pyrogenesis
   &#160;<span id="projectnumber">13997</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_b2f33c71d4aa5e7af42a1ca61ff5af1b.html">source</a></li><li class="navelem"><a class="el" href="dir_0dc38aac9085a57339423d7e064a603d.html">ps</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">Profiler2.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>New profiler (complementing the older <a class="el" href="classCProfileManager.html">CProfileManager</a>)  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="timer_8h_source.html">lib/timer.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ThreadUtil_8h_source.html">ps/ThreadUtil.h</a>&quot;</code><br/>
</div>
<p><a href="Profiler2_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCProfiler2.html">CProfiler2</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCProfiler2_1_1SItem__dt__id.html">CProfiler2::SItem_dt_id</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">An item with a relative time and an ID string pointer.  <a href="structCProfiler2_1_1SItem__dt__id.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCProfiler2_1_1ThreadStorage.html">CProfiler2::ThreadStorage</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Class instantiated in every registered thread.  <a href="classCProfiler2_1_1ThreadStorage.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCProfile2Region.html">CProfile2Region</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scope-based enter/leave helper.  <a href="classCProfile2Region.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCProfile2GPURegion.html">CProfile2GPURegion</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scope-based GPU enter/leave helper.  <a href="classCProfile2GPURegion.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aad9cc95812b7e1cd7e346f7e45a143a3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Profiler2_8h.html#aad9cc95812b7e1cd7e346f7e45a143a3">PROFILE2</a>(region)&#160;&#160;&#160;<a class="el" href="classCProfile2Region.html">CProfile2Region</a> profile2__(region)</td></tr>
<tr class="memdesc:aad9cc95812b7e1cd7e346f7e45a143a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Starts timing from now until the end of the current scope.  <a href="#aad9cc95812b7e1cd7e346f7e45a143a3">More...</a><br/></td></tr>
<tr class="separator:aad9cc95812b7e1cd7e346f7e45a143a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab485203d3e0dc3d7c12651ba3778a4e1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Profiler2_8h.html#ab485203d3e0dc3d7c12651ba3778a4e1">PROFILE2_GPU</a>(region)&#160;&#160;&#160;<a class="el" href="classCProfile2GPURegion.html">CProfile2GPURegion</a> profile2gpu__(region)</td></tr>
<tr class="separator:ab485203d3e0dc3d7c12651ba3778a4e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae834c4ce62c8629ec0c30b4149a3df83"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Profiler2_8h.html#ae834c4ce62c8629ec0c30b4149a3df83">PROFILE2_EVENT</a>(name)&#160;&#160;&#160;g_Profiler2.RecordEvent(name)</td></tr>
<tr class="memdesc:ae834c4ce62c8629ec0c30b4149a3df83"><td class="mdescLeft">&#160;</td><td class="mdescRight">Record the named event at the current time.  <a href="#ae834c4ce62c8629ec0c30b4149a3df83">More...</a><br/></td></tr>
<tr class="separator:ae834c4ce62c8629ec0c30b4149a3df83"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa38479cd10b003eafe5cc9f40e49060"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Profiler2_8h.html#afa38479cd10b003eafe5cc9f40e49060">PROFILE2_ATTR</a>&#160;&#160;&#160;g_Profiler2.RecordAttribute</td></tr>
<tr class="memdesc:afa38479cd10b003eafe5cc9f40e49060"><td class="mdescLeft">&#160;</td><td class="mdescRight">Associates a string (with printf-style formatting) with the current region or event.  <a href="#afa38479cd10b003eafe5cc9f40e49060">More...</a><br/></td></tr>
<tr class="separator:afa38479cd10b003eafe5cc9f40e49060"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ad273b714dbdb8280d9cfae7c72d38398"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classCProfiler2.html">CProfiler2</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Profiler2_8h.html#ad273b714dbdb8280d9cfae7c72d38398">g_Profiler2</a></td></tr>
<tr class="separator:ad273b714dbdb8280d9cfae7c72d38398"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>New profiler (complementing the older <a class="el" href="classCProfileManager.html">CProfileManager</a>) </p>
<p>The profiler is designed for analysing framerate fluctuations or glitches, and temporal relationships between threads. This contrasts with CProfilerManager and most external profiling tools, which are designed more for measuring average throughput over a number of frames.</p>
<p>To view the profiler output, press F11 to enable the HTTP output mode and then open source/tools/profiler2/profiler2.html in a web browser.</p>
<p>There is a single global <a class="el" href="classCProfiler2.html">CProfiler2</a> instance (g_Profiler2), providing the API used by the rest of the game. The game can record the entry/exit timings of a region of code using the PROFILE2 macro, and can record other events using PROFILE2_EVENT. Regions and events can be annotated with arbitrary string attributes, specified with printf-style format strings, using PROFILE2_ATTR (e.g. PROFILE2_ATTR("frame: %d", m_FrameNum) ).</p>
<p>This is designed for relatively coarse-grained profiling, or for rare events. Don't use it for regions that are typically less than ~0.1msecs, or that are called hundreds of times per frame. (The old CProfilerManager is better for that.)</p>
<p>New threads must call g_Profiler2.RegisterCurrentThread before any other profiler functions.</p>
<p>The main thread should call g_Profiler2.RecordFrameStart at the start of each frame. Other threads should call g_Profiler2.RecordSyncMarker occasionally, especially if it's been a long time since their last call to the profiler, or if they've made thousands of calls since the last sync marker.</p>
<p>The profiler is implemented with thread-local fixed-size ring buffers, which store a sequence of variable-length items indicating the time of the event and associated data (pointers to names, attribute strings, etc). An HTTP server provides access to the data: when requested, it will make a copy of a thread's buffer, then parse the items and return them in JSON format. The profiler2.html requests and processes and visualises this data.</p>
<p>The RecordSyncMarker calls are necessary to correct for time drift and to let the buffer parser accurately detect the start of an item in the byte stream.</p>
<p>This design aims to minimise the performance overhead of recording data, and to simplify the visualisation of the data by doing it externally in an environment with better UI tools (i.e. HTML) instead of within the game engine.</p>
<p>The initial setup of g_Profiler2 must happen in the game's main thread. RegisterCurrentThread and the Record functions may be called from any thread. The HTTP server runs its own threads, which may call the ConstructJSON functions. </p>

<p>Definition in file <a class="el" href="Profiler2_8h_source.html">Profiler2.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="aad9cc95812b7e1cd7e346f7e45a143a3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PROFILE2</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">region</td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="classCProfile2Region.html">CProfile2Region</a> profile2__(region)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Starts timing from now until the end of the current scope. </p>
<p><code>region</code> is the name to associate with this region (should be a constant string literal; the pointer must remain valid forever). Regions may be nested, but preferably shouldn't be nested deeply since it hurts the visualisation. </p>

<p>Definition at line <a class="el" href="Profiler2_8h_source.html#l00446">446</a> of file <a class="el" href="Profiler2_8h_source.html">Profiler2.h</a>.</p>

</div>
</div>
<a class="anchor" id="afa38479cd10b003eafe5cc9f40e49060"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PROFILE2_ATTR&#160;&#160;&#160;g_Profiler2.RecordAttribute</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Associates a string (with printf-style formatting) with the current region or event. </p>
<p>(If the last profiler call was PROFILE2_EVENT, it associates with that event; otherwise it associates with the currently-active region.) </p>

<p>Definition at line <a class="el" href="Profiler2_8h_source.html#l00461">461</a> of file <a class="el" href="Profiler2_8h_source.html">Profiler2.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae834c4ce62c8629ec0c30b4149a3df83"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PROFILE2_EVENT</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">name</td><td>)</td>
          <td>&#160;&#160;&#160;g_Profiler2.RecordEvent(name)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Record the named event at the current time. </p>

<p>Definition at line <a class="el" href="Profiler2_8h_source.html#l00453">453</a> of file <a class="el" href="Profiler2_8h_source.html">Profiler2.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab485203d3e0dc3d7c12651ba3778a4e1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PROFILE2_GPU</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">region</td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="classCProfile2GPURegion.html">CProfile2GPURegion</a> profile2gpu__(region)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Profiler2_8h_source.html#l00448">448</a> of file <a class="el" href="Profiler2_8h_source.html">Profiler2.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="ad273b714dbdb8280d9cfae7c72d38398"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classCProfiler2.html">CProfiler2</a> g_Profiler2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Profiler2_8cpp_source.html#l00035">35</a> of file <a class="el" href="Profiler2_8cpp_source.html">Profiler2.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Oct 14 2013 00:58:10 for Pyrogenesis by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
