<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Pyrogenesis: /home/sathyam/0ad.svn/source/simulation2/components/CCmpUnitMotion.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Pyrogenesis
   &#160;<span id="projectnumber">13997</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_b2f33c71d4aa5e7af42a1ca61ff5af1b.html">source</a></li><li class="navelem"><a class="el" href="dir_9f1354e9bfde473978bd916a06200973.html">simulation2</a></li><li class="navelem"><a class="el" href="dir_1d614d6cd62ee91a565feed8a30f6de5.html">components</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">CCmpUnitMotion.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="CCmpUnitMotion_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* Copyright (C) 2012 Wildfire Games.</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * This file is part of 0 A.D.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * 0 A.D. is free software: you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * the Free Software Foundation, either version 2 of the License, or</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * (at your option) any later version.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * 0 A.D. is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * GNU General Public License for more details.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * along with 0 A.D.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;precompiled.h&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Component_8h.html">simulation2/system/Component.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ICmpUnitMotion_8h.html">ICmpUnitMotion.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ICmpObstruction_8h.html">simulation2/components/ICmpObstruction.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ICmpObstructionManager_8h.html">simulation2/components/ICmpObstructionManager.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ICmpOwnership_8h.html">simulation2/components/ICmpOwnership.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ICmpPosition_8h.html">simulation2/components/ICmpPosition.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ICmpPathfinder_8h.html">simulation2/components/ICmpPathfinder.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ICmpRangeManager_8h.html">simulation2/components/ICmpRangeManager.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Geometry_8h.html">simulation2/helpers/Geometry.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Render_8h.html">simulation2/helpers/Render.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MessageTypes_8h.html">simulation2/MessageTypes.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SerializeTemplates_8h.html">simulation2/serialization/SerializeTemplates.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="graphics_2Overlay_8h.html">graphics/Overlay.h</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Terrain_8h.html">graphics/Terrain.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="FixedVector2D_8h.html">maths/FixedVector2D.h</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CLogger_8h.html">ps/CLogger.h</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Profile_8h.html">ps/Profile.h</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Scene_8h.html">renderer/Scene.h</a>&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"> * When advancing along the long path, and picking a new waypoint to move</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"> * towards, we&#39;ll pick one that&#39;s up to this far from the unit&#39;s current</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"> * position (to minimise the effects of grid-constrained movement)</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="CCmpUnitMotion_8cpp.html#a848861e02cf85f5856b3a072072be671">   46</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classCFixed.html">entity_pos_t</a> <a class="code" href="CCmpUnitMotion_8cpp.html#a848861e02cf85f5856b3a072072be671">WAYPOINT_ADVANCE_MAX</a> = <a class="code" href="classCFixed.html#a504183a15db764dc9e5416f7f4916037">entity_pos_t::FromInt</a>(<a class="code" href="Terrain_8h.html#afa474c073f2fd8de9f0aace0d023d026">TERRAIN_TILE_SIZE</a>*8);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment"> * When advancing along the long path, we&#39;ll pick a new waypoint to move</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"> * towards if we expect to reach the end of our current short path within</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"> * this many turns (assuming constant speed and turn length).</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment"> * (This could typically be 1, but we need some tolerance in case speeds</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment"> * or turn lengths change.)</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="CCmpUnitMotion_8cpp.html#a580d143b9834c15fce9789b2f0dcc531">   55</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="CCmpUnitMotion_8cpp.html#a580d143b9834c15fce9789b2f0dcc531">WAYPOINT_ADVANCE_LOOKAHEAD_TURNS</a> = 4;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment"> * Maximum range to restrict short path queries to. (Larger ranges are slower,</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"> * smaller ranges might miss some legitimate routes around large obstacles.)</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="CCmpUnitMotion_8cpp.html#a988a5848b0f3521a55aec39e7ccec426">   61</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classCFixed.html">entity_pos_t</a> <a class="code" href="CCmpUnitMotion_8cpp.html#a988a5848b0f3521a55aec39e7ccec426">SHORT_PATH_SEARCH_RANGE</a> = <a class="code" href="classCFixed.html#a504183a15db764dc9e5416f7f4916037">entity_pos_t::FromInt</a>(<a class="code" href="Terrain_8h.html#afa474c073f2fd8de9f0aace0d023d026">TERRAIN_TILE_SIZE</a>*10);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment"> * When short-pathing to an intermediate waypoint, we aim for a circle of this radius</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment"> * around the waypoint rather than expecting to reach precisely the waypoint itself</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment"> * (since it might be inside an obstacle).</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="CCmpUnitMotion_8cpp.html#ae4b3ad47946affd837ef8db3a308a4ea">   68</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classCFixed.html">entity_pos_t</a> <a class="code" href="CCmpUnitMotion_8cpp.html#ae4b3ad47946affd837ef8db3a308a4ea">SHORT_PATH_GOAL_RADIUS</a> = <a class="code" href="classCFixed.html#a504183a15db764dc9e5416f7f4916037">entity_pos_t::FromInt</a>(<a class="code" href="Terrain_8h.html#afa474c073f2fd8de9f0aace0d023d026">TERRAIN_TILE_SIZE</a>*3/2);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment"> * If we are this close to our target entity/point, then think about heading</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment"> * for it in a straight line instead of pathfinding.</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="CCmpUnitMotion_8cpp.html#aca59310c919f89103b78623ffa11d3b0">   74</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classCFixed.html">entity_pos_t</a> <a class="code" href="CCmpUnitMotion_8cpp.html#aca59310c919f89103b78623ffa11d3b0">DIRECT_PATH_RANGE</a> = <a class="code" href="classCFixed.html#a504183a15db764dc9e5416f7f4916037">entity_pos_t::FromInt</a>(<a class="code" href="Terrain_8h.html#afa474c073f2fd8de9f0aace0d023d026">TERRAIN_TILE_SIZE</a>*4);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment"> * If we&#39;re following a target entity,</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"> * we will recompute our path if the target has moved</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"> * more than this distance from where we last pathed to.</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="CCmpUnitMotion_8cpp.html#acc7728eae8f21e4c3332c532aef7c3b6">   81</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classCFixed.html">entity_pos_t</a> <a class="code" href="CCmpUnitMotion_8cpp.html#acc7728eae8f21e4c3332c532aef7c3b6">CHECK_TARGET_MOVEMENT_MIN_DELTA</a> = <a class="code" href="classCFixed.html#a504183a15db764dc9e5416f7f4916037">entity_pos_t::FromInt</a>(<a class="code" href="Terrain_8h.html#afa474c073f2fd8de9f0aace0d023d026">TERRAIN_TILE_SIZE</a>*4);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"> * If we&#39;re following as part of a formation,</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"> * but can&#39;t move to our assigned target point in a straight line,</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"> * we will recompute our path if the target has moved</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment"> * more than this distance from where we last pathed to.</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="CCmpUnitMotion_8cpp.html#acf4138fa5566aed8028505f3734d6d26">   89</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classCFixed.html">entity_pos_t</a> <a class="code" href="CCmpUnitMotion_8cpp.html#acf4138fa5566aed8028505f3734d6d26">CHECK_TARGET_MOVEMENT_MIN_DELTA_FORMATION</a> = <a class="code" href="classCFixed.html#a504183a15db764dc9e5416f7f4916037">entity_pos_t::FromInt</a>(<a class="code" href="Terrain_8h.html#afa474c073f2fd8de9f0aace0d023d026">TERRAIN_TILE_SIZE</a>*1);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment"> * If we&#39;re following something but it&#39;s more than this distance away along</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment"> * our path, then don&#39;t bother trying to repath regardless of how much it has</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"> * moved, until we get this close to the end of our old path.</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="CCmpUnitMotion_8cpp.html#a0a1358d5dc22275d15595e9315b76b1e">   96</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classCFixed.html">entity_pos_t</a> <a class="code" href="CCmpUnitMotion_8cpp.html#a0a1358d5dc22275d15595e9315b76b1e">CHECK_TARGET_MOVEMENT_AT_MAX_DIST</a> = <a class="code" href="classCFixed.html#a504183a15db764dc9e5416f7f4916037">entity_pos_t::FromInt</a>(<a class="code" href="Terrain_8h.html#afa474c073f2fd8de9f0aace0d023d026">TERRAIN_TILE_SIZE</a>*16);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structCColor.html">CColor</a> <a class="code" href="CCmpUnitMotion_8cpp.html#a5a1d29d82321920b3d9d216f12662e3f">OVERLAY_COLOUR_LONG_PATH</a>(1, 1, 1, 1);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structCColor.html">CColor</a> <a class="code" href="CCmpUnitMotion_8cpp.html#ae834109294e10f1dfb96d13ce8d164de">OVERLAY_COLOUR_SHORT_PATH</a>(1, 0, 0, 1);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="CCmpUnitMotion_8cpp.html#ab2c6620256cf5c2e37cf150b2a4f8063">  101</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classCFixed.html">entity_pos_t</a> <a class="code" href="CCmpUnitMotion_8cpp.html#ab2c6620256cf5c2e37cf150b2a4f8063">g_GoalDelta</a> = <a class="code" href="classCFixed.html#a504183a15db764dc9e5416f7f4916037">entity_pos_t::FromInt</a>(<a class="code" href="Terrain_8h.html#afa474c073f2fd8de9f0aace0d023d026">TERRAIN_TILE_SIZE</a>)/4; <span class="comment">// for extending the goal outwards/inwards a little bit</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html">  103</a></span>&#160;<span class="keyword">class </span><a class="code" href="classCCmpUnitMotion.html">CCmpUnitMotion</a> : <span class="keyword">public</span> <a class="code" href="classICmpUnitMotion.html">ICmpUnitMotion</a></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;{</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a49f1a918829acfe2163cdf30d7a873bd">  106</a></span>&#160;    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a49f1a918829acfe2163cdf30d7a873bd">ClassInit</a>(<a class="code" href="classCComponentManager.html">CComponentManager</a>&amp; componentManager)</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        componentManager.<a class="code" href="classCComponentManager.html#abfcc0c9a12e231dbe538783cad1cc63d">SubscribeToMessageType</a>(<a class="code" href="Components_8h.html#aeed5f0d6bf70b510e5eb09522ea8fb6fa273df3edd94f150c5586e56c696023da">MT_Update_MotionFormation</a>);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        componentManager.<a class="code" href="classCComponentManager.html#abfcc0c9a12e231dbe538783cad1cc63d">SubscribeToMessageType</a>(<a class="code" href="Components_8h.html#aeed5f0d6bf70b510e5eb09522ea8fb6faf51beea244290e2655654c92646b88e2">MT_Update_MotionUnit</a>);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        componentManager.<a class="code" href="classCComponentManager.html#abfcc0c9a12e231dbe538783cad1cc63d">SubscribeToMessageType</a>(<a class="code" href="Components_8h.html#aeed5f0d6bf70b510e5eb09522ea8fb6fadcd319267a030b23b69294967f29731c">MT_RenderSubmit</a>); <span class="comment">// for debug overlays</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        componentManager.<a class="code" href="classCComponentManager.html#abfcc0c9a12e231dbe538783cad1cc63d">SubscribeToMessageType</a>(<a class="code" href="Components_8h.html#aeed5f0d6bf70b510e5eb09522ea8fb6faacb54dda3f3589bfb5be5c8c5e49c46a">MT_PathResult</a>);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    }</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a443385b4878688cfa9f4ce404ce526e7">  114</a></span>&#160;    <a class="code" href="Component_8h.html#a802718af26c925716144a7eb72441e6f">DEFAULT_COMPONENT_ALLOCATOR</a>(UnitMotion)</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a81ec5b62fa9271f89491dec73690062a">  116</a></span>&#160;    bool <a class="code" href="classCCmpUnitMotion.html#a81ec5b62fa9271f89491dec73690062a">m_DebugOverlayEnabled</a>;</div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a882244efda407ab44364464359187860">  117</a></span>&#160;    std::vector&lt;<a class="code" href="structSOverlayLine.html">SOverlayLine</a>&gt; <a class="code" href="classCCmpUnitMotion.html#a882244efda407ab44364464359187860">m_DebugOverlayLongPathLines</a>;</div>
<div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a80b08f69fe05b1bd23b48934c6b76774">  118</a></span>&#160;    std::vector&lt;<a class="code" href="structSOverlayLine.html">SOverlayLine</a>&gt; <a class="code" href="classCCmpUnitMotion.html#a80b08f69fe05b1bd23b48934c6b76774">m_DebugOverlayShortPathLines</a>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">// Template state:</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a6553c525ac36ba2cf3b5af7a28aae61a">  122</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#a6553c525ac36ba2cf3b5af7a28aae61a">m_FormationController</a>;</div>
<div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a758b9abd0782f12aba62d4b3b91c06eb">  123</a></span>&#160;    <a class="code" href="classCFixed.html">fixed</a> <a class="code" href="classCCmpUnitMotion.html#a758b9abd0782f12aba62d4b3b91c06eb">m_WalkSpeed</a>; <span class="comment">// in metres per second</span></div>
<div class="line"><a name="l00124"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a678ec156458630a0061ac7163b1f41ad">  124</a></span>&#160;    <a class="code" href="classCFixed.html">fixed</a> <a class="code" href="classCCmpUnitMotion.html#a678ec156458630a0061ac7163b1f41ad">m_RunSpeed</a>;</div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a4b80cadeba97790c2a2c2375af2007e7">  125</a></span>&#160;    <a class="code" href="classICmpPathfinder.html">ICmpPathfinder</a>::pass_class_t <a class="code" href="classCCmpUnitMotion.html#a4b80cadeba97790c2a2c2375af2007e7">m_PassClass</a>;</div>
<div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a623e56ca1f3510597d6e53919e7779c3">  126</a></span>&#160;    <a class="code" href="classICmpPathfinder.html">ICmpPathfinder</a>::cost_class_t <a class="code" href="classCCmpUnitMotion.html#a623e56ca1f3510597d6e53919e7779c3">m_CostClass</a>;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">// Dynamic state:</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a9ebfc4ba23b7c236e2c7ecf4ed6ebb7b">  130</a></span>&#160;    <a class="code" href="classCFixed.html">entity_pos_t</a> <a class="code" href="classCCmpUnitMotion.html#a9ebfc4ba23b7c236e2c7ecf4ed6ebb7b">m_Radius</a>;</div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a6e5bde87dc6dcfd34fc55496c6f650dd">  131</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#a6e5bde87dc6dcfd34fc55496c6f650dd">m_Moving</a>;</div>
<div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#ab238b2fb474eabc0707fea7c2e97efc1">  132</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#ab238b2fb474eabc0707fea7c2e97efc1">m_FacePointAfterMove</a>;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78">  134</a></span>&#160;    enum <a class="code" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78">State</a></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">         * Not moving at all.</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a2481807626d5f42bc11e7df57aba2a85">  139</a></span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a2481807626d5f42bc11e7df57aba2a85">STATE_IDLE</a>,</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">         * Not moving at all. Will go to IDLE next turn.</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">         * (This one-turn delay is a hack to fix animation timings.)</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a7769f8af2865e068ac2a3e3d8b456630">  145</a></span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a7769f8af2865e068ac2a3e3d8b456630">STATE_STOPPING</a>,</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">         * Member of a formation.</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">         * Pathing to the target (depending on m_PathState).</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">         * Target is m_TargetEntity plus m_TargetOffset.</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a78b9f8c8a2e428e2032a90ccace9a78d">  152</a></span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a78b9f8c8a2e428e2032a90ccace9a78d">STATE_FORMATIONMEMBER_PATH</a>,</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">         * Individual unit or formation controller.</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">         * Pathing to the target (depending on m_PathState).</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">         * Target is m_TargetPos, m_TargetMinRange, m_TargetMaxRange;</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">         * if m_TargetEntity is not INVALID_ENTITY then m_TargetPos is tracking it.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a9f1847061a0b7aaf798dab710b013c8a">  160</a></span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a9f1847061a0b7aaf798dab710b013c8a">STATE_INDIVIDUAL_PATH</a>,</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78ac145ee9f79f7f5c9ab2049c92902cb0e">  162</a></span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78ac145ee9f79f7f5c9ab2049c92902cb0e">STATE_MAX</a></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    };</div>
<div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a16e5d08df6279e07afad6649504db5d6">  164</a></span>&#160;    <a class="code" href="types_8h.html#af3b86d961da0a3575b4f99c9ffaf01fd">u8</a> <a class="code" href="classCCmpUnitMotion.html#a16e5d08df6279e07afad6649504db5d6">m_State</a>;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58">  166</a></span>&#160;    <span class="keyword">enum</span> <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58">PathState</a></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">         * There is no path.</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">         * (This should only happen in IDLE and STOPPING.)</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58ae63325a8e59d96aebf4f7e34cdd7d85c">  172</a></span>&#160;        <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58ae63325a8e59d96aebf4f7e34cdd7d85c">PATHSTATE_NONE</a>,</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">         * We have an outstanding long path request.</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">         * No paths are usable yet, so we can&#39;t move anywhere.</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00178"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58aa12b5b4dbb37b9ce98540bf3e609e710">  178</a></span>&#160;        <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58aa12b5b4dbb37b9ce98540bf3e609e710">PATHSTATE_WAITING_REQUESTING_LONG</a>,</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">         * We have an outstanding short path request.</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">         * m_LongPath is valid.</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">         * m_ShortPath is not yet valid, so we can&#39;t move anywhere.</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a867756a642e461e201ac6670cc2a0ecc">  185</a></span>&#160;        <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a867756a642e461e201ac6670cc2a0ecc">PATHSTATE_WAITING_REQUESTING_SHORT</a>,</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">         * We are following our path, and have no path requests.</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">         * m_LongPath and m_ShortPath are valid.</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a9c25c36c5a1beff0f26a6c03868acfbd">  191</a></span>&#160;        <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a9c25c36c5a1beff0f26a6c03868acfbd">PATHSTATE_FOLLOWING</a>,</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">         * We are following our path, and have an outstanding long path request.</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">         * (This is because our target moved a long way and we need to recompute</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">         * the whole path).</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">         * m_LongPath and m_ShortPath are valid.</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00199"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a572497d6361a275d18b442d62fc9d939">  199</a></span>&#160;        <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a572497d6361a275d18b442d62fc9d939">PATHSTATE_FOLLOWING_REQUESTING_LONG</a>,</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">         * We are following our path, and have an outstanding short path request.</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">         * (This is because our target moved and we&#39;ve got a new long path</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">         * which we need to follow).</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">         * m_LongPath is valid; m_ShortPath is valid but obsolete.</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00207"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a5823441be899123f667b039ce0fbd994">  207</a></span>&#160;        <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a5823441be899123f667b039ce0fbd994">PATHSTATE_FOLLOWING_REQUESTING_SHORT</a>,</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">         * We are following our path, and have an outstanding short path request</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">         * to append to our current path.</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">         * (This is because we got near the end of our short path and need</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">         * to extend it to continue along the long path).</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">         * m_LongPath and m_ShortPath are valid.</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00216"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a87c26345fd39dbf9fe41dd983ff9d5fe">  216</a></span>&#160;        <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a87c26345fd39dbf9fe41dd983ff9d5fe">PATHSTATE_FOLLOWING_REQUESTING_SHORT_APPEND</a>,</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div>
<div class="line"><a name="l00218"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a96299aed9d35a4ccbea5932d05f786c5">  218</a></span>&#160;        <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a96299aed9d35a4ccbea5932d05f786c5">PATHSTATE_MAX</a></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    };</div>
<div class="line"><a name="l00220"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#ae0b59de7ce5ab1788b1c22cc98b84e51">  220</a></span>&#160;    <a class="code" href="types_8h.html#af3b86d961da0a3575b4f99c9ffaf01fd">u8</a> <a class="code" href="classCCmpUnitMotion.html#ae0b59de7ce5ab1788b1c22cc98b84e51">m_PathState</a>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a84c3817741ac83093d499beb8f877356">  222</a></span>&#160;    <a class="code" href="types_8h.html#a332ccd83dfe2973e6cb2b61e4f3ab7e6">u32</a> <a class="code" href="classCCmpUnitMotion.html#a84c3817741ac83093d499beb8f877356">m_ExpectedPathTicket</a>; <span class="comment">// asynchronous request ID we&#39;re waiting for, or 0 if none</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a450a4492346d1a7719ae689ef73ec223">  224</a></span>&#160;    <a class="code" href="simulation2_2system_2Entity_8h.html#a70961dc0512c70c6de7c8f95d4500260">entity_id_t</a> <a class="code" href="classCCmpUnitMotion.html#a450a4492346d1a7719ae689ef73ec223">m_TargetEntity</a>;</div>
<div class="line"><a name="l00225"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#aa43d05cead87e28df1a4b338db18a9b5">  225</a></span>&#160;    <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> <a class="code" href="classCCmpUnitMotion.html#aa43d05cead87e28df1a4b338db18a9b5">m_TargetPos</a>;</div>
<div class="line"><a name="l00226"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a77db8cfdf209c7da59a2317cae3b03b0">  226</a></span>&#160;    <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> <a class="code" href="classCCmpUnitMotion.html#a77db8cfdf209c7da59a2317cae3b03b0">m_TargetOffset</a>;</div>
<div class="line"><a name="l00227"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a31f1235e72ec4d199b78e17e31c00328">  227</a></span>&#160;    <a class="code" href="classCFixed.html">entity_pos_t</a> <a class="code" href="classCCmpUnitMotion.html#a31f1235e72ec4d199b78e17e31c00328">m_TargetMinRange</a>;</div>
<div class="line"><a name="l00228"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#ac7205b6f7d51adeb2ae1c887e8c74f91">  228</a></span>&#160;    <a class="code" href="classCFixed.html">entity_pos_t</a> <a class="code" href="classCCmpUnitMotion.html#ac7205b6f7d51adeb2ae1c887e8c74f91">m_TargetMaxRange</a>;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div>
<div class="line"><a name="l00230"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a9820f999ea19f1b2ba57a5d9bff5485d">  230</a></span>&#160;    <a class="code" href="classCFixed.html">fixed</a> <a class="code" href="classCCmpUnitMotion.html#a9820f999ea19f1b2ba57a5d9bff5485d">m_Speed</a>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">// Current mean speed (over the last turn).</span></div>
<div class="line"><a name="l00233"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a435cc60cf8dc29e7ffbceb050bdbddf9">  233</a></span>&#160;    <a class="code" href="classCFixed.html">fixed</a> <a class="code" href="classCCmpUnitMotion.html#a435cc60cf8dc29e7ffbceb050bdbddf9">m_CurSpeed</a>;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">// Currently active paths (storing waypoints in reverse order).</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">// The last item in each path is the point we&#39;re currently heading towards.</span></div>
<div class="line"><a name="l00237"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">  237</a></span>&#160;    <a class="code" href="structICmpPathfinder_1_1Path.html">ICmpPathfinder::Path</a> <a class="code" href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">m_LongPath</a>;</div>
<div class="line"><a name="l00238"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a1198bb1bc6d082ea3a4cc5432d30249d">  238</a></span>&#160;    <a class="code" href="structICmpPathfinder_1_1Path.html">ICmpPathfinder::Path</a> <a class="code" href="classCCmpUnitMotion.html#a1198bb1bc6d082ea3a4cc5432d30249d">m_ShortPath</a>;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">  240</a></span>&#160;    <a class="code" href="structICmpPathfinder_1_1Goal.html">ICmpPathfinder::Goal</a> <a class="code" href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">m_FinalGoal</a>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div>
<div class="line"><a name="l00242"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a154e5f186a8be4d283e35dbfd0046a60">  242</a></span>&#160;    <span class="keyword">static</span> std::string <a class="code" href="classCCmpUnitMotion.html#a154e5f186a8be4d283e35dbfd0046a60">GetSchema</a>()</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            <span class="stringliteral">&quot;&lt;a:help&gt;Provides the unit with the ability to move around the world by itself.&lt;/a:help&gt;&quot;</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            <span class="stringliteral">&quot;&lt;a:example&gt;&quot;</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                <span class="stringliteral">&quot;&lt;WalkSpeed&gt;7.0&lt;/WalkSpeed&gt;&quot;</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                <span class="stringliteral">&quot;&lt;PassabilityClass&gt;default&lt;/PassabilityClass&gt;&quot;</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                <span class="stringliteral">&quot;&lt;CostClass&gt;infantry&lt;/CostClass&gt;&quot;</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="stringliteral">&quot;&lt;/a:example&gt;&quot;</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <span class="stringliteral">&quot;&lt;element name=&#39;FormationController&#39;&gt;&quot;</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                <span class="stringliteral">&quot;&lt;data type=&#39;boolean&#39;/&gt;&quot;</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <span class="stringliteral">&quot;&lt;/element&gt;&quot;</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <span class="stringliteral">&quot;&lt;element name=&#39;WalkSpeed&#39; a:help=&#39;Basic movement speed (in metres per second)&#39;&gt;&quot;</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                <span class="stringliteral">&quot;&lt;ref name=&#39;positiveDecimal&#39;/&gt;&quot;</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            <span class="stringliteral">&quot;&lt;/element&gt;&quot;</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            <span class="stringliteral">&quot;&lt;optional&gt;&quot;</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                <span class="stringliteral">&quot;&lt;element name=&#39;Run&#39;&gt;&quot;</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                    <span class="stringliteral">&quot;&lt;interleave&gt;&quot;</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                        <span class="stringliteral">&quot;&lt;element name=&#39;Speed&#39;&gt;&lt;ref name=&#39;positiveDecimal&#39;/&gt;&lt;/element&gt;&quot;</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                        <span class="stringliteral">&quot;&lt;element name=&#39;Range&#39;&gt;&lt;ref name=&#39;positiveDecimal&#39;/&gt;&lt;/element&gt;&quot;</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                        <span class="stringliteral">&quot;&lt;element name=&#39;RangeMin&#39;&gt;&lt;ref name=&#39;nonNegativeDecimal&#39;/&gt;&lt;/element&gt;&quot;</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                        <span class="stringliteral">&quot;&lt;element name=&#39;RegenTime&#39;&gt;&lt;ref name=&#39;positiveDecimal&#39;/&gt;&lt;/element&gt;&quot;</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                        <span class="stringliteral">&quot;&lt;element name=&#39;DecayTime&#39;&gt;&lt;ref name=&#39;positiveDecimal&#39;/&gt;&lt;/element&gt;&quot;</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                    <span class="stringliteral">&quot;&lt;/interleave&gt;&quot;</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                <span class="stringliteral">&quot;&lt;/element&gt;&quot;</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="stringliteral">&quot;&lt;/optional&gt;&quot;</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <span class="stringliteral">&quot;&lt;element name=&#39;PassabilityClass&#39; a:help=&#39;Identifies the terrain passability class (values are defined in special/pathfinder.xml)&#39;&gt;&quot;</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                <span class="stringliteral">&quot;&lt;text/&gt;&quot;</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="stringliteral">&quot;&lt;/element&gt;&quot;</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <span class="stringliteral">&quot;&lt;element name=&#39;CostClass&#39; a:help=&#39;Identifies the movement speed/cost class (values are defined in special/pathfinder.xml)&#39;&gt;&quot;</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                <span class="stringliteral">&quot;&lt;text/&gt;&quot;</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <span class="stringliteral">&quot;&lt;/element&gt;&quot;</span>;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    }</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">     * TODO: the running/charging thing needs to be designed and implemented</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div>
<div class="line"><a name="l00280"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a14e2efe8f4340f9b576fb0fa9a0ce5c8">  280</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a14e2efe8f4340f9b576fb0fa9a0ce5c8">Init</a>(<span class="keyword">const</span> <a class="code" href="classCParamNode.html">CParamNode</a>&amp; paramNode)</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    {</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a6553c525ac36ba2cf3b5af7a28aae61a">m_FormationController</a> = paramNode.<a class="code" href="classCParamNode.html#adb2692c0fbf3c367c110318f96a8d32f">GetChild</a>(<span class="stringliteral">&quot;FormationController&quot;</span>).<a class="code" href="classCParamNode.html#a4751986df18f1ef18f03d90c2c48008a">ToBool</a>();</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a6e5bde87dc6dcfd34fc55496c6f650dd">m_Moving</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#ab238b2fb474eabc0707fea7c2e97efc1">m_FacePointAfterMove</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a758b9abd0782f12aba62d4b3b91c06eb">m_WalkSpeed</a> = paramNode.<a class="code" href="classCParamNode.html#adb2692c0fbf3c367c110318f96a8d32f">GetChild</a>(<span class="stringliteral">&quot;WalkSpeed&quot;</span>).<a class="code" href="classCParamNode.html#a1dc59ac4c42ec4c5ca6a3d2542f4d795">ToFixed</a>();</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a9820f999ea19f1b2ba57a5d9bff5485d">m_Speed</a> = <a class="code" href="classCCmpUnitMotion.html#a758b9abd0782f12aba62d4b3b91c06eb">m_WalkSpeed</a>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a435cc60cf8dc29e7ffbceb050bdbddf9">m_CurSpeed</a> = <a class="code" href="classCFixed.html#a23fb928093e1e6f43e50c02ad333e12f">fixed::Zero</a>();</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">if</span> (paramNode.<a class="code" href="classCParamNode.html#adb2692c0fbf3c367c110318f96a8d32f">GetChild</a>(<span class="stringliteral">&quot;Run&quot;</span>).<a class="code" href="classCParamNode.html#aedcc2b5a330deba1b9219f44d4822827">IsOk</a>())</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <a class="code" href="classCCmpUnitMotion.html#a678ec156458630a0061ac7163b1f41ad">m_RunSpeed</a> = paramNode.<a class="code" href="classCParamNode.html#adb2692c0fbf3c367c110318f96a8d32f">GetChild</a>(<span class="stringliteral">&quot;Run&quot;</span>).<a class="code" href="classCParamNode.html#adb2692c0fbf3c367c110318f96a8d32f">GetChild</a>(<span class="stringliteral">&quot;Speed&quot;</span>).<a class="code" href="classCParamNode.html#a1dc59ac4c42ec4c5ca6a3d2542f4d795">ToFixed</a>();</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            <a class="code" href="classCCmpUnitMotion.html#a678ec156458630a0061ac7163b1f41ad">m_RunSpeed</a> = <a class="code" href="classCCmpUnitMotion.html#a758b9abd0782f12aba62d4b3b91c06eb">m_WalkSpeed</a>;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        }</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPathfinder&gt;</a> cmpPathfinder(<a class="code" href="classIComponent.html#ad24e00d357aade9c7c7973c8303bc618">GetSystemEntity</a>());</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <span class="keywordflow">if</span> (cmpPathfinder)</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            <a class="code" href="classCCmpUnitMotion.html#a4b80cadeba97790c2a2c2375af2007e7">m_PassClass</a> = cmpPathfinder-&gt;<a class="code" href="classICmpPathfinder.html#ad28fbc71b9ad696be596167dfe3ab075">GetPassabilityClass</a>(paramNode.<a class="code" href="classCParamNode.html#adb2692c0fbf3c367c110318f96a8d32f">GetChild</a>(<span class="stringliteral">&quot;PassabilityClass&quot;</span>).<a class="code" href="classCParamNode.html#a2a534f1d8adf69887023f1822f7b236e">ToUTF8</a>());</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            <a class="code" href="classCCmpUnitMotion.html#a623e56ca1f3510597d6e53919e7779c3">m_CostClass</a> = cmpPathfinder-&gt;<a class="code" href="classICmpPathfinder.html#acbe58c38e20ec855b2af1e942d0bc34c">GetCostClass</a>(paramNode.<a class="code" href="classCParamNode.html#adb2692c0fbf3c367c110318f96a8d32f">GetChild</a>(<span class="stringliteral">&quot;CostClass&quot;</span>).<a class="code" href="classCParamNode.html#a2a534f1d8adf69887023f1822f7b236e">ToUTF8</a>());</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        }</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpObstruction&gt;</a> cmpObstruction(<a class="code" href="classIComponent.html#a67e2894e43dc8d141702644072f3c3ca">GetEntityHandle</a>());</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordflow">if</span> (cmpObstruction)</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            <a class="code" href="classCCmpUnitMotion.html#a9ebfc4ba23b7c236e2c7ecf4ed6ebb7b">m_Radius</a> = cmpObstruction-&gt;<a class="code" href="classICmpObstruction.html#ac79f23ea652401c66dc4b5211b655ffb">GetUnitRadius</a>();</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a16e5d08df6279e07afad6649504db5d6">m_State</a> = <a class="code" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a2481807626d5f42bc11e7df57aba2a85">STATE_IDLE</a>;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#ae0b59de7ce5ab1788b1c22cc98b84e51">m_PathState</a> = <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58ae63325a8e59d96aebf4f7e34cdd7d85c">PATHSTATE_NONE</a>;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a84c3817741ac83093d499beb8f877356">m_ExpectedPathTicket</a> = 0;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a450a4492346d1a7719ae689ef73ec223">m_TargetEntity</a> = <a class="code" href="simulation2_2system_2Entity_8h.html#a1367d00ed40eb3c86920997c86e70b59">INVALID_ENTITY</a>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">m_FinalGoal</a>.<a class="code" href="structICmpPathfinder_1_1Goal.html#a33c4acbb567eb85a4afa7504468d4f53">type</a> = <a class="code" href="structICmpPathfinder_1_1Goal.html#a56759efe217d039b0c3e75fd8bed5ed2a0f92429c19d8f061aa5bc6efb7d51ac8">ICmpPathfinder::Goal::POINT</a>;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a81ec5b62fa9271f89491dec73690062a">m_DebugOverlayEnabled</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    }</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div>
<div class="line"><a name="l00323"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a8aa7550bc719e664ef38e29c1d73afad">  323</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a8aa7550bc719e664ef38e29c1d73afad">Deinit</a>()</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    {</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> S&gt;</div>
<div class="line"><a name="l00328"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#aad8c201a4e2f7e222dd181f49ef9bb24">  328</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#aad8c201a4e2f7e222dd181f49ef9bb24">SerializeCommon</a>(S&amp; serialize)</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        serialize.NumberFixed_Unbounded(<span class="stringliteral">&quot;radius&quot;</span>, <a class="code" href="classCCmpUnitMotion.html#a9ebfc4ba23b7c236e2c7ecf4ed6ebb7b">m_Radius</a>);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        serialize.NumberU8(<span class="stringliteral">&quot;state&quot;</span>, <a class="code" href="classCCmpUnitMotion.html#a16e5d08df6279e07afad6649504db5d6">m_State</a>, 0, <a class="code" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78ac145ee9f79f7f5c9ab2049c92902cb0e">STATE_MAX</a>-1);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        serialize.NumberU8(<span class="stringliteral">&quot;path state&quot;</span>, <a class="code" href="classCCmpUnitMotion.html#ae0b59de7ce5ab1788b1c22cc98b84e51">m_PathState</a>, 0, <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a96299aed9d35a4ccbea5932d05f786c5">PATHSTATE_MAX</a>-1);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        serialize.NumberU32_Unbounded(<span class="stringliteral">&quot;ticket&quot;</span>, <a class="code" href="classCCmpUnitMotion.html#a84c3817741ac83093d499beb8f877356">m_ExpectedPathTicket</a>);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        serialize.NumberU32_Unbounded(<span class="stringliteral">&quot;target entity&quot;</span>, <a class="code" href="classCCmpUnitMotion.html#a450a4492346d1a7719ae689ef73ec223">m_TargetEntity</a>);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        serialize.NumberFixed_Unbounded(<span class="stringliteral">&quot;target pos x&quot;</span>, <a class="code" href="classCCmpUnitMotion.html#aa43d05cead87e28df1a4b338db18a9b5">m_TargetPos</a>.<a class="code" href="classCFixedVector2D.html#a0014c0852a3007df5a249653ed2453db">X</a>);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        serialize.NumberFixed_Unbounded(<span class="stringliteral">&quot;target pos y&quot;</span>, <a class="code" href="classCCmpUnitMotion.html#aa43d05cead87e28df1a4b338db18a9b5">m_TargetPos</a>.<a class="code" href="classCFixedVector2D.html#a814f82a51edea75e7066d03663c33d8f">Y</a>);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        serialize.NumberFixed_Unbounded(<span class="stringliteral">&quot;target offset x&quot;</span>, <a class="code" href="classCCmpUnitMotion.html#a77db8cfdf209c7da59a2317cae3b03b0">m_TargetOffset</a>.<a class="code" href="classCFixedVector2D.html#a0014c0852a3007df5a249653ed2453db">X</a>);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        serialize.NumberFixed_Unbounded(<span class="stringliteral">&quot;target offset y&quot;</span>, <a class="code" href="classCCmpUnitMotion.html#a77db8cfdf209c7da59a2317cae3b03b0">m_TargetOffset</a>.<a class="code" href="classCFixedVector2D.html#a814f82a51edea75e7066d03663c33d8f">Y</a>);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        serialize.NumberFixed_Unbounded(<span class="stringliteral">&quot;target min range&quot;</span>, <a class="code" href="classCCmpUnitMotion.html#a31f1235e72ec4d199b78e17e31c00328">m_TargetMinRange</a>);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        serialize.NumberFixed_Unbounded(<span class="stringliteral">&quot;target max range&quot;</span>, <a class="code" href="classCCmpUnitMotion.html#ac7205b6f7d51adeb2ae1c887e8c74f91">m_TargetMaxRange</a>);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        serialize.NumberFixed_Unbounded(<span class="stringliteral">&quot;speed&quot;</span>, <a class="code" href="classCCmpUnitMotion.html#a9820f999ea19f1b2ba57a5d9bff5485d">m_Speed</a>);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        serialize.Bool(<span class="stringliteral">&quot;moving&quot;</span>, <a class="code" href="classCCmpUnitMotion.html#a6e5bde87dc6dcfd34fc55496c6f650dd">m_Moving</a>);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        serialize.Bool(<span class="stringliteral">&quot;facePointAfterMove&quot;</span>, <a class="code" href="classCCmpUnitMotion.html#ab238b2fb474eabc0707fea7c2e97efc1">m_FacePointAfterMove</a>);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <a class="code" href="structSerializeVector.html">SerializeVector&lt;SerializeWaypoint&gt;</a>()(serialize, <span class="stringliteral">&quot;long path&quot;</span>, <a class="code" href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">m_LongPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <a class="code" href="structSerializeVector.html">SerializeVector&lt;SerializeWaypoint&gt;</a>()(serialize, <span class="stringliteral">&quot;short path&quot;</span>, <a class="code" href="classCCmpUnitMotion.html#a1198bb1bc6d082ea3a4cc5432d30249d">m_ShortPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <a class="code" href="structSerializeGoal.html">SerializeGoal</a>()(serialize, <span class="stringliteral">&quot;goal&quot;</span>, <a class="code" href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">m_FinalGoal</a>);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div>
<div class="line"><a name="l00356"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a5fd594984644e67cbbc05dc8bf33124b">  356</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a5fd594984644e67cbbc05dc8bf33124b">Serialize</a>(<a class="code" href="classISerializer.html">ISerializer</a>&amp; serialize)</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#aad8c201a4e2f7e222dd181f49ef9bb24">SerializeCommon</a>(serialize);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    }</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a390db59a135c5962aee81aa80e00855d">  361</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a390db59a135c5962aee81aa80e00855d">Deserialize</a>(<span class="keyword">const</span> <a class="code" href="classCParamNode.html">CParamNode</a>&amp; paramNode, <a class="code" href="classIDeserializer.html">IDeserializer</a>&amp; deserialize)</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    {</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a14e2efe8f4340f9b576fb0fa9a0ce5c8">Init</a>(paramNode);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#aad8c201a4e2f7e222dd181f49ef9bb24">SerializeCommon</a>(deserialize);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div>
<div class="line"><a name="l00368"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a21dc2aa1cdaa82062dc6aec2ce660743">  368</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a21dc2aa1cdaa82062dc6aec2ce660743">HandleMessage</a>(<span class="keyword">const</span> <a class="code" href="classCMessage.html">CMessage</a>&amp; msg, <span class="keywordtype">bool</span> <a class="code" href="code__annotation_8h.html#a3e5bd53e9de4078ded1bf077b019a131">UNUSED</a>(global))</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    {</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keywordflow">switch</span> (msg.<a class="code" href="classCMessage.html#a1a02400beff0f7dff88156e05ce387d2">GetType</a>())</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="Components_8h.html#aeed5f0d6bf70b510e5eb09522ea8fb6fa273df3edd94f150c5586e56c696023da">MT_Update_MotionFormation</a>:</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#a6553c525ac36ba2cf3b5af7a28aae61a">m_FormationController</a>)</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            {</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                <a class="code" href="classCFixed.html">fixed</a> dt = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="classCMessageUpdate__MotionFormation.html">CMessageUpdate_MotionFormation</a>&amp;<span class="keyword">&gt;</span> (msg).turnLength;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                <a class="code" href="classCCmpUnitMotion.html#a1f983633f40a4bd208e082fe38ac9781">Move</a>(dt);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="Components_8h.html#aeed5f0d6bf70b510e5eb09522ea8fb6faf51beea244290e2655654c92646b88e2">MT_Update_MotionUnit</a>:</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="classCCmpUnitMotion.html#a6553c525ac36ba2cf3b5af7a28aae61a">m_FormationController</a>)</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                <a class="code" href="classCFixed.html">fixed</a> dt = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="classCMessageUpdate__MotionUnit.html">CMessageUpdate_MotionUnit</a>&amp;<span class="keyword">&gt;</span> (msg).turnLength;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                <a class="code" href="classCCmpUnitMotion.html#a1f983633f40a4bd208e082fe38ac9781">Move</a>(dt);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        }</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="Components_8h.html#aeed5f0d6bf70b510e5eb09522ea8fb6fadcd319267a030b23b69294967f29731c">MT_RenderSubmit</a>:</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        {</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <span class="keyword">const</span> <a class="code" href="classCMessageRenderSubmit.html">CMessageRenderSubmit</a>&amp; msgData = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="classCMessageRenderSubmit.html">CMessageRenderSubmit</a>&amp;<span class="keyword">&gt;</span> (msg);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            <a class="code" href="classCCmpUnitMotion.html#a5fae9b253856b7ccfa785a388fa4a8ef">RenderSubmit</a>(msgData.<a class="code" href="classCMessageRenderSubmit.html#a240c34c2e2a70a770995617eebf57250">collector</a>);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="Components_8h.html#aeed5f0d6bf70b510e5eb09522ea8fb6faacb54dda3f3589bfb5be5c8c5e49c46a">MT_PathResult</a>:</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            <span class="keyword">const</span> <a class="code" href="classCMessagePathResult.html">CMessagePathResult</a>&amp; msgData = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="classCMessagePathResult.html">CMessagePathResult</a>&amp;<span class="keyword">&gt;</span> (msg);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            <a class="code" href="classCCmpUnitMotion.html#ad2c2616dd169076445bbf30a86d007a1">PathResult</a>(msgData.<a class="code" href="classCMessagePathResult.html#a299f88426e8dec2734f6a2a03f4900ea">ticket</a>, msgData.<a class="code" href="classCMessagePathResult.html#a2520f0a6cdf64d2d962e964d17d97556">path</a>);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div>
<div class="line"><a name="l00405"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a8723b6cafab3423d1d8d423e17c27f34">  405</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#a8723b6cafab3423d1d8d423e17c27f34">IsMoving</a>()</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classCCmpUnitMotion.html#a6e5bde87dc6dcfd34fc55496c6f650dd">m_Moving</a>;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div>
<div class="line"><a name="l00410"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#aaff2376439831c72219d6d071c0f0f18">  410</a></span>&#160;    <span class="keyword">virtual</span> <a class="code" href="classCFixed.html">fixed</a> <a class="code" href="classCCmpUnitMotion.html#aaff2376439831c72219d6d071c0f0f18">GetWalkSpeed</a>()</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classCCmpUnitMotion.html#a758b9abd0782f12aba62d4b3b91c06eb">m_WalkSpeed</a>;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    }</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div>
<div class="line"><a name="l00415"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a7f6b33d410aeaeacc616df8950d715fb">  415</a></span>&#160;    <span class="keyword">virtual</span> <a class="code" href="classCFixed.html">fixed</a> <a class="code" href="classCCmpUnitMotion.html#a7f6b33d410aeaeacc616df8950d715fb">GetRunSpeed</a>()</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classCCmpUnitMotion.html#a678ec156458630a0061ac7163b1f41ad">m_RunSpeed</a>;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    }</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div>
<div class="line"><a name="l00420"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a1e119344300ac55d4f121d02719cb83b">  420</a></span>&#160;    <span class="keyword">virtual</span> <a class="code" href="classICmpPathfinder.html#a9e2cf45d663912a8800d32165fd10c91">ICmpPathfinder::pass_class_t</a> <a class="code" href="classCCmpUnitMotion.html#a1e119344300ac55d4f121d02719cb83b">GetPassabilityClass</a>()</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classCCmpUnitMotion.html#a4b80cadeba97790c2a2c2375af2007e7">m_PassClass</a>;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div>
<div class="line"><a name="l00425"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#ae8ebde6c1f1881b22c134e59f83d5a10">  425</a></span>&#160;    <span class="keyword">virtual</span> <a class="code" href="classCFixed.html">fixed</a> <a class="code" href="classCCmpUnitMotion.html#ae8ebde6c1f1881b22c134e59f83d5a10">GetCurrentSpeed</a>()</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classCCmpUnitMotion.html#a435cc60cf8dc29e7ffbceb050bdbddf9">m_CurSpeed</a>;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div>
<div class="line"><a name="l00430"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a58a5c83b5107e3924170a3aa6cd8a3f5">  430</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a58a5c83b5107e3924170a3aa6cd8a3f5">SetSpeed</a>(<a class="code" href="classCFixed.html">fixed</a> speed)</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a9820f999ea19f1b2ba57a5d9bff5485d">m_Speed</a> = speed;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    }</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div>
<div class="line"><a name="l00435"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a41b088cbfba75f1535c38e023562726c">  435</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a41b088cbfba75f1535c38e023562726c">SetFacePointAfterMove</a>(<span class="keywordtype">bool</span> facePointAfterMove)</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    {</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#ab238b2fb474eabc0707fea7c2e97efc1">m_FacePointAfterMove</a> = facePointAfterMove;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    }</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div>
<div class="line"><a name="l00440"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#aed3aacb1208e5f0cb5fc5570a6f71ea3">  440</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#aed3aacb1208e5f0cb5fc5570a6f71ea3">SetDebugOverlay</a>(<span class="keywordtype">bool</span> enabled)</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a81ec5b62fa9271f89491dec73690062a">m_DebugOverlayEnabled</a> = enabled;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#afc440aaae4b07016e3d07a50b821074d">MoveToPointRange</a>(<a class="code" href="classCFixed.html">entity_pos_t</a> x, <a class="code" href="classCFixed.html">entity_pos_t</a> z, <a class="code" href="classCFixed.html">entity_pos_t</a> minRange, <a class="code" href="classCFixed.html">entity_pos_t</a> maxRange);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#addcb402597964a3b2211406858b9e8bf">IsInPointRange</a>(<a class="code" href="classCFixed.html">entity_pos_t</a> x, <a class="code" href="classCFixed.html">entity_pos_t</a> z, <a class="code" href="classCFixed.html">entity_pos_t</a> minRange, <a class="code" href="classCFixed.html">entity_pos_t</a> maxRange);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#ac89d86e77ccc627aadaf3d38e1850034">MoveToTargetRange</a>(<a class="code" href="simulation2_2system_2Entity_8h.html#a70961dc0512c70c6de7c8f95d4500260">entity_id_t</a> target, <a class="code" href="classCFixed.html">entity_pos_t</a> minRange, <a class="code" href="classCFixed.html">entity_pos_t</a> maxRange);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#a96ee6c4ce3cbe23a59cae462349df890">IsInTargetRange</a>(<a class="code" href="simulation2_2system_2Entity_8h.html#a70961dc0512c70c6de7c8f95d4500260">entity_id_t</a> target, <a class="code" href="classCFixed.html">entity_pos_t</a> minRange, <a class="code" href="classCFixed.html">entity_pos_t</a> maxRange);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#ae4be8cae9512c2bc3fca01238366b138">MoveToFormationOffset</a>(<a class="code" href="simulation2_2system_2Entity_8h.html#a70961dc0512c70c6de7c8f95d4500260">entity_id_t</a> target, <a class="code" href="classCFixed.html">entity_pos_t</a> x, <a class="code" href="classCFixed.html">entity_pos_t</a> z);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#abd775349e9bd09eb24a03f5756a2d696">FaceTowardsPoint</a>(<a class="code" href="classCFixed.html">entity_pos_t</a> x, <a class="code" href="classCFixed.html">entity_pos_t</a> z);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div>
<div class="line"><a name="l00453"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#aa2713917c3fc648d9cdaef853ba9a7ab">  453</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#aa2713917c3fc648d9cdaef853ba9a7ab">StopMoving</a>()</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a6e5bde87dc6dcfd34fc55496c6f650dd">m_Moving</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a84c3817741ac83093d499beb8f877356">m_ExpectedPathTicket</a> = 0;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a16e5d08df6279e07afad6649504db5d6">m_State</a> = <a class="code" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a7769f8af2865e068ac2a3e3d8b456630">STATE_STOPPING</a>;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#ae0b59de7ce5ab1788b1c22cc98b84e51">m_PathState</a> = <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58ae63325a8e59d96aebf4f7e34cdd7d85c">PATHSTATE_NONE</a>;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">m_LongPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.clear();</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a1198bb1bc6d082ea3a4cc5432d30249d">m_ShortPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.clear();</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div>
<div class="line"><a name="l00463"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a3ba0e2c1fcff8d7c3c16dc8e28ab7d7e">  463</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a3ba0e2c1fcff8d7c3c16dc8e28ab7d7e">SetUnitRadius</a>(<a class="code" href="classCFixed.html">fixed</a> radius)</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a9ebfc4ba23b7c236e2c7ecf4ed6ebb7b">m_Radius</a> = radius;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    }</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00469"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a519d300430e5ce527bd02300a76ea41b">  469</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#a519d300430e5ce527bd02300a76ea41b">ShouldAvoidMovingUnits</a>()</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    {</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keywordflow">return</span> !<a class="code" href="classCCmpUnitMotion.html#a6553c525ac36ba2cf3b5af7a28aae61a">m_FormationController</a>;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    }</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div>
<div class="line"><a name="l00474"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#aedcb1d29467bcfbdcb4448682a5d19f7">  474</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#aedcb1d29467bcfbdcb4448682a5d19f7">IsFormationMember</a>()</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    {</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classCCmpUnitMotion.html#a16e5d08df6279e07afad6649504db5d6">m_State</a> == <a class="code" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a78b9f8c8a2e428e2032a90ccace9a78d">STATE_FORMATIONMEMBER_PATH</a>;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div>
<div class="line"><a name="l00479"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#afffc94ff3bdbf7c5790c005af2db461a">  479</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#afffc94ff3bdbf7c5790c005af2db461a">StartFailed</a>()</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    {</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#aa2713917c3fc648d9cdaef853ba9a7ab">StopMoving</a>();</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a16e5d08df6279e07afad6649504db5d6">m_State</a> = <a class="code" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a2481807626d5f42bc11e7df57aba2a85">STATE_IDLE</a>; <span class="comment">// don&#39;t go through the STOPPING state since we never even started</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpObstruction&gt;</a> cmpObstruction(<a class="code" href="classIComponent.html#a67e2894e43dc8d141702644072f3c3ca">GetEntityHandle</a>());</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <span class="keywordflow">if</span> (cmpObstruction)</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            cmpObstruction-&gt;<a class="code" href="classICmpObstruction.html#a6931dd07e31dbbb44ae2a6e70c4e32f1">SetMovingFlag</a>(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <a class="code" href="classCMessageMotionChanged.html">CMessageMotionChanged</a> msg(<span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <a class="code" href="classIComponent.html#adecb3e6a4da223d0b028401b8519c424">GetSimContext</a>().<a class="code" href="classCSimContext.html#aca4aa944392b2d6282fa37975c3f0b0b">GetComponentManager</a>().<a class="code" href="classCComponentManager.html#a5477e1ed6d204a35035386ff924af2c9">PostMessage</a>(<a class="code" href="classIComponent.html#a9b13f60a69a6571edebba6338812527f">GetEntityId</a>(), msg);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    }</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div>
<div class="line"><a name="l00492"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a936459784cec5e2eb0e1c22cc22bc9dd">  492</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a936459784cec5e2eb0e1c22cc22bc9dd">MoveFailed</a>()</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    {</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#aa2713917c3fc648d9cdaef853ba9a7ab">StopMoving</a>();</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpObstruction&gt;</a> cmpObstruction(<a class="code" href="classIComponent.html#a67e2894e43dc8d141702644072f3c3ca">GetEntityHandle</a>());</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="keywordflow">if</span> (cmpObstruction)</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            cmpObstruction-&gt;<a class="code" href="classICmpObstruction.html#a6931dd07e31dbbb44ae2a6e70c4e32f1">SetMovingFlag</a>(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <a class="code" href="classCMessageMotionChanged.html">CMessageMotionChanged</a> msg(<span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <a class="code" href="classIComponent.html#adecb3e6a4da223d0b028401b8519c424">GetSimContext</a>().<a class="code" href="classCSimContext.html#aca4aa944392b2d6282fa37975c3f0b0b">GetComponentManager</a>().<a class="code" href="classCComponentManager.html#a5477e1ed6d204a35035386ff924af2c9">PostMessage</a>(<a class="code" href="classIComponent.html#a9b13f60a69a6571edebba6338812527f">GetEntityId</a>(), msg);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    }</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div>
<div class="line"><a name="l00504"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a676d0fa1e26f6cc0971369b2db98e925">  504</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a676d0fa1e26f6cc0971369b2db98e925">StartSucceeded</a>()</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    {</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <a class="code" href="classCMessageMotionChanged.html">CMessageMotionChanged</a> msg(<span class="keyword">true</span>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <a class="code" href="classIComponent.html#adecb3e6a4da223d0b028401b8519c424">GetSimContext</a>().<a class="code" href="classCSimContext.html#aca4aa944392b2d6282fa37975c3f0b0b">GetComponentManager</a>().<a class="code" href="classCComponentManager.html#a5477e1ed6d204a35035386ff924af2c9">PostMessage</a>(<a class="code" href="classIComponent.html#a9b13f60a69a6571edebba6338812527f">GetEntityId</a>(), msg);</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    }</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div>
<div class="line"><a name="l00510"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#abba09bd178e8bc968ff60ae38a925693">  510</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#abba09bd178e8bc968ff60ae38a925693">MoveSucceeded</a>()</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a6e5bde87dc6dcfd34fc55496c6f650dd">m_Moving</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpObstruction&gt;</a> cmpObstruction(<a class="code" href="classIComponent.html#a67e2894e43dc8d141702644072f3c3ca">GetEntityHandle</a>());</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <span class="keywordflow">if</span> (cmpObstruction)</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            cmpObstruction-&gt;<a class="code" href="classICmpObstruction.html#a6931dd07e31dbbb44ae2a6e70c4e32f1">SetMovingFlag</a>(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="comment">// No longer moving, so speed is 0.</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a435cc60cf8dc29e7ffbceb050bdbddf9">m_CurSpeed</a> = <a class="code" href="classCFixed.html#a23fb928093e1e6f43e50c02ad333e12f">fixed::Zero</a>();</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <a class="code" href="classCMessageMotionChanged.html">CMessageMotionChanged</a> msg(<span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <a class="code" href="classIComponent.html#adecb3e6a4da223d0b028401b8519c424">GetSimContext</a>().<a class="code" href="classCSimContext.html#aca4aa944392b2d6282fa37975c3f0b0b">GetComponentManager</a>().<a class="code" href="classCComponentManager.html#a5477e1ed6d204a35035386ff924af2c9">PostMessage</a>(<a class="code" href="classIComponent.html#a9b13f60a69a6571edebba6338812527f">GetEntityId</a>(), msg);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">     * Handle the result of an asynchronous path query.</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#ad2c2616dd169076445bbf30a86d007a1">PathResult</a>(<a class="code" href="types_8h.html#a332ccd83dfe2973e6cb2b61e4f3ab7e6">u32</a> ticket, <span class="keyword">const</span> <a class="code" href="structICmpPathfinder_1_1Path.html">ICmpPathfinder::Path</a>&amp; path);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">     * Do the per-turn movement and other updates.</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a1f983633f40a4bd208e082fe38ac9781">Move</a>(<a class="code" href="classCFixed.html">fixed</a> dt);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">     * Decide whether to approximate the given range from a square target as a circle,</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">     * rather than as a square.</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#ad9745fae3fa07459a54d9e5777e6ec17">ShouldTreatTargetAsCircle</a>(<a class="code" href="classCFixed.html">entity_pos_t</a> range, <a class="code" href="classCFixed.html">entity_pos_t</a> hw, <a class="code" href="classCFixed.html">entity_pos_t</a> hh, <a class="code" href="classCFixed.html">entity_pos_t</a> circleRadius);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">     * Computes the current location of our target entity (plus offset).</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">     * Returns false if no target entity or no valid position.</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#aaa865a1a5b657f08cf05ad4b82436554">ComputeTargetPosition</a>(<a class="code" href="classCFixedVector2D.html">CFixedVector2D</a>&amp; <a class="code" href="wdbg__sym_8cpp.html#ace3d1803d3e67865bf600d34b50328c5">out</a>);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">     * Attempts to replace the current path with a straight line to the target</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">     * entity, if it&#39;s close enough and the route is not obstructed.</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#addb7828843c29e56cf2785af6d430a06">TryGoingStraightToTargetEntity</a>(<a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> from);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">     * Returns whether the target entity has moved more than minDelta since our</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">     * last path computations, and we&#39;re close enough to it to care.</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#aef428849d159e01e39fa7321f0dc1850">CheckTargetMovement</a>(<a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> from, <a class="code" href="classCFixed.html">entity_pos_t</a> minDelta);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">     * Returns whether the length of the given path, plus the distance from</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">     * &#39;from&#39; to the first waypoints, it shorter than minDistance.</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#a0072593d0385b4695cc79da493868cc0">PathIsShort</a>(<span class="keyword">const</span> <a class="code" href="structICmpPathfinder_1_1Path.html">ICmpPathfinder::Path</a>&amp; path, <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> from, <a class="code" href="classCFixed.html">entity_pos_t</a> minDistance);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">     * Rotate to face towards the target point, given the current pos</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a251b047d9350fa8cbe8e036fe8cdd0ba">FaceTowardsPointFromPos</a>(<a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> pos, <a class="code" href="classCFixed.html">entity_pos_t</a> x, <a class="code" href="classCFixed.html">entity_pos_t</a> z);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">     * Returns an appropriate obstruction filter for use with path requests.</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <a class="code" href="classControlGroupMovementObstructionFilter.html">ControlGroupMovementObstructionFilter</a> <a class="code" href="classCCmpUnitMotion.html#ad61cc0ba26fdfcf76006e4007e00bf72">GetObstructionFilter</a>(<span class="keywordtype">bool</span> forceAvoidMovingUnits = <span class="keyword">false</span>);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">     * Start moving to the given goal, from our current position &#39;from&#39;.</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">     * Might go in a straight line immediately, or might start an asynchronous</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">     * path request.</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#ab047430688adc99a66b6ce63e6a73958">BeginPathing</a>(<a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> from, <span class="keyword">const</span> <a class="code" href="structICmpPathfinder_1_1Goal.html">ICmpPathfinder::Goal</a>&amp; goal);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">     * Start an asynchronous long path query.</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#acebe1df1011405a9c49adc740c260c78">RequestLongPath</a>(<a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> from, <span class="keyword">const</span> <a class="code" href="structICmpPathfinder_1_1Goal.html">ICmpPathfinder::Goal</a>&amp; goal);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">     * Start an asynchronous short path query.</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a6fe8d827c086999f1a7ffa4f4047a450">RequestShortPath</a>(<a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> from, <span class="keyword">const</span> <a class="code" href="structICmpPathfinder_1_1Goal.html">ICmpPathfinder::Goal</a>&amp; goal, <span class="keywordtype">bool</span> avoidMovingUnits);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">     * Select a next long waypoint, given the current unit position.</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">     * Also recomputes the short path to use that waypoint.</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">     * Returns false on error, or if there is no waypoint to pick.</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#a16cca606908bbfacbb70b9799dc52889">PickNextLongWaypoint</a>(<span class="keyword">const</span> <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a>&amp; pos, <span class="keywordtype">bool</span> avoidMovingUnits);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">     * Convert a path into a renderable list of lines</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a4c9674f431deba1076d4f0e36ae9744f">RenderPath</a>(<span class="keyword">const</span> <a class="code" href="structICmpPathfinder_1_1Path.html">ICmpPathfinder::Path</a>&amp; path, std::vector&lt;SOverlayLine&gt;&amp; lines, <a class="code" href="structCColor.html">CColor</a> color);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a5fae9b253856b7ccfa785a388fa4a8ef">RenderSubmit</a>(<a class="code" href="classSceneCollector.html">SceneCollector</a>&amp; collector);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;};</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<a class="code" href="Component_8h.html#abd6c342028e45948a03b331b417cb428">REGISTER_COMPONENT_TYPE</a>(UnitMotion)</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div>
<div class="line"><a name="l00609"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#ad2c2616dd169076445bbf30a86d007a1">  609</a></span>&#160;void <a class="code" href="classCCmpUnitMotion.html">CCmpUnitMotion</a>::PathResult(<a class="code" href="types_8h.html#a332ccd83dfe2973e6cb2b61e4f3ab7e6">u32</a> ticket, const <a class="code" href="classICmpPathfinder.html">ICmpPathfinder</a>::<a class="code" href="classPath.html">Path</a>&amp; path)</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;{</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="comment">// Ignore obsolete path requests</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keywordflow">if</span> (ticket != m_ExpectedPathTicket)</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    m_ExpectedPathTicket = 0; <span class="comment">// we don&#39;t expect to get this result again</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keywordflow">if</span> (m_PathState == PATHSTATE_WAITING_REQUESTING_LONG)</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    {</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        m_LongPath = path;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        m_ShortPath.m_Waypoints.clear();</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <span class="comment">// If there&#39;s no waypoints then we couldn&#39;t get near the target.</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        <span class="comment">// Sort of hack: Just try going directly to the goal point instead</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        <span class="comment">// (via the short pathfinder), so if we&#39;re stuck and the user clicks</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <span class="comment">// close enough to the unit then we can probably get unstuck</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="keywordflow">if</span> (m_LongPath.m_Waypoints.empty())</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        {</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <a class="code" href="structICmpPathfinder_1_1Waypoint.html">ICmpPathfinder::Waypoint</a> wp = { m_FinalGoal.<a class="code" href="structICmpPathfinder_1_1Waypoint.html#ac1029e9f0ceb98311a69741385d1e932">x</a>, m_FinalGoal.z };</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            m_LongPath.m_Waypoints.push_back(wp);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        }</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPosition&gt;</a> cmpPosition(GetEntityHandle());</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <span class="keywordflow">if</span> (!cmpPosition || !cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a822657906318eb50ede0ca757c9cbebf">IsInWorld</a>())</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            StartFailed();</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> pos = cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a59f810055dd3dea45b11703a00c6eeb1">GetPosition2D</a>();</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <span class="keywordflow">if</span> (!PickNextLongWaypoint(pos, ShouldAvoidMovingUnits()))</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        {</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            StartFailed();</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        }</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <span class="comment">// We started a short path request to the next long path waypoint</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        m_PathState = PATHSTATE_WAITING_REQUESTING_SHORT;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    }</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_PathState == PATHSTATE_WAITING_REQUESTING_SHORT)</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    {</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        m_ShortPath = path;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <span class="comment">// If there&#39;s no waypoints then we couldn&#39;t get near the target</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="keywordflow">if</span> (m_ShortPath.m_Waypoints.empty())</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            <span class="keywordflow">if</span> (!IsFormationMember())</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            {</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                StartFailed();</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;            }</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;            {</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                m_Moving = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                <a class="code" href="classCMessageMotionChanged.html">CMessageMotionChanged</a> msg(<span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                GetSimContext().GetComponentManager().PostMessage(GetEntityId(), msg);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;            }</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        }</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPosition&gt;</a> cmpPosition(GetEntityHandle());</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">if</span> (!cmpPosition || !cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a822657906318eb50ede0ca757c9cbebf">IsInWorld</a>())</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        {</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            StartFailed();</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        }</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        <span class="comment">// Now we&#39;ve got a short path that we can follow</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        m_PathState = PATHSTATE_FOLLOWING;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        StartSucceeded();</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    }</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_PathState == PATHSTATE_FOLLOWING_REQUESTING_LONG)</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    {</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        m_LongPath = path;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="comment">// Leave the old m_ShortPath - we&#39;ll carry on following it until the</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        <span class="comment">// new short path has been computed</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <span class="comment">// If there&#39;s no waypoints then we couldn&#39;t get near the target.</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        <span class="comment">// Sort of hack: Just try going directly to the goal point instead</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="comment">// (via the short pathfinder), so if we&#39;re stuck and the user clicks</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        <span class="comment">// close enough to the unit then we can probably get unstuck</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        <span class="keywordflow">if</span> (m_LongPath.m_Waypoints.empty())</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        {</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            <a class="code" href="structICmpPathfinder_1_1Waypoint.html">ICmpPathfinder::Waypoint</a> wp = { m_FinalGoal.<a class="code" href="structICmpPathfinder_1_1Waypoint.html#ac1029e9f0ceb98311a69741385d1e932">x</a>, m_FinalGoal.z };</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            m_LongPath.m_Waypoints.push_back(wp);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        }</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPosition&gt;</a> cmpPosition(GetEntityHandle());</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="keywordflow">if</span> (!cmpPosition || !cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a822657906318eb50ede0ca757c9cbebf">IsInWorld</a>())</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        {</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;            StopMoving();</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        }</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> pos = cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a59f810055dd3dea45b11703a00c6eeb1">GetPosition2D</a>();</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <span class="keywordflow">if</span> (!PickNextLongWaypoint(pos, ShouldAvoidMovingUnits()))</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        {</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            StopMoving();</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        }</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <span class="comment">// We started a short path request to the next long path waypoint</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        m_PathState = PATHSTATE_FOLLOWING_REQUESTING_SHORT;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <span class="comment">// (TODO: is this entirely safe? We might continue moving along our</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <span class="comment">// old path while this request is active, so it&#39;ll be slightly incorrect</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        <span class="comment">// by the time the request has completed)</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    }</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_PathState == PATHSTATE_FOLLOWING_REQUESTING_SHORT)</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    {</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="comment">// Replace the current path with the new one</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        m_ShortPath = path;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <span class="comment">// If there&#39;s no waypoints then we couldn&#39;t get near the target</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <span class="keywordflow">if</span> (m_ShortPath.m_Waypoints.empty())</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        {</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            <span class="comment">// We should stop moving (unless we&#39;re in a formation, in which</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            <span class="comment">// case we should continue following it)</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            <span class="keywordflow">if</span> (!IsFormationMember())</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            {</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                MoveFailed();</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            }</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                m_Moving = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                <a class="code" href="classCMessageMotionChanged.html">CMessageMotionChanged</a> msg(<span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                GetSimContext().GetComponentManager().PostMessage(GetEntityId(), msg);</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;            }</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        }</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        m_PathState = PATHSTATE_FOLLOWING;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_PathState == PATHSTATE_FOLLOWING_REQUESTING_SHORT_APPEND)</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    {</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        <span class="comment">// Append the new path onto our current one</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        m_ShortPath.m_Waypoints.insert(m_ShortPath.m_Waypoints.begin(), path.m_Waypoints.begin(), path.m_Waypoints.end());</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <span class="comment">// If there&#39;s no waypoints then we couldn&#39;t get near the target</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="comment">// from the last intermediate long-path waypoint. But we can still</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="comment">// continue using the remainder of our current short path. So just</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        <span class="comment">// discard the now-useless long path.</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        <span class="keywordflow">if</span> (path.m_Waypoints.empty())</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            m_LongPath.m_Waypoints.clear();</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        m_PathState = PATHSTATE_FOLLOWING;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    }</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    {</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <a class="code" href="CLogger_8h.html#a95f38715fd9690db0907bb5f6d6a51c4">LOGWARNING</a>(L<span class="stringliteral">&quot;unexpected PathResult (%u %d %d)&quot;</span>, GetEntityId(), m_State, m_PathState);</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    }</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;}</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div>
<div class="line"><a name="l00765"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a1f983633f40a4bd208e082fe38ac9781">  765</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a1f983633f40a4bd208e082fe38ac9781">CCmpUnitMotion::Move</a>(<a class="code" href="classCFixed.html">fixed</a> dt)</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;{</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <a class="code" href="Profile_8h.html#a6766aaa4b64ace39c242f179d917c746">PROFILE</a>(<span class="stringliteral">&quot;Move&quot;</span>);</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#a16e5d08df6279e07afad6649504db5d6">m_State</a> == <a class="code" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a7769f8af2865e068ac2a3e3d8b456630">STATE_STOPPING</a>)</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    {</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a16e5d08df6279e07afad6649504db5d6">m_State</a> = <a class="code" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a2481807626d5f42bc11e7df57aba2a85">STATE_IDLE</a>;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#abba09bd178e8bc968ff60ae38a925693">MoveSucceeded</a>();</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    }</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#a16e5d08df6279e07afad6649504db5d6">m_State</a> == <a class="code" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a2481807626d5f42bc11e7df57aba2a85">STATE_IDLE</a>)</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    {</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    }</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="classCCmpUnitMotion.html#ae0b59de7ce5ab1788b1c22cc98b84e51">m_PathState</a>)</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    {</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58ae63325a8e59d96aebf4f7e34cdd7d85c">PATHSTATE_NONE</a>:</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    {</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        <span class="comment">// If we&#39;re not pathing, do nothing</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    }</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58aa12b5b4dbb37b9ce98540bf3e609e710">PATHSTATE_WAITING_REQUESTING_LONG</a>:</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a867756a642e461e201ac6670cc2a0ecc">PATHSTATE_WAITING_REQUESTING_SHORT</a>:</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    {</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <span class="comment">// If we&#39;re waiting for a path and don&#39;t have one yet, do nothing</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    }</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a9c25c36c5a1beff0f26a6c03868acfbd">PATHSTATE_FOLLOWING</a>:</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a5823441be899123f667b039ce0fbd994">PATHSTATE_FOLLOWING_REQUESTING_SHORT</a>:</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a87c26345fd39dbf9fe41dd983ff9d5fe">PATHSTATE_FOLLOWING_REQUESTING_SHORT_APPEND</a>:</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a572497d6361a275d18b442d62fc9d939">PATHSTATE_FOLLOWING_REQUESTING_LONG</a>:</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    {</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="comment">// TODO: there&#39;s some asymmetry here when units look at other</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <span class="comment">// units&#39; positions - the result will depend on the order of execution.</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="comment">// Maybe we should split the updates into multiple phases to minimise</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <span class="comment">// that problem.</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPathfinder&gt;</a> cmpPathfinder(<a class="code" href="classIComponent.html#ad24e00d357aade9c7c7973c8303bc618">GetSystemEntity</a>());</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="keywordflow">if</span> (!cmpPathfinder)</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPosition&gt;</a> cmpPosition(<a class="code" href="classIComponent.html#a67e2894e43dc8d141702644072f3c3ca">GetEntityHandle</a>());</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        <span class="keywordflow">if</span> (!cmpPosition || !cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a822657906318eb50ede0ca757c9cbebf">IsInWorld</a>())</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> initialPos = cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a59f810055dd3dea45b11703a00c6eeb1">GetPosition2D</a>();</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <span class="comment">// If we&#39;re chasing a potentially-moving unit and are currently close</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <span class="comment">// enough to its current position, and we can head in a straight line</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <span class="comment">// to it, then throw away our current path and go straight to it</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#ae0b59de7ce5ab1788b1c22cc98b84e51">m_PathState</a> == <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a9c25c36c5a1beff0f26a6c03868acfbd">PATHSTATE_FOLLOWING</a>)</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            <a class="code" href="classCCmpUnitMotion.html#addb7828843c29e56cf2785af6d430a06">TryGoingStraightToTargetEntity</a>(initialPos);</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        <span class="comment">// Keep track of the current unit&#39;s position during the update</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> pos = initialPos;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <span class="comment">// If in formation, run to keep up; otherwise just walk</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="comment">// (TODO: support stamina, charging, etc)</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        <a class="code" href="classCFixed.html">fixed</a> basicSpeed;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#aedcb1d29467bcfbdcb4448682a5d19f7">IsFormationMember</a>())</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            basicSpeed = <a class="code" href="classCCmpUnitMotion.html#a7f6b33d410aeaeacc616df8950d715fb">GetRunSpeed</a>();</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;            basicSpeed = <a class="code" href="classCCmpUnitMotion.html#a9820f999ea19f1b2ba57a5d9bff5485d">m_Speed</a>; <span class="comment">// (typically but not always WalkSpeed)</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="comment">// Find the speed factor of the underlying terrain</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        <span class="comment">// (We only care about the tile we start on - it doesn&#39;t matter if we&#39;re moving</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <span class="comment">// partially onto a much slower/faster tile)</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <a class="code" href="classCFixed.html">fixed</a> terrainSpeed = cmpPathfinder-&gt;<a class="code" href="classICmpPathfinder.html#a63fcf18872a30c300d32d52c4d9b044f">GetMovementSpeed</a>(pos.<a class="code" href="classCFixedVector2D.html#a0014c0852a3007df5a249653ed2453db">X</a>, pos.<a class="code" href="classCFixedVector2D.html#a814f82a51edea75e7066d03663c33d8f">Y</a>, <a class="code" href="classCCmpUnitMotion.html#a623e56ca1f3510597d6e53919e7779c3">m_CostClass</a>);</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        <a class="code" href="classCFixed.html">fixed</a> maxSpeed = basicSpeed.<a class="code" href="classCFixed.html#a6afc8cf5ad319792f761496171a563ae">Multiply</a>(terrainSpeed);</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <span class="keywordtype">bool</span> wasObstructed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <span class="comment">// We want to move (at most) maxSpeed*dt units from pos towards the next waypoint</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        <a class="code" href="classCFixed.html">fixed</a> timeLeft = dt;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        <span class="keywordflow">while</span> (timeLeft &gt; <a class="code" href="classCFixed.html#a23fb928093e1e6f43e50c02ad333e12f">fixed::Zero</a>())</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        {</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;            <span class="comment">// If we ran out of short path, we have to stop</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#a1198bb1bc6d082ea3a4cc5432d30249d">m_ShortPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.empty())</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;            <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> target(<a class="code" href="classCCmpUnitMotion.html#a1198bb1bc6d082ea3a4cc5432d30249d">m_ShortPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.back().x, <a class="code" href="classCCmpUnitMotion.html#a1198bb1bc6d082ea3a4cc5432d30249d">m_ShortPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.back().z);</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;            <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> offset = target - pos;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            <span class="comment">// Face towards the target</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            <span class="keywordflow">if</span> (!offset.IsZero())</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            {</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;                <a class="code" href="classCFixed.html">entity_angle_t</a> angle = <a class="code" href="Fixed_8cpp.html#a936e2617eba952e705d5b0c42367f965">atan2_approx</a>(offset.X, offset.Y);</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                cmpPosition-&gt;<a class="code" href="classICmpPosition.html#aaba4662965bcabb138c71fcdfa9ab046">TurnTo</a>(angle);</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;            }</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            <span class="comment">// Work out how far we can travel in timeLeft</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            <a class="code" href="classCFixed.html">fixed</a> maxdist = maxSpeed.<a class="code" href="classCFixed.html#a6afc8cf5ad319792f761496171a563ae">Multiply</a>(timeLeft);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;            <span class="comment">// If the target is close, we can move there directly</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            <a class="code" href="classCFixed.html">fixed</a> offsetLength = offset.Length();</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            <span class="keywordflow">if</span> (offsetLength &lt;= maxdist)</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            {</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                <span class="keywordflow">if</span> (cmpPathfinder-&gt;<a class="code" href="classICmpPathfinder.html#a9d88d9e1c1f9fe6bede8b23dc217815e">CheckMovement</a>(<a class="code" href="classCCmpUnitMotion.html#ad61cc0ba26fdfcf76006e4007e00bf72">GetObstructionFilter</a>(), pos.X, pos.Y, target.X, target.Y, <a class="code" href="classCCmpUnitMotion.html#a9ebfc4ba23b7c236e2c7ecf4ed6ebb7b">m_Radius</a>, <a class="code" href="classCCmpUnitMotion.html#a4b80cadeba97790c2a2c2375af2007e7">m_PassClass</a>))</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                {</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                    pos = target;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                    <span class="comment">// Spend the rest of the time heading towards the next waypoint</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                    timeLeft = timeLeft - (offsetLength / maxSpeed);</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                    <a class="code" href="classCCmpUnitMotion.html#a1198bb1bc6d082ea3a4cc5432d30249d">m_ShortPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.pop_back();</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                }</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                {</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                    <span class="comment">// Error - path was obstructed</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                    wasObstructed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                }</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;            }</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;            {</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                <span class="comment">// Not close enough, so just move in the right direction</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                offset.Normalize(maxdist);</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                target = pos + offset;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                <span class="keywordflow">if</span> (cmpPathfinder-&gt;<a class="code" href="classICmpPathfinder.html#a9d88d9e1c1f9fe6bede8b23dc217815e">CheckMovement</a>(<a class="code" href="classCCmpUnitMotion.html#ad61cc0ba26fdfcf76006e4007e00bf72">GetObstructionFilter</a>(), pos.X, pos.Y, target.X, target.Y, <a class="code" href="classCCmpUnitMotion.html#a9ebfc4ba23b7c236e2c7ecf4ed6ebb7b">m_Radius</a>, <a class="code" href="classCCmpUnitMotion.html#a4b80cadeba97790c2a2c2375af2007e7">m_PassClass</a>))</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                {</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                    pos = target;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                }</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                {</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                    <span class="comment">// Error - path was obstructed</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                    wasObstructed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                }</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            }</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        }</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <span class="comment">// Update the Position component after our movement (if we actually moved anywhere)</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="keywordflow">if</span> (pos != initialPos)</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a89b65c2d715514228248d6f86fe20a0d">MoveTo</a>(pos.<a class="code" href="classCFixedVector2D.html#a0014c0852a3007df5a249653ed2453db">X</a>, pos.<a class="code" href="classCFixedVector2D.html#a814f82a51edea75e7066d03663c33d8f">Y</a>);</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="comment">// Calculate the mean speed over this past turn.</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a435cc60cf8dc29e7ffbceb050bdbddf9">m_CurSpeed</a> = cmpPosition-&gt;<a class="code" href="classICmpPosition.html#ad94c06fd3e95da3a3fd6a41b6d61a2d8">GetDistanceTravelled</a>() / dt;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        <span class="keywordflow">if</span> (wasObstructed)</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        {</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            <span class="comment">// Oops, we hit something (very likely another unit).</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            <span class="comment">// Stop, and recompute the whole path.</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;            <span class="comment">// TODO: if the target has UnitMotion and is higher priority,</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            <span class="comment">// we should wait a little bit.</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;            <a class="code" href="classCCmpUnitMotion.html#acebe1df1011405a9c49adc740c260c78">RequestLongPath</a>(pos, <a class="code" href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">m_FinalGoal</a>);</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;            <a class="code" href="classCCmpUnitMotion.html#ae0b59de7ce5ab1788b1c22cc98b84e51">m_PathState</a> = <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58aa12b5b4dbb37b9ce98540bf3e609e710">PATHSTATE_WAITING_REQUESTING_LONG</a>;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        }</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        <span class="comment">// We successfully moved along our path, until running out of</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <span class="comment">// waypoints or time.</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#ae0b59de7ce5ab1788b1c22cc98b84e51">m_PathState</a> == <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a9c25c36c5a1beff0f26a6c03868acfbd">PATHSTATE_FOLLOWING</a>)</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        {</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            <span class="comment">// If we&#39;re not currently computing any new paths:</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            <span class="comment">// If we are close to reaching the end of the short path</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;            <span class="comment">// (or have reached it already), try to extend it</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            <a class="code" href="classCFixed.html">entity_pos_t</a> minDistance = basicSpeed.<a class="code" href="classCFixed.html#a6afc8cf5ad319792f761496171a563ae">Multiply</a>(dt) * <a class="code" href="CCmpUnitMotion_8cpp.html#a580d143b9834c15fce9789b2f0dcc531">WAYPOINT_ADVANCE_LOOKAHEAD_TURNS</a>;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#a0072593d0385b4695cc79da493868cc0">PathIsShort</a>(<a class="code" href="classCCmpUnitMotion.html#a1198bb1bc6d082ea3a4cc5432d30249d">m_ShortPath</a>, pos, minDistance))</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;            {</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                <span class="comment">// Start the path extension from the end of this short path</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                <span class="comment">// (or our current position if no short path)</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> from = pos;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="classCCmpUnitMotion.html#a1198bb1bc6d082ea3a4cc5432d30249d">m_ShortPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.empty())</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                    from = <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a>(<a class="code" href="classCCmpUnitMotion.html#a1198bb1bc6d082ea3a4cc5432d30249d">m_ShortPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>[0].x, <a class="code" href="classCCmpUnitMotion.html#a1198bb1bc6d082ea3a4cc5432d30249d">m_ShortPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>[0].z);</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#a16cca606908bbfacbb70b9799dc52889">PickNextLongWaypoint</a>(from, <a class="code" href="classCCmpUnitMotion.html#a519d300430e5ce527bd02300a76ea41b">ShouldAvoidMovingUnits</a>()))</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                {</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                    <a class="code" href="classCCmpUnitMotion.html#ae0b59de7ce5ab1788b1c22cc98b84e51">m_PathState</a> = <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a87c26345fd39dbf9fe41dd983ff9d5fe">PATHSTATE_FOLLOWING_REQUESTING_SHORT_APPEND</a>;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                }</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                {</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                    <span class="comment">// Failed (there were no long waypoints left).</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                    <span class="comment">// If there&#39;s still some short path then continue following</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                    <span class="comment">// it, else we&#39;ve finished moving.</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#a1198bb1bc6d082ea3a4cc5432d30249d">m_ShortPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.empty())</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                    {</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#aedcb1d29467bcfbdcb4448682a5d19f7">IsFormationMember</a>())</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                        {</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                            <span class="comment">// We&#39;ve reached our assigned position. If the controller</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                            <span class="comment">// is idle, send a notification in case it should disband,</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                            <span class="comment">// otherwise continue following the formation next turn.</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                            <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpUnitMotion&gt;</a> cmpUnitMotion(<a class="code" href="classIComponent.html#adecb3e6a4da223d0b028401b8519c424">GetSimContext</a>(), <a class="code" href="classCCmpUnitMotion.html#a450a4492346d1a7719ae689ef73ec223">m_TargetEntity</a>);</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                            <span class="keywordflow">if</span> (cmpUnitMotion &amp;&amp; !cmpUnitMotion-&gt;<a class="code" href="classICmpUnitMotion.html#ac83142f17946fbc1ba42f63453810fb7">IsMoving</a>())</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                            {</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                                <a class="code" href="classCCmpUnitMotion.html#a6e5bde87dc6dcfd34fc55496c6f650dd">m_Moving</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                                <a class="code" href="classCMessageMotionChanged.html">CMessageMotionChanged</a> msg(<span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                                <a class="code" href="classIComponent.html#adecb3e6a4da223d0b028401b8519c424">GetSimContext</a>().<a class="code" href="classCSimContext.html#aca4aa944392b2d6282fa37975c3f0b0b">GetComponentManager</a>().<a class="code" href="classCComponentManager.html#a5477e1ed6d204a35035386ff924af2c9">PostMessage</a>(<a class="code" href="classIComponent.html#a9b13f60a69a6571edebba6338812527f">GetEntityId</a>(), msg);</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                            }</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;                        }</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                        {</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                            <span class="comment">// Not in formation, so just finish moving</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                            <a class="code" href="classCCmpUnitMotion.html#aa2713917c3fc648d9cdaef853ba9a7ab">StopMoving</a>();</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#ab238b2fb474eabc0707fea7c2e97efc1">m_FacePointAfterMove</a>)</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                                <a class="code" href="classCCmpUnitMotion.html#a251b047d9350fa8cbe8e036fe8cdd0ba">FaceTowardsPointFromPos</a>(pos, <a class="code" href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">m_FinalGoal</a>.<a class="code" href="structICmpPathfinder_1_1Goal.html#a1ca6426d0e4b1a6f213c1afa2f6d6c45">x</a>, <a class="code" href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">m_FinalGoal</a>.<a class="code" href="structICmpPathfinder_1_1Goal.html#aafab18228cd3cc155f04c4bfd34525b3">z</a>);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                            <span class="comment">// TODO: if the goal was a square building, we ought to point towards the</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                            <span class="comment">// nearest point on the square, not towards its center</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                        }</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                    }</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;                }</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;            }</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        }</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        <span class="comment">// If we have a target entity, and we&#39;re not miles away from the end of</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        <span class="comment">// our current path, and the target moved enough, then recompute our</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        <span class="comment">// whole path</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#ae0b59de7ce5ab1788b1c22cc98b84e51">m_PathState</a> == <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a9c25c36c5a1beff0f26a6c03868acfbd">PATHSTATE_FOLLOWING</a>)</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        {</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#aedcb1d29467bcfbdcb4448682a5d19f7">IsFormationMember</a>())</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                <a class="code" href="classCCmpUnitMotion.html#aef428849d159e01e39fa7321f0dc1850">CheckTargetMovement</a>(pos, CHECK_TARGET_MOVEMENT_MIN_DELTA_FORMATION);</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                <a class="code" href="classCCmpUnitMotion.html#aef428849d159e01e39fa7321f0dc1850">CheckTargetMovement</a>(pos, CHECK_TARGET_MOVEMENT_MIN_DELTA);</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        }</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    }</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    }</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;}</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div>
<div class="line"><a name="l01000"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#aaa865a1a5b657f08cf05ad4b82436554"> 1000</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#aaa865a1a5b657f08cf05ad4b82436554">CCmpUnitMotion::ComputeTargetPosition</a>(<a class="code" href="classCFixedVector2D.html">CFixedVector2D</a>&amp; <a class="code" href="wdbg__sym_8cpp.html#ace3d1803d3e67865bf600d34b50328c5">out</a>)</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;{</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#a450a4492346d1a7719ae689ef73ec223">m_TargetEntity</a> == <a class="code" href="simulation2_2system_2Entity_8h.html#a1367d00ed40eb3c86920997c86e70b59">INVALID_ENTITY</a>)</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPosition&gt;</a> cmpPosition(<a class="code" href="classIComponent.html#adecb3e6a4da223d0b028401b8519c424">GetSimContext</a>(), <a class="code" href="classCCmpUnitMotion.html#a450a4492346d1a7719ae689ef73ec223">m_TargetEntity</a>);</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="keywordflow">if</span> (!cmpPosition || !cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a822657906318eb50ede0ca757c9cbebf">IsInWorld</a>())</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#a77db8cfdf209c7da59a2317cae3b03b0">m_TargetOffset</a>.<a class="code" href="classCFixedVector2D.html#a119a6833abd8f4215cffd8db389987af">IsZero</a>())</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    {</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        <span class="comment">// No offset, just return the position directly</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        out = cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a59f810055dd3dea45b11703a00c6eeb1">GetPosition2D</a>();</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    }</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    {</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        <span class="comment">// There is an offset, so compute it relative to orientation</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        <a class="code" href="classCFixed.html">entity_angle_t</a> angle = cmpPosition-&gt;<a class="code" href="classICmpPosition.html#ae75e1a79434f7ce9cdefa7f674a01541">GetRotation</a>().<a class="code" href="classCFixedVector3D.html#a7c66fe9ac2cc5beaafdd54a3b6dc7372">Y</a>;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> offset = <a class="code" href="classCCmpUnitMotion.html#a77db8cfdf209c7da59a2317cae3b03b0">m_TargetOffset</a>.<a class="code" href="classCFixedVector2D.html#aa26e242458145bc27475b2349e465238">Rotate</a>(angle);</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        out = cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a59f810055dd3dea45b11703a00c6eeb1">GetPosition2D</a>() + offset;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    }</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;}</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div>
<div class="line"><a name="l01024"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#addb7828843c29e56cf2785af6d430a06"> 1024</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#addb7828843c29e56cf2785af6d430a06">CCmpUnitMotion::TryGoingStraightToTargetEntity</a>(<a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> from)</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;{</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> targetPos;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classCCmpUnitMotion.html#aaa865a1a5b657f08cf05ad4b82436554">ComputeTargetPosition</a>(targetPos))</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <span class="comment">// Fail if the target is too far away</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <span class="keywordflow">if</span> ((targetPos - from).CompareLength(DIRECT_PATH_RANGE) &gt; 0)</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPathfinder&gt;</a> cmpPathfinder(<a class="code" href="classIComponent.html#ad24e00d357aade9c7c7973c8303bc618">GetSystemEntity</a>());</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="keywordflow">if</span> (!cmpPathfinder)</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    <span class="comment">// Move the goal to match the target entity&#39;s new position</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    <a class="code" href="structICmpPathfinder_1_1Goal.html">ICmpPathfinder::Goal</a> goal = <a class="code" href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">m_FinalGoal</a>;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a1ca6426d0e4b1a6f213c1afa2f6d6c45">x</a> = targetPos.<a class="code" href="classCFixedVector2D.html#a0014c0852a3007df5a249653ed2453db">X</a>;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#aafab18228cd3cc155f04c4bfd34525b3">z</a> = targetPos.<a class="code" href="classCFixedVector2D.html#a814f82a51edea75e7066d03663c33d8f">Y</a>;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="comment">// (we ignore changes to the target&#39;s rotation, since only buildings are</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="comment">// square and buildings don&#39;t move)</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <span class="comment">// Find the point on the goal shape that we should head towards</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> goalPos = cmpPathfinder-&gt;<a class="code" href="classICmpPathfinder.html#aca615c664f02e1a2ca00dbd6e4fc4a58">GetNearestPointOnGoal</a>(from, goal);</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <span class="comment">// Check if there&#39;s any collisions on that route</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <span class="keywordflow">if</span> (!cmpPathfinder-&gt;<a class="code" href="classICmpPathfinder.html#a9d88d9e1c1f9fe6bede8b23dc217815e">CheckMovement</a>(<a class="code" href="classCCmpUnitMotion.html#ad61cc0ba26fdfcf76006e4007e00bf72">GetObstructionFilter</a>(), from.<a class="code" href="classCFixedVector2D.html#a0014c0852a3007df5a249653ed2453db">X</a>, from.<a class="code" href="classCFixedVector2D.html#a814f82a51edea75e7066d03663c33d8f">Y</a>, goalPos.<a class="code" href="classCFixedVector2D.html#a0014c0852a3007df5a249653ed2453db">X</a>, goalPos.<a class="code" href="classCFixedVector2D.html#a814f82a51edea75e7066d03663c33d8f">Y</a>, <a class="code" href="classCCmpUnitMotion.html#a9ebfc4ba23b7c236e2c7ecf4ed6ebb7b">m_Radius</a>, <a class="code" href="classCCmpUnitMotion.html#a4b80cadeba97790c2a2c2375af2007e7">m_PassClass</a>))</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <span class="comment">// That route is okay, so update our path</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">m_FinalGoal</a> = goal;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">m_LongPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.clear();</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a1198bb1bc6d082ea3a4cc5432d30249d">m_ShortPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.clear();</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <a class="code" href="structICmpPathfinder_1_1Waypoint.html">ICmpPathfinder::Waypoint</a> wp = { goalPos.<a class="code" href="classCFixedVector2D.html#a0014c0852a3007df5a249653ed2453db">X</a>, goalPos.<a class="code" href="classCFixedVector2D.html#a814f82a51edea75e7066d03663c33d8f">Y</a> };</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a1198bb1bc6d082ea3a4cc5432d30249d">m_ShortPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.push_back(wp);</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;}</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div>
<div class="line"><a name="l01062"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#aef428849d159e01e39fa7321f0dc1850"> 1062</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#aef428849d159e01e39fa7321f0dc1850">CCmpUnitMotion::CheckTargetMovement</a>(<a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> from, <a class="code" href="classCFixed.html">entity_pos_t</a> minDelta)</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;{</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> targetPos;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classCCmpUnitMotion.html#aaa865a1a5b657f08cf05ad4b82436554">ComputeTargetPosition</a>(targetPos))</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="comment">// Fail unless the target has moved enough</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> oldTargetPos(<a class="code" href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">m_FinalGoal</a>.<a class="code" href="structICmpPathfinder_1_1Goal.html#a1ca6426d0e4b1a6f213c1afa2f6d6c45">x</a>, <a class="code" href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">m_FinalGoal</a>.<a class="code" href="structICmpPathfinder_1_1Goal.html#aafab18228cd3cc155f04c4bfd34525b3">z</a>);</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="keywordflow">if</span> ((targetPos - oldTargetPos).CompareLength(minDelta) &lt; 0)</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <span class="comment">// Fail unless we&#39;re close enough to the target to care about its movement</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classCCmpUnitMotion.html#a0072593d0385b4695cc79da493868cc0">PathIsShort</a>(<a class="code" href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">m_LongPath</a>, from, CHECK_TARGET_MOVEMENT_AT_MAX_DIST))</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="comment">// Fail if the target is no longer visible to this entity&#39;s owner</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="comment">// (in which case we&#39;ll continue moving to its last known location,</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <span class="comment">// unless it comes back into view before we reach that location)</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpOwnership&gt;</a> cmpOwnership(<a class="code" href="classIComponent.html#a67e2894e43dc8d141702644072f3c3ca">GetEntityHandle</a>());</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="keywordflow">if</span> (cmpOwnership)</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    {</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;        <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpRangeManager&gt;</a> cmpRangeManager(<a class="code" href="classIComponent.html#ad24e00d357aade9c7c7973c8303bc618">GetSystemEntity</a>());</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        <span class="keywordflow">if</span> (cmpRangeManager)</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;        {</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            <span class="keywordflow">if</span> (cmpRangeManager-&gt;<a class="code" href="classICmpRangeManager.html#aeeafbf48f450cac7f02edff3f51ff8aa">GetLosVisibility</a>(<a class="code" href="classCCmpUnitMotion.html#a450a4492346d1a7719ae689ef73ec223">m_TargetEntity</a>, cmpOwnership-&gt;<a class="code" href="classICmpOwnership.html#a2e3174bd9f4b90e8be78c5a9b7a9f13c">GetOwner</a>()) == <a class="code" href="classICmpRangeManager.html#a7fee710a4a6a1053773f621e16300291a6754b0a097f05a82044462fc67da74d5">ICmpRangeManager::VIS_HIDDEN</a>)</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        }</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    }</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    <span class="comment">// The target moved and we need to update our current path;</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="comment">// change the goal here and expect our caller to start the path request</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">m_FinalGoal</a>.<a class="code" href="structICmpPathfinder_1_1Goal.html#a1ca6426d0e4b1a6f213c1afa2f6d6c45">x</a> = targetPos.<a class="code" href="classCFixedVector2D.html#a0014c0852a3007df5a249653ed2453db">X</a>;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">m_FinalGoal</a>.<a class="code" href="structICmpPathfinder_1_1Goal.html#aafab18228cd3cc155f04c4bfd34525b3">z</a> = targetPos.<a class="code" href="classCFixedVector2D.html#a814f82a51edea75e7066d03663c33d8f">Y</a>;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#acebe1df1011405a9c49adc740c260c78">RequestLongPath</a>(from, <a class="code" href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">m_FinalGoal</a>);</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#ae0b59de7ce5ab1788b1c22cc98b84e51">m_PathState</a> = <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a572497d6361a275d18b442d62fc9d939">PATHSTATE_FOLLOWING_REQUESTING_LONG</a>;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;}</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div>
<div class="line"><a name="l01101"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a0072593d0385b4695cc79da493868cc0"> 1101</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#a0072593d0385b4695cc79da493868cc0">CCmpUnitMotion::PathIsShort</a>(<span class="keyword">const</span> <a class="code" href="structICmpPathfinder_1_1Path.html">ICmpPathfinder::Path</a>&amp; path, <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> from, <a class="code" href="classCFixed.html">entity_pos_t</a> minDistance)</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;{</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> pos = from;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <a class="code" href="classCFixed.html">entity_pos_t</a> distLeft = minDistance;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="wposix__types_8h.html#af10f4c58d91a6fa30ccc8a19d0ecbf48">ssize_t</a> i = (<a class="code" href="wposix__types_8h.html#af10f4c58d91a6fa30ccc8a19d0ecbf48">ssize_t</a>)path.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.size()-1; i &gt;= 0; --i)</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    {</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <span class="comment">// Check if the next path segment is longer than the requested minimum</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> waypoint(path.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>[i].x, path.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>[i].z);</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> delta = waypoint - pos;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        <span class="keywordflow">if</span> (delta.<a class="code" href="classCFixedVector2D.html#abae1ab91b32a58fd19ee10260b5eedac">CompareLength</a>(distLeft) &gt; 0)</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        <span class="comment">// Still short enough - prepare to check the next segment</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        distLeft -= delta.<a class="code" href="classCFixedVector2D.html#a55fcaadc177fb4bd7fcde641cbe32deb">Length</a>();</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        pos = waypoint;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    }</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="comment">// Reached the end of the path before exceeding minDistance</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;}</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div>
<div class="line"><a name="l01123"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#abd775349e9bd09eb24a03f5756a2d696"> 1123</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#abd775349e9bd09eb24a03f5756a2d696">CCmpUnitMotion::FaceTowardsPoint</a>(<a class="code" href="classCFixed.html">entity_pos_t</a> x, <a class="code" href="classCFixed.html">entity_pos_t</a> z)</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;{</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPosition&gt;</a> cmpPosition(<a class="code" href="classIComponent.html#a67e2894e43dc8d141702644072f3c3ca">GetEntityHandle</a>());</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <span class="keywordflow">if</span> (!cmpPosition || !cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a822657906318eb50ede0ca757c9cbebf">IsInWorld</a>())</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> pos = cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a59f810055dd3dea45b11703a00c6eeb1">GetPosition2D</a>();</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a251b047d9350fa8cbe8e036fe8cdd0ba">FaceTowardsPointFromPos</a>(pos, x, z);</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;}</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div>
<div class="line"><a name="l01133"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a251b047d9350fa8cbe8e036fe8cdd0ba"> 1133</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a251b047d9350fa8cbe8e036fe8cdd0ba">CCmpUnitMotion::FaceTowardsPointFromPos</a>(<a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> pos, <a class="code" href="classCFixed.html">entity_pos_t</a> x, <a class="code" href="classCFixed.html">entity_pos_t</a> z)</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;{</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> target(x, z);</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> offset = target - pos;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <span class="keywordflow">if</span> (!offset.<a class="code" href="classCFixedVector2D.html#a119a6833abd8f4215cffd8db389987af">IsZero</a>())</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    {</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        <a class="code" href="classCFixed.html">entity_angle_t</a> angle = <a class="code" href="Fixed_8cpp.html#a936e2617eba952e705d5b0c42367f965">atan2_approx</a>(offset.<a class="code" href="classCFixedVector2D.html#a0014c0852a3007df5a249653ed2453db">X</a>, offset.<a class="code" href="classCFixedVector2D.html#a814f82a51edea75e7066d03663c33d8f">Y</a>);</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPosition&gt;</a> cmpPosition(<a class="code" href="classIComponent.html#a67e2894e43dc8d141702644072f3c3ca">GetEntityHandle</a>());</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        <span class="keywordflow">if</span> (!cmpPosition)</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        cmpPosition-&gt;<a class="code" href="classICmpPosition.html#aaba4662965bcabb138c71fcdfa9ab046">TurnTo</a>(angle);</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    }</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;}</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;</div>
<div class="line"><a name="l01148"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#ad61cc0ba26fdfcf76006e4007e00bf72"> 1148</a></span>&#160;<a class="code" href="classControlGroupMovementObstructionFilter.html">ControlGroupMovementObstructionFilter</a> <a class="code" href="classCCmpUnitMotion.html#ad61cc0ba26fdfcf76006e4007e00bf72">CCmpUnitMotion::GetObstructionFilter</a>(<span class="keywordtype">bool</span> forceAvoidMovingUnits)</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;{</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <a class="code" href="simulation2_2system_2Entity_8h.html#a70961dc0512c70c6de7c8f95d4500260">entity_id_t</a> group;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#aedcb1d29467bcfbdcb4448682a5d19f7">IsFormationMember</a>())</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        group = <a class="code" href="classCCmpUnitMotion.html#a450a4492346d1a7719ae689ef73ec223">m_TargetEntity</a>;</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        group = <a class="code" href="classIComponent.html#a9b13f60a69a6571edebba6338812527f">GetEntityId</a>();</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classControlGroupMovementObstructionFilter.html">ControlGroupMovementObstructionFilter</a>(forceAvoidMovingUnits || <a class="code" href="classCCmpUnitMotion.html#a519d300430e5ce527bd02300a76ea41b">ShouldAvoidMovingUnits</a>(), group);</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;}</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;</div>
<div class="line"><a name="l01161"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#ab047430688adc99a66b6ce63e6a73958"> 1161</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#ab047430688adc99a66b6ce63e6a73958">CCmpUnitMotion::BeginPathing</a>(<a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> from, <span class="keyword">const</span> <a class="code" href="structICmpPathfinder_1_1Goal.html">ICmpPathfinder::Goal</a>&amp; goal)</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;{</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    <span class="comment">// Cancel any pending path requests</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a84c3817741ac83093d499beb8f877356">m_ExpectedPathTicket</a> = 0;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <span class="comment">// Update the unit&#39;s movement status.</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a6e5bde87dc6dcfd34fc55496c6f650dd">m_Moving</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="comment">// Set our &#39;moving&#39; flag, so other units pathfinding now will ignore us</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpObstruction&gt;</a> cmpObstruction(<a class="code" href="classIComponent.html#a67e2894e43dc8d141702644072f3c3ca">GetEntityHandle</a>());</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="keywordflow">if</span> (cmpObstruction)</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;        cmpObstruction-&gt;<a class="code" href="classICmpObstruction.html#a6931dd07e31dbbb44ae2a6e70c4e32f1">SetMovingFlag</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="comment">// If we&#39;re aiming at a target entity and it&#39;s close and we can reach</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <span class="comment">// it in a straight line, then we&#39;ll just go along the straight line</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <span class="comment">// instead of computing a path.</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#addb7828843c29e56cf2785af6d430a06">TryGoingStraightToTargetEntity</a>(from))</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    {</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#ae0b59de7ce5ab1788b1c22cc98b84e51">m_PathState</a> = <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a9c25c36c5a1beff0f26a6c03868acfbd">PATHSTATE_FOLLOWING</a>;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    }</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <span class="comment">// TODO: should go straight to non-entity points too</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="comment">// Otherwise we need to compute a path.</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="comment">// TODO: if it&#39;s close then just do a short path, not a long path</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="comment">// (But if it&#39;s close on the opposite side of a river then we really</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="comment">// need a long path, so we can&#39;t simply check linear distance)</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#ae0b59de7ce5ab1788b1c22cc98b84e51">m_PathState</a> = <a class="code" href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58aa12b5b4dbb37b9ce98540bf3e609e710">PATHSTATE_WAITING_REQUESTING_LONG</a>;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#acebe1df1011405a9c49adc740c260c78">RequestLongPath</a>(from, goal);</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;}</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div>
<div class="line"><a name="l01195"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#acebe1df1011405a9c49adc740c260c78"> 1195</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#acebe1df1011405a9c49adc740c260c78">CCmpUnitMotion::RequestLongPath</a>(<a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> from, <span class="keyword">const</span> <a class="code" href="structICmpPathfinder_1_1Goal.html">ICmpPathfinder::Goal</a>&amp; goal)</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;{</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPathfinder&gt;</a> cmpPathfinder(<a class="code" href="classIComponent.html#ad24e00d357aade9c7c7973c8303bc618">GetSystemEntity</a>());</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="keywordflow">if</span> (!cmpPathfinder)</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    cmpPathfinder-&gt;<a class="code" href="classICmpPathfinder.html#ad04ecab269686efa86276a95d16985e2">SetDebugPath</a>(from.<a class="code" href="classCFixedVector2D.html#a0014c0852a3007df5a249653ed2453db">X</a>, from.<a class="code" href="classCFixedVector2D.html#a814f82a51edea75e7066d03663c33d8f">Y</a>, goal, <a class="code" href="classCCmpUnitMotion.html#a4b80cadeba97790c2a2c2375af2007e7">m_PassClass</a>, <a class="code" href="classCCmpUnitMotion.html#a623e56ca1f3510597d6e53919e7779c3">m_CostClass</a>);</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a84c3817741ac83093d499beb8f877356">m_ExpectedPathTicket</a> = cmpPathfinder-&gt;<a class="code" href="classICmpPathfinder.html#acf52d00dca18cc834a97eef4e614c46f">ComputePathAsync</a>(from.<a class="code" href="classCFixedVector2D.html#a0014c0852a3007df5a249653ed2453db">X</a>, from.<a class="code" href="classCFixedVector2D.html#a814f82a51edea75e7066d03663c33d8f">Y</a>, goal, <a class="code" href="classCCmpUnitMotion.html#a4b80cadeba97790c2a2c2375af2007e7">m_PassClass</a>, <a class="code" href="classCCmpUnitMotion.html#a623e56ca1f3510597d6e53919e7779c3">m_CostClass</a>, <a class="code" href="classIComponent.html#a9b13f60a69a6571edebba6338812527f">GetEntityId</a>());</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;}</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div>
<div class="line"><a name="l01206"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a6fe8d827c086999f1a7ffa4f4047a450"> 1206</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a6fe8d827c086999f1a7ffa4f4047a450">CCmpUnitMotion::RequestShortPath</a>(<a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> from, <span class="keyword">const</span> <a class="code" href="structICmpPathfinder_1_1Goal.html">ICmpPathfinder::Goal</a>&amp; goal, <span class="keywordtype">bool</span> avoidMovingUnits)</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;{</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPathfinder&gt;</a> cmpPathfinder(<a class="code" href="classIComponent.html#ad24e00d357aade9c7c7973c8303bc618">GetSystemEntity</a>());</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <span class="keywordflow">if</span> (!cmpPathfinder)</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a84c3817741ac83093d499beb8f877356">m_ExpectedPathTicket</a> = cmpPathfinder-&gt;<a class="code" href="classICmpPathfinder.html#af9725da0bbc1a953bec1d3124484bec6">ComputeShortPathAsync</a>(from.<a class="code" href="classCFixedVector2D.html#a0014c0852a3007df5a249653ed2453db">X</a>, from.<a class="code" href="classCFixedVector2D.html#a814f82a51edea75e7066d03663c33d8f">Y</a>, <a class="code" href="classCCmpUnitMotion.html#a9ebfc4ba23b7c236e2c7ecf4ed6ebb7b">m_Radius</a>, SHORT_PATH_SEARCH_RANGE, goal, <a class="code" href="classCCmpUnitMotion.html#a4b80cadeba97790c2a2c2375af2007e7">m_PassClass</a>, avoidMovingUnits, <a class="code" href="classCCmpUnitMotion.html#a450a4492346d1a7719ae689ef73ec223">m_TargetEntity</a>, <a class="code" href="classIComponent.html#a9b13f60a69a6571edebba6338812527f">GetEntityId</a>());</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;}</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div>
<div class="line"><a name="l01215"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a16cca606908bbfacbb70b9799dc52889"> 1215</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#a16cca606908bbfacbb70b9799dc52889">CCmpUnitMotion::PickNextLongWaypoint</a>(<span class="keyword">const</span> <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a>&amp; pos, <span class="keywordtype">bool</span> avoidMovingUnits)</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;{</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <span class="comment">// If there&#39;s no long path, we can&#39;t pick the next waypoint from it</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">m_LongPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.empty())</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <span class="comment">// First try to get the immediate next waypoint</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <a class="code" href="classCFixed.html">entity_pos_t</a> targetX = <a class="code" href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">m_LongPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.back().x;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <a class="code" href="classCFixed.html">entity_pos_t</a> targetZ = <a class="code" href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">m_LongPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.back().z;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">m_LongPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.pop_back();</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="comment">// To smooth the motion and avoid grid-constrained movement and allow dynamic obstacle avoidance,</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="comment">// try skipping some more waypoints if they&#39;re close enough</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">m_LongPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.empty())</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    {</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> w(<a class="code" href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">m_LongPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.back().x, <a class="code" href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">m_LongPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.back().z);</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        <span class="keywordflow">if</span> ((w - pos).CompareLength(WAYPOINT_ADVANCE_MAX) &gt; 0)</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        targetX = <a class="code" href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">m_LongPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.back().x;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        targetZ = <a class="code" href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">m_LongPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.back().z;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">m_LongPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.pop_back();</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    }</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <span class="comment">// Now we need to recompute a short path to the waypoint</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    <a class="code" href="structICmpPathfinder_1_1Goal.html">ICmpPathfinder::Goal</a> goal;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">m_LongPath</a>.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.empty())</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    {</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;        <span class="comment">// This was the last waypoint - head for the exact goal</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;        goal = <a class="code" href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">m_FinalGoal</a>;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    }</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    {</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;        <span class="comment">// Head for somewhere near the waypoint (but allow some leeway in case it&#39;s obstructed)</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;        goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a33c4acbb567eb85a4afa7504468d4f53">type</a> = <a class="code" href="structICmpPathfinder_1_1Goal.html#a56759efe217d039b0c3e75fd8bed5ed2a961bc01193c0dc37d49ce65f3e00d93f">ICmpPathfinder::Goal::CIRCLE</a>;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;        goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#abc726e50a5be06efb047fcaac02b81a6">hw</a> = <a class="code" href="CCmpUnitMotion_8cpp.html#ae4b3ad47946affd837ef8db3a308a4ea">SHORT_PATH_GOAL_RADIUS</a>;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;        goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a1ca6426d0e4b1a6f213c1afa2f6d6c45">x</a> = targetX;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#aafab18228cd3cc155f04c4bfd34525b3">z</a> = targetZ;</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    }</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPathfinder&gt;</a> cmpPathfinder(<a class="code" href="classIComponent.html#ad24e00d357aade9c7c7973c8303bc618">GetSystemEntity</a>());</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <span class="keywordflow">if</span> (!cmpPathfinder)</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a84c3817741ac83093d499beb8f877356">m_ExpectedPathTicket</a> = cmpPathfinder-&gt;<a class="code" href="classICmpPathfinder.html#af9725da0bbc1a953bec1d3124484bec6">ComputeShortPathAsync</a>(pos.<a class="code" href="classCFixedVector2D.html#a0014c0852a3007df5a249653ed2453db">X</a>, pos.<a class="code" href="classCFixedVector2D.html#a814f82a51edea75e7066d03663c33d8f">Y</a>, <a class="code" href="classCCmpUnitMotion.html#a9ebfc4ba23b7c236e2c7ecf4ed6ebb7b">m_Radius</a>, SHORT_PATH_SEARCH_RANGE, goal, <a class="code" href="classCCmpUnitMotion.html#a4b80cadeba97790c2a2c2375af2007e7">m_PassClass</a>, avoidMovingUnits, <a class="code" href="classIComponent.html#a9b13f60a69a6571edebba6338812527f">GetEntityId</a>(), <a class="code" href="classIComponent.html#a9b13f60a69a6571edebba6338812527f">GetEntityId</a>());</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;}</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div>
<div class="line"><a name="l01266"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#afc440aaae4b07016e3d07a50b821074d"> 1266</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#afc440aaae4b07016e3d07a50b821074d">CCmpUnitMotion::MoveToPointRange</a>(<a class="code" href="classCFixed.html">entity_pos_t</a> x, <a class="code" href="classCFixed.html">entity_pos_t</a> z, <a class="code" href="classCFixed.html">entity_pos_t</a> minRange, <a class="code" href="classCFixed.html">entity_pos_t</a> maxRange)</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;{</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <a class="code" href="Profile_8h.html#a6766aaa4b64ace39c242f179d917c746">PROFILE</a>(<span class="stringliteral">&quot;MoveToPointRange&quot;</span>);</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPosition&gt;</a> cmpPosition(<a class="code" href="classIComponent.html#a67e2894e43dc8d141702644072f3c3ca">GetEntityHandle</a>());</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    <span class="keywordflow">if</span> (!cmpPosition || !cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a822657906318eb50ede0ca757c9cbebf">IsInWorld</a>())</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> pos = cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a59f810055dd3dea45b11703a00c6eeb1">GetPosition2D</a>();</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <a class="code" href="structICmpPathfinder_1_1Goal.html">ICmpPathfinder::Goal</a> goal;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    <span class="keywordflow">if</span> (minRange.<a class="code" href="classCFixed.html#a189317861aacedc60b7d5317cea07f44">IsZero</a>() &amp;&amp; maxRange.<a class="code" href="classCFixed.html#a189317861aacedc60b7d5317cea07f44">IsZero</a>())</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    {</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;        <span class="comment">// Handle the non-ranged mode:</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        <span class="comment">// Check whether this point is in an obstruction</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;        <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpObstructionManager&gt;</a> cmpObstructionManager(<a class="code" href="classIComponent.html#ad24e00d357aade9c7c7973c8303bc618">GetSystemEntity</a>());</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;        <span class="keywordflow">if</span> (!cmpObstructionManager)</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;        <a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html">ICmpObstructionManager::ObstructionSquare</a> obstruction;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        <span class="keywordflow">if</span> (cmpObstructionManager-&gt;<a class="code" href="classICmpObstructionManager.html#acee26248d15747cbe5205447aad32d12">FindMostImportantObstruction</a>(<a class="code" href="classCCmpUnitMotion.html#ad61cc0ba26fdfcf76006e4007e00bf72">GetObstructionFilter</a>(<span class="keyword">true</span>), x, z, <a class="code" href="classCCmpUnitMotion.html#a9ebfc4ba23b7c236e2c7ecf4ed6ebb7b">m_Radius</a>, obstruction))</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        {</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;            <span class="comment">// If we&#39;re aiming inside a building, then aim for the outline of the building instead</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;            <span class="comment">// TODO: if we&#39;re aiming at a unit then maybe a circle would look nicer?</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;            goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a33c4acbb567eb85a4afa7504468d4f53">type</a> = <a class="code" href="structICmpPathfinder_1_1Goal.html#a56759efe217d039b0c3e75fd8bed5ed2ae7f0a446ab32d214949b2aa73f76916c">ICmpPathfinder::Goal::SQUARE</a>;</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;            goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a1ca6426d0e4b1a6f213c1afa2f6d6c45">x</a> = obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a8c6359dec3da2420bf4d592228f72e95">x</a>;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;            goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#aafab18228cd3cc155f04c4bfd34525b3">z</a> = obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a2066c7cadb51baab72d43e410c6ac399">z</a>;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;            goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a689861f0cfc43726913e0bd24f8d4fd4">u</a> = obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a043e0544bb7e58f5418d1c699a48e643">u</a>;</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;            goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#abb32cc00a6aca6f3aeeca0a8ce6ab7ee">v</a> = obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#abd31b33c563c412e21358fe255ce51d9">v</a>;</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;            goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#abc726e50a5be06efb047fcaac02b81a6">hw</a> = obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a3c7fc08553617b08fd8a1e2daf9ab889">hw</a> + <a class="code" href="classCCmpUnitMotion.html#a9ebfc4ba23b7c236e2c7ecf4ed6ebb7b">m_Radius</a> + <a class="code" href="CCmpUnitMotion_8cpp.html#ab2c6620256cf5c2e37cf150b2a4f8063">g_GoalDelta</a>; <span class="comment">// nudge the goal outwards so it doesn&#39;t intersect the building itself</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;            goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a7b61b4e42da891cd8b8dc1f90b37021e">hh</a> = obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a8b0c1584a68e10193569694ad763b48b">hh</a> + <a class="code" href="classCCmpUnitMotion.html#a9ebfc4ba23b7c236e2c7ecf4ed6ebb7b">m_Radius</a> + <a class="code" href="CCmpUnitMotion_8cpp.html#ab2c6620256cf5c2e37cf150b2a4f8063">g_GoalDelta</a>;</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        }</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        {</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;            <span class="comment">// Unobstructed - head directly for the goal</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;            goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a33c4acbb567eb85a4afa7504468d4f53">type</a> = <a class="code" href="structICmpPathfinder_1_1Goal.html#a56759efe217d039b0c3e75fd8bed5ed2a0f92429c19d8f061aa5bc6efb7d51ac8">ICmpPathfinder::Goal::POINT</a>;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;            goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a1ca6426d0e4b1a6f213c1afa2f6d6c45">x</a> = x;</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;            goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#aafab18228cd3cc155f04c4bfd34525b3">z</a> = z;</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;        }</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    }</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    {</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        <a class="code" href="classCFixed.html">entity_pos_t</a> distance = (pos - <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a>(x, z)).<a class="code" href="mikktspace_8cpp.html#acbe63d298ee3ff491978b66b68308efc">Length</a>();</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        <a class="code" href="classCFixed.html">entity_pos_t</a> goalDistance;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        <span class="keywordflow">if</span> (distance &lt; minRange)</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        {</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;            goalDistance = minRange + <a class="code" href="CCmpUnitMotion_8cpp.html#ab2c6620256cf5c2e37cf150b2a4f8063">g_GoalDelta</a>;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;        }</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (maxRange &gt;= <a class="code" href="classCFixed.html#a23fb928093e1e6f43e50c02ad333e12f">entity_pos_t::Zero</a>() &amp;&amp; distance &gt; maxRange)</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;        {</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;            goalDistance = maxRange - <a class="code" href="CCmpUnitMotion_8cpp.html#ab2c6620256cf5c2e37cf150b2a4f8063">g_GoalDelta</a>;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;        }</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;        {</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            <span class="comment">// We&#39;re already in range - no need to move anywhere</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#ab238b2fb474eabc0707fea7c2e97efc1">m_FacePointAfterMove</a>)</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;                <a class="code" href="classCCmpUnitMotion.html#a251b047d9350fa8cbe8e036fe8cdd0ba">FaceTowardsPointFromPos</a>(pos, x, z);</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        }</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        <span class="comment">// TODO: what happens if goalDistance &lt; 0? (i.e. we probably can never get close enough to the target)</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a33c4acbb567eb85a4afa7504468d4f53">type</a> = <a class="code" href="structICmpPathfinder_1_1Goal.html#a56759efe217d039b0c3e75fd8bed5ed2a961bc01193c0dc37d49ce65f3e00d93f">ICmpPathfinder::Goal::CIRCLE</a>;</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a1ca6426d0e4b1a6f213c1afa2f6d6c45">x</a> = x;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#aafab18228cd3cc155f04c4bfd34525b3">z</a> = z;</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        <span class="comment">// Formerly added m_Radius, but it seems better to go by the mid-point.</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#abc726e50a5be06efb047fcaac02b81a6">hw</a> = goalDistance;</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    }</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a16e5d08df6279e07afad6649504db5d6">m_State</a> = <a class="code" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a9f1847061a0b7aaf798dab710b013c8a">STATE_INDIVIDUAL_PATH</a>;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a450a4492346d1a7719ae689ef73ec223">m_TargetEntity</a> = <a class="code" href="simulation2_2system_2Entity_8h.html#a1367d00ed40eb3c86920997c86e70b59">INVALID_ENTITY</a>;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a77db8cfdf209c7da59a2317cae3b03b0">m_TargetOffset</a> = <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a>();</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a31f1235e72ec4d199b78e17e31c00328">m_TargetMinRange</a> = minRange;</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#ac7205b6f7d51adeb2ae1c887e8c74f91">m_TargetMaxRange</a> = maxRange;</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">m_FinalGoal</a> = goal;</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#ab047430688adc99a66b6ce63e6a73958">BeginPathing</a>(pos, goal);</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;}</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;</div>
<div class="line"><a name="l01353"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#addcb402597964a3b2211406858b9e8bf"> 1353</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#addcb402597964a3b2211406858b9e8bf">CCmpUnitMotion::IsInPointRange</a>(<a class="code" href="classCFixed.html">entity_pos_t</a> x, <a class="code" href="classCFixed.html">entity_pos_t</a> z, <a class="code" href="classCFixed.html">entity_pos_t</a> minRange, <a class="code" href="classCFixed.html">entity_pos_t</a> maxRange)</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;{</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPosition&gt;</a> cmpPosition(<a class="code" href="classIComponent.html#a67e2894e43dc8d141702644072f3c3ca">GetEntityHandle</a>());</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <span class="keywordflow">if</span> (!cmpPosition || !cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a822657906318eb50ede0ca757c9cbebf">IsInWorld</a>())</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> pos = cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a59f810055dd3dea45b11703a00c6eeb1">GetPosition2D</a>();</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <span class="keywordtype">bool</span> hasObstruction = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpObstructionManager&gt;</a> cmpObstructionManager(<a class="code" href="classIComponent.html#ad24e00d357aade9c7c7973c8303bc618">GetSystemEntity</a>());</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    <a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html">ICmpObstructionManager::ObstructionSquare</a> obstruction;</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <span class="keywordflow">if</span> (cmpObstructionManager)</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;        hasObstruction = cmpObstructionManager-&gt;<a class="code" href="classICmpObstructionManager.html#acee26248d15747cbe5205447aad32d12">FindMostImportantObstruction</a>(<a class="code" href="classCCmpUnitMotion.html#ad61cc0ba26fdfcf76006e4007e00bf72">GetObstructionFilter</a>(<span class="keyword">true</span>), x, z, <a class="code" href="classCCmpUnitMotion.html#a9ebfc4ba23b7c236e2c7ecf4ed6ebb7b">m_Radius</a>, obstruction);</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <span class="keywordflow">if</span> (minRange.<a class="code" href="classCFixed.html#a189317861aacedc60b7d5317cea07f44">IsZero</a>() &amp;&amp; maxRange.<a class="code" href="classCFixed.html#a189317861aacedc60b7d5317cea07f44">IsZero</a>() &amp;&amp; hasObstruction)</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    {</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        <span class="comment">// Handle the non-ranged mode:</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> halfSize(obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a3c7fc08553617b08fd8a1e2daf9ab889">hw</a>, obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a8b0c1584a68e10193569694ad763b48b">hh</a>);</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        <a class="code" href="classCFixed.html">entity_pos_t</a> distance = <a class="code" href="namespaceGeometry.html#a5b9ba13a5e6757ae3da6a575bd95bf52">Geometry::DistanceToSquare</a>(pos - <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a>(obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a8c6359dec3da2420bf4d592228f72e95">x</a>, obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a2066c7cadb51baab72d43e410c6ac399">z</a>), obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a043e0544bb7e58f5418d1c699a48e643">u</a>, obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#abd31b33c563c412e21358fe255ce51d9">v</a>, halfSize);</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        <span class="comment">// See if we&#39;re too close to the target square</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;        <span class="keywordflow">if</span> (distance &lt; minRange)</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        <span class="comment">// See if we&#39;re close enough to the target square</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;        <span class="keywordflow">if</span> (maxRange &lt; <a class="code" href="classCFixed.html#a23fb928093e1e6f43e50c02ad333e12f">entity_pos_t::Zero</a>() || distance &lt;= maxRange)</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    }</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    {</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;        <a class="code" href="classCFixed.html">entity_pos_t</a> distance = (pos - <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a>(x, z)).<a class="code" href="mikktspace_8cpp.html#acbe63d298ee3ff491978b66b68308efc">Length</a>();</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;        <span class="keywordflow">if</span> (distance &lt; minRange)</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;        {</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;        }</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (maxRange &gt;= <a class="code" href="classCFixed.html#a23fb928093e1e6f43e50c02ad333e12f">entity_pos_t::Zero</a>() &amp;&amp; distance &gt; maxRange)</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;        {</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;        }</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;        {</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;        }</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    }</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;}</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;</div>
<div class="line"><a name="l01402"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#ad9745fae3fa07459a54d9e5777e6ec17"> 1402</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#ad9745fae3fa07459a54d9e5777e6ec17">CCmpUnitMotion::ShouldTreatTargetAsCircle</a>(<a class="code" href="classCFixed.html">entity_pos_t</a> range, <a class="code" href="classCFixed.html">entity_pos_t</a> hw, <a class="code" href="classCFixed.html">entity_pos_t</a> hh, <a class="code" href="classCFixed.html">entity_pos_t</a> circleRadius)</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;{</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="comment">// Given a square, plus a target range we should reach, the shape at that distance</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    <span class="comment">// is a round-cornered square which we can approximate as either a circle or as a square.</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    <span class="comment">// Choose the shape that will minimise the worst-case error:</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    <span class="comment">// For a square, error is (sqrt(2)-1) * range at the corners</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    <a class="code" href="classCFixed.html">entity_pos_t</a> errSquare = (<a class="code" href="classCFixed.html#a504183a15db764dc9e5416f7f4916037">entity_pos_t::FromInt</a>(4142)/10000).Multiply(range);</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    <span class="comment">// For a circle, error is radius-hw at the sides and radius-hh at the top/bottom</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <a class="code" href="classCFixed.html">entity_pos_t</a> errCircle = circleRadius - std::min(hw, hh);</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    <span class="keywordflow">return</span> (errCircle &lt; errSquare);</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;}</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;</div>
<div class="line"><a name="l01417"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#ac89d86e77ccc627aadaf3d38e1850034"> 1417</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#ac89d86e77ccc627aadaf3d38e1850034">CCmpUnitMotion::MoveToTargetRange</a>(<a class="code" href="simulation2_2system_2Entity_8h.html#a70961dc0512c70c6de7c8f95d4500260">entity_id_t</a> target, <a class="code" href="classCFixed.html">entity_pos_t</a> minRange, <a class="code" href="classCFixed.html">entity_pos_t</a> maxRange)</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;{</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    <a class="code" href="Profile_8h.html#a6766aaa4b64ace39c242f179d917c746">PROFILE</a>(<span class="stringliteral">&quot;MoveToTargetRange&quot;</span>);</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPosition&gt;</a> cmpPosition(<a class="code" href="classIComponent.html#a67e2894e43dc8d141702644072f3c3ca">GetEntityHandle</a>());</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <span class="keywordflow">if</span> (!cmpPosition || !cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a822657906318eb50ede0ca757c9cbebf">IsInWorld</a>())</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> pos = cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a59f810055dd3dea45b11703a00c6eeb1">GetPosition2D</a>();</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpObstructionManager&gt;</a> cmpObstructionManager(<a class="code" href="classIComponent.html#ad24e00d357aade9c7c7973c8303bc618">GetSystemEntity</a>());</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    <span class="keywordflow">if</span> (!cmpObstructionManager)</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    <span class="keywordtype">bool</span> hasObstruction = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html">ICmpObstructionManager::ObstructionSquare</a> obstruction;</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpObstruction&gt;</a> cmpObstruction(<a class="code" href="classIComponent.html#adecb3e6a4da223d0b028401b8519c424">GetSimContext</a>(), target);</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    <span class="keywordflow">if</span> (cmpObstruction)</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        hasObstruction = cmpObstruction-&gt;<a class="code" href="classICmpObstruction.html#a1d209c77994fe29f576199f20329b323">GetObstructionSquare</a>(obstruction);</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="comment">     * If we&#39;re starting outside the maxRange, we need to move closer in.</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;<span class="comment">     * If we&#39;re starting inside the minRange, we need to move further out.</span></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;<span class="comment">     * These ranges are measured from the center of this entity to the edge of the target;</span></div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="comment">     * we add the goal range onto the size of the target shape to get the goal shape.</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;<span class="comment">     * (Then we extend it outwards/inwards by a little bit to be sure we&#39;ll end up</span></div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="comment">     * within the right range, in case of minor numerical inaccuracies.)</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="comment">     * There&#39;s a bit of a problem with large square targets:</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="comment">     * the pathfinder only lets us move to goals that are squares, but the points an equal</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="comment">     * distance from the target make a rounded square shape instead.</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;<span class="comment">     * When moving closer, we could shrink the goal radius to 1/sqrt(2) so the goal shape fits entirely</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="comment">     * within the desired rounded square, but that gives an unfair advantage to attackers who approach</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;<span class="comment">     * the target diagonally.</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;<span class="comment">     * If the target is small relative to the range (e.g. archers attacking anything),</span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;<span class="comment">     * then we cheat and pretend the target is actually a circle.</span></div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="comment">     * (TODO: that probably looks rubbish for things like walls?)</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="comment">     * If the target is large relative to the range (e.g. melee units attacking buildings),</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="comment">     * then we multiply maxRange by approx 1/sqrt(2) to guarantee they&#39;ll always aim close enough.</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="comment">     * (Those units should set minRange to 0 so they&#39;ll never be considered *too* close.)</span></div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <span class="keywordflow">if</span> (hasObstruction)</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    {</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> halfSize(obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a3c7fc08553617b08fd8a1e2daf9ab889">hw</a>, obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a8b0c1584a68e10193569694ad763b48b">hh</a>);</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;        <a class="code" href="structICmpPathfinder_1_1Goal.html">ICmpPathfinder::Goal</a> goal;</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;        goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a1ca6426d0e4b1a6f213c1afa2f6d6c45">x</a> = obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a8c6359dec3da2420bf4d592228f72e95">x</a>;</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;        goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#aafab18228cd3cc155f04c4bfd34525b3">z</a> = obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a2066c7cadb51baab72d43e410c6ac399">z</a>;</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;        <a class="code" href="classCFixed.html">entity_pos_t</a> distance = <a class="code" href="namespaceGeometry.html#a5b9ba13a5e6757ae3da6a575bd95bf52">Geometry::DistanceToSquare</a>(pos - <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a>(obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a8c6359dec3da2420bf4d592228f72e95">x</a>, obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a2066c7cadb51baab72d43e410c6ac399">z</a>), obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a043e0544bb7e58f5418d1c699a48e643">u</a>, obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#abd31b33c563c412e21358fe255ce51d9">v</a>, halfSize);</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        <span class="keywordflow">if</span> (distance &lt; minRange)</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        {</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;            <span class="comment">// Too close to the square - need to move away</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;            <span class="comment">// TODO: maybe we should do the ShouldTreatTargetAsCircle thing here?</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;            <a class="code" href="classCFixed.html">entity_pos_t</a> goalDistance = minRange + <a class="code" href="CCmpUnitMotion_8cpp.html#ab2c6620256cf5c2e37cf150b2a4f8063">g_GoalDelta</a>;</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;            goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a33c4acbb567eb85a4afa7504468d4f53">type</a> = <a class="code" href="structICmpPathfinder_1_1Goal.html#a56759efe217d039b0c3e75fd8bed5ed2ae7f0a446ab32d214949b2aa73f76916c">ICmpPathfinder::Goal::SQUARE</a>;</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;            goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a689861f0cfc43726913e0bd24f8d4fd4">u</a> = obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a043e0544bb7e58f5418d1c699a48e643">u</a>;</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;            goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#abb32cc00a6aca6f3aeeca0a8ce6ab7ee">v</a> = obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#abd31b33c563c412e21358fe255ce51d9">v</a>;</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;            <a class="code" href="classCFixed.html">entity_pos_t</a> delta = std::max(goalDistance, <a class="code" href="classCCmpUnitMotion.html#a9ebfc4ba23b7c236e2c7ecf4ed6ebb7b">m_Radius</a> + <a class="code" href="classCFixed.html#a504183a15db764dc9e5416f7f4916037">entity_pos_t::FromInt</a>(<a class="code" href="Terrain_8h.html#afa474c073f2fd8de9f0aace0d023d026">TERRAIN_TILE_SIZE</a>)/16); <span class="comment">// ensure it&#39;s far enough to not intersect the building itself</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;            goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#abc726e50a5be06efb047fcaac02b81a6">hw</a> = obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a3c7fc08553617b08fd8a1e2daf9ab889">hw</a> + delta;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;            goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a7b61b4e42da891cd8b8dc1f90b37021e">hh</a> = obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a8b0c1584a68e10193569694ad763b48b">hh</a> + delta;</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        }</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (maxRange &lt; <a class="code" href="classCFixed.html#a23fb928093e1e6f43e50c02ad333e12f">entity_pos_t::Zero</a>() || distance &lt; maxRange)</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        {</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;            <span class="comment">// We&#39;re already in range - no need to move anywhere</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#ab238b2fb474eabc0707fea7c2e97efc1">m_FacePointAfterMove</a>)</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;                <a class="code" href="classCCmpUnitMotion.html#a251b047d9350fa8cbe8e036fe8cdd0ba">FaceTowardsPointFromPos</a>(pos, goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a1ca6426d0e4b1a6f213c1afa2f6d6c45">x</a>, goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#aafab18228cd3cc155f04c4bfd34525b3">z</a>);</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        }</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        {</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;            <span class="comment">// We might need to move closer:</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;            <span class="comment">// Circumscribe the square</span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;            <a class="code" href="classCFixed.html">entity_pos_t</a> circleRadius = halfSize.<a class="code" href="classCFixedVector2D.html#a55fcaadc177fb4bd7fcde641cbe32deb">Length</a>();</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#ad9745fae3fa07459a54d9e5777e6ec17">ShouldTreatTargetAsCircle</a>(maxRange, obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a3c7fc08553617b08fd8a1e2daf9ab889">hw</a>, obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a8b0c1584a68e10193569694ad763b48b">hh</a>, circleRadius))</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;            {</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;                <span class="comment">// The target is small relative to our range, so pretend it&#39;s a circle</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;                <span class="comment">// Note that the distance to the circle will always be less than</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;                <span class="comment">// the distance to the square, so the previous &quot;distance &lt; maxRange&quot;</span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;                <span class="comment">// check is still valid (though not sufficient)</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;                <a class="code" href="classCFixed.html">entity_pos_t</a> circleDistance = (pos - <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a>(obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a8c6359dec3da2420bf4d592228f72e95">x</a>, obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a2066c7cadb51baab72d43e410c6ac399">z</a>)).<a class="code" href="mikktspace_8cpp.html#acbe63d298ee3ff491978b66b68308efc">Length</a>() - circleRadius;</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;                <span class="keywordflow">if</span> (circleDistance &lt; maxRange)</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;                {</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;                    <span class="comment">// We&#39;re already in range - no need to move anywhere</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#ab238b2fb474eabc0707fea7c2e97efc1">m_FacePointAfterMove</a>)</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;                        <a class="code" href="classCCmpUnitMotion.html#a251b047d9350fa8cbe8e036fe8cdd0ba">FaceTowardsPointFromPos</a>(pos, goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a1ca6426d0e4b1a6f213c1afa2f6d6c45">x</a>, goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#aafab18228cd3cc155f04c4bfd34525b3">z</a>);</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;                }</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;                <a class="code" href="classCFixed.html">entity_pos_t</a> goalDistance = maxRange - <a class="code" href="CCmpUnitMotion_8cpp.html#ab2c6620256cf5c2e37cf150b2a4f8063">g_GoalDelta</a>;</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;                goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a33c4acbb567eb85a4afa7504468d4f53">type</a> = <a class="code" href="structICmpPathfinder_1_1Goal.html#a56759efe217d039b0c3e75fd8bed5ed2a961bc01193c0dc37d49ce65f3e00d93f">ICmpPathfinder::Goal::CIRCLE</a>;</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;                goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#abc726e50a5be06efb047fcaac02b81a6">hw</a> = circleRadius + goalDistance;</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;            }</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;            {</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;                <span class="comment">// The target is large relative to our range, so treat it as a square and</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;                <span class="comment">// get close enough that the diagonals come within range</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;                <a class="code" href="classCFixed.html">entity_pos_t</a> goalDistance = (maxRange - <a class="code" href="CCmpUnitMotion_8cpp.html#ab2c6620256cf5c2e37cf150b2a4f8063">g_GoalDelta</a>)*2 / 3; <span class="comment">// multiply by slightly less than 1/sqrt(2)</span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;                goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a33c4acbb567eb85a4afa7504468d4f53">type</a> = <a class="code" href="structICmpPathfinder_1_1Goal.html#a56759efe217d039b0c3e75fd8bed5ed2ae7f0a446ab32d214949b2aa73f76916c">ICmpPathfinder::Goal::SQUARE</a>;</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;                goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a689861f0cfc43726913e0bd24f8d4fd4">u</a> = obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a043e0544bb7e58f5418d1c699a48e643">u</a>;</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;                goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#abb32cc00a6aca6f3aeeca0a8ce6ab7ee">v</a> = obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#abd31b33c563c412e21358fe255ce51d9">v</a>;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;                <a class="code" href="classCFixed.html">entity_pos_t</a> delta = std::max(goalDistance, <a class="code" href="classCCmpUnitMotion.html#a9ebfc4ba23b7c236e2c7ecf4ed6ebb7b">m_Radius</a> + <a class="code" href="classCFixed.html#a504183a15db764dc9e5416f7f4916037">entity_pos_t::FromInt</a>(<a class="code" href="Terrain_8h.html#afa474c073f2fd8de9f0aace0d023d026">TERRAIN_TILE_SIZE</a>)/16); <span class="comment">// ensure it&#39;s far enough to not intersect the building itself</span></div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;                goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#abc726e50a5be06efb047fcaac02b81a6">hw</a> = obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a3c7fc08553617b08fd8a1e2daf9ab889">hw</a> + delta;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;                goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a7b61b4e42da891cd8b8dc1f90b37021e">hh</a> = obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a8b0c1584a68e10193569694ad763b48b">hh</a> + delta;</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;            }</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;        }</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a16e5d08df6279e07afad6649504db5d6">m_State</a> = <a class="code" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a9f1847061a0b7aaf798dab710b013c8a">STATE_INDIVIDUAL_PATH</a>;</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a450a4492346d1a7719ae689ef73ec223">m_TargetEntity</a> = target;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a77db8cfdf209c7da59a2317cae3b03b0">m_TargetOffset</a> = <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a>();</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a31f1235e72ec4d199b78e17e31c00328">m_TargetMinRange</a> = minRange;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#ac7205b6f7d51adeb2ae1c887e8c74f91">m_TargetMaxRange</a> = maxRange;</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">m_FinalGoal</a> = goal;</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;        <a class="code" href="classCCmpUnitMotion.html#ab047430688adc99a66b6ce63e6a73958">BeginPathing</a>(pos, goal);</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    }</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    {</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;        <span class="comment">// The target didn&#39;t have an obstruction or obstruction shape, so treat it as a point instead</span></div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;        <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPosition&gt;</a> cmpTargetPosition(<a class="code" href="classIComponent.html#adecb3e6a4da223d0b028401b8519c424">GetSimContext</a>(), target);</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        <span class="keywordflow">if</span> (!cmpTargetPosition || !cmpTargetPosition-&gt;<a class="code" href="classICmpPosition.html#a822657906318eb50ede0ca757c9cbebf">IsInWorld</a>())</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;        <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> targetPos = cmpTargetPosition-&gt;<a class="code" href="classICmpPosition.html#a59f810055dd3dea45b11703a00c6eeb1">GetPosition2D</a>();</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classCCmpUnitMotion.html#afc440aaae4b07016e3d07a50b821074d">MoveToPointRange</a>(targetPos.<a class="code" href="classCFixedVector2D.html#a0014c0852a3007df5a249653ed2453db">X</a>, targetPos.<a class="code" href="classCFixedVector2D.html#a814f82a51edea75e7066d03663c33d8f">Y</a>, minRange, maxRange);</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    }</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;}</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;</div>
<div class="line"><a name="l01563"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a96ee6c4ce3cbe23a59cae462349df890"> 1563</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classCCmpUnitMotion.html#a96ee6c4ce3cbe23a59cae462349df890">CCmpUnitMotion::IsInTargetRange</a>(<a class="code" href="simulation2_2system_2Entity_8h.html#a70961dc0512c70c6de7c8f95d4500260">entity_id_t</a> target, <a class="code" href="classCFixed.html">entity_pos_t</a> minRange, <a class="code" href="classCFixed.html">entity_pos_t</a> maxRange)</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;{</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    <span class="comment">// This function closely mirrors MoveToTargetRange - it needs to return true</span></div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <span class="comment">// after that Move has completed</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPosition&gt;</a> cmpPosition(<a class="code" href="classIComponent.html#a67e2894e43dc8d141702644072f3c3ca">GetEntityHandle</a>());</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <span class="keywordflow">if</span> (!cmpPosition || !cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a822657906318eb50ede0ca757c9cbebf">IsInWorld</a>())</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> pos = cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a59f810055dd3dea45b11703a00c6eeb1">GetPosition2D</a>();</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpObstructionManager&gt;</a> cmpObstructionManager(<a class="code" href="classIComponent.html#ad24e00d357aade9c7c7973c8303bc618">GetSystemEntity</a>());</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    <span class="keywordflow">if</span> (!cmpObstructionManager)</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    <span class="keywordtype">bool</span> hasObstruction = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    <a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html">ICmpObstructionManager::ObstructionSquare</a> obstruction;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpObstruction&gt;</a> cmpObstruction(<a class="code" href="classIComponent.html#adecb3e6a4da223d0b028401b8519c424">GetSimContext</a>(), target);</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <span class="keywordflow">if</span> (cmpObstruction)</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;        hasObstruction = cmpObstruction-&gt;<a class="code" href="classICmpObstruction.html#a1d209c77994fe29f576199f20329b323">GetObstructionSquare</a>(obstruction);</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    <span class="keywordflow">if</span> (hasObstruction)</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    {</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;        <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> halfSize(obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a3c7fc08553617b08fd8a1e2daf9ab889">hw</a>, obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a8b0c1584a68e10193569694ad763b48b">hh</a>);</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;        <a class="code" href="classCFixed.html">entity_pos_t</a> distance = <a class="code" href="namespaceGeometry.html#a5b9ba13a5e6757ae3da6a575bd95bf52">Geometry::DistanceToSquare</a>(pos - <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a>(obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a8c6359dec3da2420bf4d592228f72e95">x</a>, obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a2066c7cadb51baab72d43e410c6ac399">z</a>), obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a043e0544bb7e58f5418d1c699a48e643">u</a>, obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#abd31b33c563c412e21358fe255ce51d9">v</a>, halfSize);</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;        <span class="comment">// See if we&#39;re too close to the target square</span></div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;        <span class="keywordflow">if</span> (distance &lt; minRange)</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        <span class="comment">// See if we&#39;re close enough to the target square</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        <span class="keywordflow">if</span> (maxRange &lt; <a class="code" href="classCFixed.html#a23fb928093e1e6f43e50c02ad333e12f">entity_pos_t::Zero</a>() || distance &lt;= maxRange)</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;        <a class="code" href="classCFixed.html">entity_pos_t</a> circleRadius = halfSize.<a class="code" href="classCFixedVector2D.html#a55fcaadc177fb4bd7fcde641cbe32deb">Length</a>();</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classCCmpUnitMotion.html#ad9745fae3fa07459a54d9e5777e6ec17">ShouldTreatTargetAsCircle</a>(maxRange, obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a3c7fc08553617b08fd8a1e2daf9ab889">hw</a>, obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a8b0c1584a68e10193569694ad763b48b">hh</a>, circleRadius))</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;        {</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;            <span class="comment">// The target is small relative to our range, so pretend it&#39;s a circle</span></div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;            <span class="comment">// and see if we&#39;re close enough to that</span></div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;            <a class="code" href="classCFixed.html">entity_pos_t</a> circleDistance = (pos - <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a>(obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a8c6359dec3da2420bf4d592228f72e95">x</a>, obstruction.<a class="code" href="structICmpObstructionManager_1_1ObstructionSquare.html#a2066c7cadb51baab72d43e410c6ac399">z</a>)).<a class="code" href="mikktspace_8cpp.html#acbe63d298ee3ff491978b66b68308efc">Length</a>() - circleRadius;</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;            <span class="keywordflow">if</span> (circleDistance &lt;= maxRange)</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;        }</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    }</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    {</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;        <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPosition&gt;</a> cmpTargetPosition(<a class="code" href="classIComponent.html#adecb3e6a4da223d0b028401b8519c424">GetSimContext</a>(), target);</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        <span class="keywordflow">if</span> (!cmpTargetPosition || !cmpTargetPosition-&gt;<a class="code" href="classICmpPosition.html#a822657906318eb50ede0ca757c9cbebf">IsInWorld</a>())</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;        <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> targetPos = cmpTargetPosition-&gt;<a class="code" href="classICmpPosition.html#a59f810055dd3dea45b11703a00c6eeb1">GetPosition2D</a>();</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;        <a class="code" href="classCFixed.html">entity_pos_t</a> distance = (pos - targetPos).<a class="code" href="mikktspace_8cpp.html#acbe63d298ee3ff491978b66b68308efc">Length</a>();</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;        <span class="keywordflow">if</span> (minRange &lt;= distance &amp;&amp; (maxRange &lt; <a class="code" href="classCFixed.html#a23fb928093e1e6f43e50c02ad333e12f">entity_pos_t::Zero</a>() || distance &lt;= maxRange))</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    }</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;}</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;</div>
<div class="line"><a name="l01629"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#ae4be8cae9512c2bc3fca01238366b138"> 1629</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#ae4be8cae9512c2bc3fca01238366b138">CCmpUnitMotion::MoveToFormationOffset</a>(<a class="code" href="simulation2_2system_2Entity_8h.html#a70961dc0512c70c6de7c8f95d4500260">entity_id_t</a> target, <a class="code" href="classCFixed.html">entity_pos_t</a> x, <a class="code" href="classCFixed.html">entity_pos_t</a> z)</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;{</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPosition&gt;</a> cmpPosition(<a class="code" href="classIComponent.html#adecb3e6a4da223d0b028401b8519c424">GetSimContext</a>(), target);</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    <span class="keywordflow">if</span> (!cmpPosition || !cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a822657906318eb50ede0ca757c9cbebf">IsInWorld</a>())</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a> pos = cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a59f810055dd3dea45b11703a00c6eeb1">GetPosition2D</a>();</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    <a class="code" href="structICmpPathfinder_1_1Goal.html">ICmpPathfinder::Goal</a> goal;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a33c4acbb567eb85a4afa7504468d4f53">type</a> = <a class="code" href="structICmpPathfinder_1_1Goal.html#a56759efe217d039b0c3e75fd8bed5ed2a0f92429c19d8f061aa5bc6efb7d51ac8">ICmpPathfinder::Goal::POINT</a>;</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#a1ca6426d0e4b1a6f213c1afa2f6d6c45">x</a> = pos.<a class="code" href="classCFixedVector2D.html#a0014c0852a3007df5a249653ed2453db">X</a>;</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    goal.<a class="code" href="structICmpPathfinder_1_1Goal.html#aafab18228cd3cc155f04c4bfd34525b3">z</a> = pos.<a class="code" href="classCFixedVector2D.html#a814f82a51edea75e7066d03663c33d8f">Y</a>;</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a16e5d08df6279e07afad6649504db5d6">m_State</a> = <a class="code" href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a78b9f8c8a2e428e2032a90ccace9a78d">STATE_FORMATIONMEMBER_PATH</a>;</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a450a4492346d1a7719ae689ef73ec223">m_TargetEntity</a> = target;</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a77db8cfdf209c7da59a2317cae3b03b0">m_TargetOffset</a> = <a class="code" href="classCFixedVector2D.html">CFixedVector2D</a>(x, z);</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a31f1235e72ec4d199b78e17e31c00328">m_TargetMinRange</a> = <a class="code" href="classCFixed.html#a23fb928093e1e6f43e50c02ad333e12f">entity_pos_t::Zero</a>();</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#ac7205b6f7d51adeb2ae1c887e8c74f91">m_TargetMaxRange</a> = <a class="code" href="classCFixed.html#a23fb928093e1e6f43e50c02ad333e12f">entity_pos_t::Zero</a>();</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">m_FinalGoal</a> = goal;</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#ab047430688adc99a66b6ce63e6a73958">BeginPathing</a>(pos, goal);</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;}</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;</div>
<div class="line"><a name="l01656"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a4c9674f431deba1076d4f0e36ae9744f"> 1656</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a4c9674f431deba1076d4f0e36ae9744f">CCmpUnitMotion::RenderPath</a>(<span class="keyword">const</span> <a class="code" href="structICmpPathfinder_1_1Path.html">ICmpPathfinder::Path</a>&amp; path, std::vector&lt;SOverlayLine&gt;&amp; lines, <a class="code" href="structCColor.html">CColor</a> color)</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;{</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    <span class="keywordtype">bool</span> floating = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <a class="code" href="classCmpPtr.html">CmpPtr&lt;ICmpPosition&gt;</a> cmpPosition(<a class="code" href="classIComponent.html#a67e2894e43dc8d141702644072f3c3ca">GetEntityHandle</a>());</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    <span class="keywordflow">if</span> (cmpPosition)</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        floating = cmpPosition-&gt;<a class="code" href="classICmpPosition.html#a2bac72ab929078355ea08e64cb2b1f0c">IsFloating</a>();</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;    lines.clear();</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    std::vector&lt;float&gt; waypointCoords;</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; path.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>.size(); ++i)</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;    {</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;        <span class="keywordtype">float</span> x = path.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>[i].x.ToFloat();</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;        <span class="keywordtype">float</span> z = path.<a class="code" href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">m_Waypoints</a>[i].z.ToFloat();</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        waypointCoords.push_back(x);</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;        waypointCoords.push_back(z);</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;        lines.push_back(<a class="code" href="structSOverlayLine.html">SOverlayLine</a>());</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        lines.back().m_Color = color;</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;        <a class="code" href="namespaceSimRender.html#a1501f3f2b57f9aab2263a226a73b39f9">SimRender::ConstructSquareOnGround</a>(<a class="code" href="classIComponent.html#adecb3e6a4da223d0b028401b8519c424">GetSimContext</a>(), x, z, 1.0f, 1.0f, 0.0f, lines.back(), floating);</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;    }</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    lines.push_back(<a class="code" href="structSOverlayLine.html">SOverlayLine</a>());</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;    lines.back().m_Color = color;</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    <a class="code" href="namespaceSimRender.html#ac4ca10b2735aa8e5acf696dc4c730fcd">SimRender::ConstructLineOnGround</a>(<a class="code" href="classIComponent.html#adecb3e6a4da223d0b028401b8519c424">GetSimContext</a>(), waypointCoords, lines.back(), floating);</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;}</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;</div>
<div class="line"><a name="l01681"></a><span class="lineno"><a class="line" href="classCCmpUnitMotion.html#a5fae9b253856b7ccfa785a388fa4a8ef"> 1681</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classCCmpUnitMotion.html#a5fae9b253856b7ccfa785a388fa4a8ef">CCmpUnitMotion::RenderSubmit</a>(<a class="code" href="classSceneCollector.html">SceneCollector</a>&amp; collector)</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;{</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classCCmpUnitMotion.html#a81ec5b62fa9271f89491dec73690062a">m_DebugOverlayEnabled</a>)</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a4c9674f431deba1076d4f0e36ae9744f">RenderPath</a>(<a class="code" href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">m_LongPath</a>, <a class="code" href="classCCmpUnitMotion.html#a882244efda407ab44364464359187860">m_DebugOverlayLongPathLines</a>, <a class="code" href="CCmpUnitMotion_8cpp.html#a5a1d29d82321920b3d9d216f12662e3f">OVERLAY_COLOUR_LONG_PATH</a>);</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    <a class="code" href="classCCmpUnitMotion.html#a4c9674f431deba1076d4f0e36ae9744f">RenderPath</a>(<a class="code" href="classCCmpUnitMotion.html#a1198bb1bc6d082ea3a4cc5432d30249d">m_ShortPath</a>, <a class="code" href="classCCmpUnitMotion.html#a80b08f69fe05b1bd23b48934c6b76774">m_DebugOverlayShortPathLines</a>, <a class="code" href="CCmpUnitMotion_8cpp.html#ae834109294e10f1dfb96d13ce8d164de">OVERLAY_COLOUR_SHORT_PATH</a>);</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="classCCmpUnitMotion.html#a882244efda407ab44364464359187860">m_DebugOverlayLongPathLines</a>.size(); ++i)</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;        collector.<a class="code" href="classSceneCollector.html#add461437a15a8d5bfabe39f7104f6741">Submit</a>(&amp;<a class="code" href="classCCmpUnitMotion.html#a882244efda407ab44364464359187860">m_DebugOverlayLongPathLines</a>[i]);</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="classCCmpUnitMotion.html#a80b08f69fe05b1bd23b48934c6b76774">m_DebugOverlayShortPathLines</a>.size(); ++i)</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;        collector.<a class="code" href="classSceneCollector.html#add461437a15a8d5bfabe39f7104f6741">Submit</a>(&amp;<a class="code" href="classCCmpUnitMotion.html#a80b08f69fe05b1bd23b48934c6b76774">m_DebugOverlayShortPathLines</a>[i]);</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;}</div>
<div class="ttc" id="classCFixedVector2D_html_abae1ab91b32a58fd19ee10260b5eedac"><div class="ttname"><a href="classCFixedVector2D.html#abae1ab91b32a58fd19ee10260b5eedac">CFixedVector2D::CompareLength</a></div><div class="ttdeci">int CompareLength(fixed cmp) const </div><div class="ttdoc">Returns -1, 0, +1 depending on whether length is less/equal/greater than the argument. </div><div class="ttdef"><b>Definition:</b> <a href="FixedVector2D_8h_source.html#l00118">FixedVector2D.h:118</a></div></div>
<div class="ttc" id="classCParamNode_html"><div class="ttname"><a href="classCParamNode.html">CParamNode</a></div><div class="ttdoc">An entity initialisation parameter node. </div><div class="ttdef"><b>Definition:</b> <a href="ParamNode_8h_source.html#l00112">ParamNode.h:112</a></div></div>
<div class="ttc" id="classICmpPathfinder_html_ad28fbc71b9ad696be596167dfe3ab075"><div class="ttname"><a href="classICmpPathfinder.html#ad28fbc71b9ad696be596167dfe3ab075">ICmpPathfinder::GetPassabilityClass</a></div><div class="ttdeci">virtual pass_class_t GetPassabilityClass(const std::string &amp;name)=0</div><div class="ttdoc">Get the tag for a given passability class name. </div></div>
<div class="ttc" id="MessageTypes_8h_html"><div class="ttname"><a href="MessageTypes_8h.html">MessageTypes.h</a></div></div>
<div class="ttc" id="classCComponentManager_html_abfcc0c9a12e231dbe538783cad1cc63d"><div class="ttname"><a href="classCComponentManager.html#abfcc0c9a12e231dbe538783cad1cc63d">CComponentManager::SubscribeToMessageType</a></div><div class="ttdeci">void SubscribeToMessageType(MessageTypeId mtid)</div><div class="ttdoc">Subscribe the current component type to the given message type. </div><div class="ttdef"><b>Definition:</b> <a href="ComponentManager_8cpp_source.html#l00508">ComponentManager.cpp:508</a></div></div>
<div class="ttc" id="classCMessageUpdate__MotionFormation_html"><div class="ttname"><a href="classCMessageUpdate__MotionFormation.html">CMessageUpdate_MotionFormation</a></div><div class="ttdoc">Update phase for formation controller movement (must happen before individual units move to follow th...</div><div class="ttdef"><b>Definition:</b> <a href="MessageTypes_8h_source.html#l00074">MessageTypes.h:74</a></div></div>
<div class="ttc" id="types_8h_html_af3b86d961da0a3575b4f99c9ffaf01fd"><div class="ttname"><a href="types_8h.html#af3b86d961da0a3575b4f99c9ffaf01fd">u8</a></div><div class="ttdeci">#define u8</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00039">types.h:39</a></div></div>
<div class="ttc" id="classCFixed_html"><div class="ttname"><a href="classCFixed.html">CFixed</a></div><div class="ttdoc">A simple fixed-point number class. </div><div class="ttdef"><b>Definition:</b> <a href="Fixed_8h_source.html#l00115">Fixed.h:115</a></div></div>
<div class="ttc" id="CCmpUnitMotion_8cpp_html_a580d143b9834c15fce9789b2f0dcc531"><div class="ttname"><a href="CCmpUnitMotion_8cpp.html#a580d143b9834c15fce9789b2f0dcc531">WAYPOINT_ADVANCE_LOOKAHEAD_TURNS</a></div><div class="ttdeci">static const int WAYPOINT_ADVANCE_LOOKAHEAD_TURNS</div><div class="ttdoc">When advancing along the long path, we&amp;#39;ll pick a new waypoint to move towards if we expect to reach t...</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00055">CCmpUnitMotion.cpp:55</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_ad2c2616dd169076445bbf30a86d007a1"><div class="ttname"><a href="classCCmpUnitMotion.html#ad2c2616dd169076445bbf30a86d007a1">CCmpUnitMotion::PathResult</a></div><div class="ttdeci">void PathResult(u32 ticket, const ICmpPathfinder::Path &amp;path)</div><div class="ttdoc">Handle the result of an asynchronous path query. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00609">CCmpUnitMotion.cpp:609</a></div></div>
<div class="ttc" id="ICmpObstruction_8h_html"><div class="ttname"><a href="ICmpObstruction_8h.html">ICmpObstruction.h</a></div></div>
<div class="ttc" id="structICmpObstructionManager_1_1ObstructionSquare_html_a8c6359dec3da2420bf4d592228f72e95"><div class="ttname"><a href="structICmpObstructionManager_1_1ObstructionSquare.html#a8c6359dec3da2420bf4d592228f72e95">ICmpObstructionManager::ObstructionSquare::x</a></div><div class="ttdeci">entity_pos_t x</div><div class="ttdef"><b>Definition:</b> <a href="ICmpObstructionManager_8h_source.html#l00234">ICmpObstructionManager.h:234</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a519d300430e5ce527bd02300a76ea41b"><div class="ttname"><a href="classCCmpUnitMotion.html#a519d300430e5ce527bd02300a76ea41b">CCmpUnitMotion::ShouldAvoidMovingUnits</a></div><div class="ttdeci">bool ShouldAvoidMovingUnits()</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00469">CCmpUnitMotion.cpp:469</a></div></div>
<div class="ttc" id="Component_8h_html_abd6c342028e45948a03b331b417cb428"><div class="ttname"><a href="Component_8h.html#abd6c342028e45948a03b331b417cb428">REGISTER_COMPONENT_TYPE</a></div><div class="ttdeci">#define REGISTER_COMPONENT_TYPE(cname)</div><div class="ttdef"><b>Definition:</b> <a href="Component_8h_source.html#l00030">Component.h:30</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a6fe8d827c086999f1a7ffa4f4047a450"><div class="ttname"><a href="classCCmpUnitMotion.html#a6fe8d827c086999f1a7ffa4f4047a450">CCmpUnitMotion::RequestShortPath</a></div><div class="ttdeci">void RequestShortPath(CFixedVector2D from, const ICmpPathfinder::Goal &amp;goal, bool avoidMovingUnits)</div><div class="ttdoc">Start an asynchronous short path query. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01206">CCmpUnitMotion.cpp:1206</a></div></div>
<div class="ttc" id="FixedVector2D_8h_html"><div class="ttname"><a href="FixedVector2D_8h.html">FixedVector2D.h</a></div></div>
<div class="ttc" id="SerializeTemplates_8h_html"><div class="ttname"><a href="SerializeTemplates_8h.html">SerializeTemplates.h</a></div><div class="ttdoc">Helper templates for serializing/deserializing common objects. </div></div>
<div class="ttc" id="classCCmpUnitMotion_html_ae002a4d685954f03eaccd8a4c3be6fed"><div class="ttname"><a href="classCCmpUnitMotion.html#ae002a4d685954f03eaccd8a4c3be6fed">CCmpUnitMotion::m_LongPath</a></div><div class="ttdeci">ICmpPathfinder::Path m_LongPath</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00237">CCmpUnitMotion.cpp:237</a></div></div>
<div class="ttc" id="classCFixedVector2D_html"><div class="ttname"><a href="classCFixedVector2D.html">CFixedVector2D</a></div><div class="ttdef"><b>Definition:</b> <a href="FixedVector2D_8h_source.html#l00024">FixedVector2D.h:24</a></div></div>
<div class="ttc" id="ICmpOwnership_8h_html"><div class="ttname"><a href="ICmpOwnership_8h.html">ICmpOwnership.h</a></div></div>
<div class="ttc" id="classICmpPathfinder_html_a9e2cf45d663912a8800d32165fd10c91"><div class="ttname"><a href="classICmpPathfinder.html#a9e2cf45d663912a8800d32165fd10c91">ICmpPathfinder::pass_class_t</a></div><div class="ttdeci">u16 pass_class_t</div><div class="ttdef"><b>Definition:</b> <a href="ICmpPathfinder_8h_source.html#l00051">ICmpPathfinder.h:51</a></div></div>
<div class="ttc" id="code__annotation_8h_html_a3e5bd53e9de4078ded1bf077b019a131"><div class="ttname"><a href="code__annotation_8h.html#a3e5bd53e9de4078ded1bf077b019a131">UNUSED</a></div><div class="ttdeci">#define UNUSED(param)</div><div class="ttdoc">mark a function parameter as unused and avoid the corresponding compiler warning. ...</div><div class="ttdef"><b>Definition:</b> <a href="code__annotation_8h_source.html#l00038">code_annotation.h:38</a></div></div>
<div class="ttc" id="structSOverlayLine_html"><div class="ttname"><a href="structSOverlayLine.html">SOverlayLine</a></div><div class="ttdoc">Line-based overlay, with world-space coordinates, rendered in the world potentially behind other obje...</div><div class="ttdef"><b>Definition:</b> <a href="graphics_2Overlay_8h_source.html#l00036">Overlay.h:36</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_ad61cc0ba26fdfcf76006e4007e00bf72"><div class="ttname"><a href="classCCmpUnitMotion.html#ad61cc0ba26fdfcf76006e4007e00bf72">CCmpUnitMotion::GetObstructionFilter</a></div><div class="ttdeci">ControlGroupMovementObstructionFilter GetObstructionFilter(bool forceAvoidMovingUnits=false)</div><div class="ttdoc">Returns an appropriate obstruction filter for use with path requests. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01148">CCmpUnitMotion.cpp:1148</a></div></div>
<div class="ttc" id="classCParamNode_html_a4751986df18f1ef18f03d90c2c48008a"><div class="ttname"><a href="classCParamNode.html#a4751986df18f1ef18f03d90c2c48008a">CParamNode::ToBool</a></div><div class="ttdeci">bool ToBool() const </div><div class="ttdoc">Parses the content of this node as a boolean (&amp;quot;true&amp;quot; == true, anything else == false) ...</div><div class="ttdef"><b>Definition:</b> <a href="ParamNode_8cpp_source.html#l00236">ParamNode.cpp:236</a></div></div>
<div class="ttc" id="structICmpPathfinder_1_1Goal_html_abb32cc00a6aca6f3aeeca0a8ce6ab7ee"><div class="ttname"><a href="structICmpPathfinder_1_1Goal.html#abb32cc00a6aca6f3aeeca0a8ce6ab7ee">ICmpPathfinder::Goal::v</a></div><div class="ttdeci">CFixedVector2D v</div><div class="ttdef"><b>Definition:</b> <a href="ICmpPathfinder_8h_source.html#l00062">ICmpPathfinder.h:62</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_af00dcfe76180ea96cec7adb5b07bfa58aa12b5b4dbb37b9ce98540bf3e609e710"><div class="ttname"><a href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58aa12b5b4dbb37b9ce98540bf3e609e710">CCmpUnitMotion::PATHSTATE_WAITING_REQUESTING_LONG</a></div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00178">CCmpUnitMotion.cpp:178</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a390db59a135c5962aee81aa80e00855d"><div class="ttname"><a href="classCCmpUnitMotion.html#a390db59a135c5962aee81aa80e00855d">CCmpUnitMotion::Deserialize</a></div><div class="ttdeci">virtual void Deserialize(const CParamNode &amp;paramNode, IDeserializer &amp;deserialize)</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00361">CCmpUnitMotion.cpp:361</a></div></div>
<div class="ttc" id="classICmpPathfinder_html_af9725da0bbc1a953bec1d3124484bec6"><div class="ttname"><a href="classICmpPathfinder.html#af9725da0bbc1a953bec1d3124484bec6">ICmpPathfinder::ComputeShortPathAsync</a></div><div class="ttdeci">virtual u32 ComputeShortPathAsync(entity_pos_t x0, entity_pos_t z0, entity_pos_t r, entity_pos_t range, const Goal &amp;goal, pass_class_t passClass, bool avoidMovingUnits, entity_id_t group, entity_id_t notify)=0</div><div class="ttdoc">Asynchronous version of ComputeShortPath (using ControlGroupObstructionFilter). </div></div>
<div class="ttc" id="classCFixed_html_a23fb928093e1e6f43e50c02ad333e12f"><div class="ttname"><a href="classCFixed.html#a23fb928093e1e6f43e50c02ad333e12f">CFixed::Zero</a></div><div class="ttdeci">static CFixed Zero()</div><div class="ttdef"><b>Definition:</b> <a href="Fixed_8h_source.html#l00127">Fixed.h:127</a></div></div>
<div class="ttc" id="structICmpPathfinder_1_1Goal_html_a7b61b4e42da891cd8b8dc1f90b37021e"><div class="ttname"><a href="structICmpPathfinder_1_1Goal.html#a7b61b4e42da891cd8b8dc1f90b37021e">ICmpPathfinder::Goal::hh</a></div><div class="ttdeci">entity_pos_t hh</div><div class="ttdef"><b>Definition:</b> <a href="ICmpPathfinder_8h_source.html#l00063">ICmpPathfinder.h:63</a></div></div>
<div class="ttc" id="Terrain_8h_html_afa474c073f2fd8de9f0aace0d023d026"><div class="ttname"><a href="Terrain_8h.html#afa474c073f2fd8de9f0aace0d023d026">TERRAIN_TILE_SIZE</a></div><div class="ttdeci">const ssize_t TERRAIN_TILE_SIZE</div><div class="ttdoc">metres [world space units] per tile in x and z </div><div class="ttdef"><b>Definition:</b> <a href="Terrain_8h_source.html#l00040">Terrain.h:40</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_aedcb1d29467bcfbdcb4448682a5d19f7"><div class="ttname"><a href="classCCmpUnitMotion.html#aedcb1d29467bcfbdcb4448682a5d19f7">CCmpUnitMotion::IsFormationMember</a></div><div class="ttdeci">bool IsFormationMember()</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00474">CCmpUnitMotion.cpp:474</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_acebe1df1011405a9c49adc740c260c78"><div class="ttname"><a href="classCCmpUnitMotion.html#acebe1df1011405a9c49adc740c260c78">CCmpUnitMotion::RequestLongPath</a></div><div class="ttdeci">void RequestLongPath(CFixedVector2D from, const ICmpPathfinder::Goal &amp;goal)</div><div class="ttdoc">Start an asynchronous long path query. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01195">CCmpUnitMotion.cpp:1195</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a77db8cfdf209c7da59a2317cae3b03b0"><div class="ttname"><a href="classCCmpUnitMotion.html#a77db8cfdf209c7da59a2317cae3b03b0">CCmpUnitMotion::m_TargetOffset</a></div><div class="ttdeci">CFixedVector2D m_TargetOffset</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00226">CCmpUnitMotion.cpp:226</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a5fae9b253856b7ccfa785a388fa4a8ef"><div class="ttname"><a href="classCCmpUnitMotion.html#a5fae9b253856b7ccfa785a388fa4a8ef">CCmpUnitMotion::RenderSubmit</a></div><div class="ttdeci">void RenderSubmit(SceneCollector &amp;collector)</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01681">CCmpUnitMotion.cpp:1681</a></div></div>
<div class="ttc" id="classCParamNode_html_a2a534f1d8adf69887023f1822f7b236e"><div class="ttname"><a href="classCParamNode.html#a2a534f1d8adf69887023f1822f7b236e">CParamNode::ToUTF8</a></div><div class="ttdeci">const std::string ToUTF8() const </div><div class="ttdoc">Returns the content of this node as an 8-bit string. </div><div class="ttdef"><b>Definition:</b> <a href="ParamNode_8cpp_source.html#l00203">ParamNode.cpp:203</a></div></div>
<div class="ttc" id="classCParamNode_html_aedcc2b5a330deba1b9219f44d4822827"><div class="ttname"><a href="classCParamNode.html#aedcc2b5a330deba1b9219f44d4822827">CParamNode::IsOk</a></div><div class="ttdeci">bool IsOk() const </div><div class="ttdoc">Returns true if this is a valid CParamNode, false if it represents a non-existent node...</div><div class="ttdef"><b>Definition:</b> <a href="ParamNode_8cpp_source.html#l00193">ParamNode.cpp:193</a></div></div>
<div class="ttc" id="structICmpPathfinder_1_1Waypoint_html_ac1029e9f0ceb98311a69741385d1e932"><div class="ttname"><a href="structICmpPathfinder_1_1Waypoint.html#ac1029e9f0ceb98311a69741385d1e932">ICmpPathfinder::Waypoint::x</a></div><div class="ttdeci">entity_pos_t x</div><div class="ttdef"><b>Definition:</b> <a href="ICmpPathfinder_8h_source.html#l00068">ICmpPathfinder.h:68</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a623e56ca1f3510597d6e53919e7779c3"><div class="ttname"><a href="classCCmpUnitMotion.html#a623e56ca1f3510597d6e53919e7779c3">CCmpUnitMotion::m_CostClass</a></div><div class="ttdeci">ICmpPathfinder::cost_class_t m_CostClass</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00126">CCmpUnitMotion.cpp:126</a></div></div>
<div class="ttc" id="classICmpPathfinder_html_a63fcf18872a30c300d32d52c4d9b044f"><div class="ttname"><a href="classICmpPathfinder.html#a63fcf18872a30c300d32d52c4d9b044f">ICmpPathfinder::GetMovementSpeed</a></div><div class="ttdeci">virtual fixed GetMovementSpeed(entity_pos_t x0, entity_pos_t z0, cost_class_t costClass)=0</div><div class="ttdoc">Find the speed factor (typically around 1.0) for a unit of the given cost class at the given position...</div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a48b34e624ebc23ab7530fd6188b9fc78"><div class="ttname"><a href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78">CCmpUnitMotion::State</a></div><div class="ttdeci">State</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00134">CCmpUnitMotion.cpp:134</a></div></div>
<div class="ttc" id="structCColor_html"><div class="ttname"><a href="structCColor.html">CColor</a></div><div class="ttdef"><b>Definition:</b> <a href="ps_2Overlay_8h_source.html#l00034">Overlay.h:34</a></div></div>
<div class="ttc" id="classCFixedVector2D_html_a119a6833abd8f4215cffd8db389987af"><div class="ttname"><a href="classCFixedVector2D.html#a119a6833abd8f4215cffd8db389987af">CFixedVector2D::IsZero</a></div><div class="ttdeci">bool IsZero() const </div><div class="ttdef"><b>Definition:</b> <a href="FixedVector2D_8h_source.html#l00159">FixedVector2D.h:159</a></div></div>
<div class="ttc" id="ICmpPosition_8h_html"><div class="ttname"><a href="ICmpPosition_8h.html">ICmpPosition.h</a></div></div>
<div class="ttc" id="Components_8h_html_aeed5f0d6bf70b510e5eb09522ea8fb6fa273df3edd94f150c5586e56c696023da"><div class="ttname"><a href="Components_8h.html#aeed5f0d6bf70b510e5eb09522ea8fb6fa273df3edd94f150c5586e56c696023da">MT_Update_MotionFormation</a></div><div class="ttdef"><b>Definition:</b> <a href="Components_8h_source.html#l00066">Components.h:66</a></div></div>
<div class="ttc" id="classISerializer_html"><div class="ttname"><a href="classISerializer.html">ISerializer</a></div><div class="ttdoc">Serialization interface; see serialization overview. </div><div class="ttdef"><b>Definition:</b> <a href="ISerializer_8h_source.html#l00120">ISerializer.h:120</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_af00dcfe76180ea96cec7adb5b07bfa58ae63325a8e59d96aebf4f7e34cdd7d85c"><div class="ttname"><a href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58ae63325a8e59d96aebf4f7e34cdd7d85c">CCmpUnitMotion::PATHSTATE_NONE</a></div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00172">CCmpUnitMotion.cpp:172</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_af00dcfe76180ea96cec7adb5b07bfa58"><div class="ttname"><a href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58">CCmpUnitMotion::PathState</a></div><div class="ttdeci">PathState</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00166">CCmpUnitMotion.cpp:166</a></div></div>
<div class="ttc" id="classControlGroupMovementObstructionFilter_html"><div class="ttname"><a href="classControlGroupMovementObstructionFilter.html">ControlGroupMovementObstructionFilter</a></div><div class="ttdoc">Obstruction test filter that reject shapes in a given control group, and rejects shapes that don&amp;#39;t bl...</div><div class="ttdef"><b>Definition:</b> <a href="ICmpObstructionManager_8h_source.html#l00333">ICmpObstructionManager.h:333</a></div></div>
<div class="ttc" id="classCMessageRenderSubmit_html"><div class="ttname"><a href="classCMessageRenderSubmit.html">CMessageRenderSubmit</a></div><div class="ttdoc">Add renderable objects to the scene collector. </div><div class="ttdef"><b>Definition:</b> <a href="MessageTypes_8h_source.html#l00145">MessageTypes.h:145</a></div></div>
<div class="ttc" id="classCMessageMotionChanged_html"><div class="ttname"><a href="classCMessageMotionChanged.html">CMessageMotionChanged</a></div><div class="ttdoc">Sent by CCmpUnitMotion during Update, whenever the motion status has changed since the previous updat...</div><div class="ttdef"><b>Definition:</b> <a href="MessageTypes_8h_source.html#l00265">MessageTypes.h:265</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a154e5f186a8be4d283e35dbfd0046a60"><div class="ttname"><a href="classCCmpUnitMotion.html#a154e5f186a8be4d283e35dbfd0046a60">CCmpUnitMotion::GetSchema</a></div><div class="ttdeci">static std::string GetSchema()</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00242">CCmpUnitMotion.cpp:242</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a48b34e624ebc23ab7530fd6188b9fc78a9f1847061a0b7aaf798dab710b013c8a"><div class="ttname"><a href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a9f1847061a0b7aaf798dab710b013c8a">CCmpUnitMotion::STATE_INDIVIDUAL_PATH</a></div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00160">CCmpUnitMotion.cpp:160</a></div></div>
<div class="ttc" id="wdbg__sym_8cpp_html_ace3d1803d3e67865bf600d34b50328c5"><div class="ttname"><a href="wdbg__sym_8cpp.html#ace3d1803d3e67865bf600d34b50328c5">out</a></div><div class="ttdeci">static void out(const wchar_t *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="wdbg__sym_8cpp_source.html#l00419">wdbg_sym.cpp:419</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a80b08f69fe05b1bd23b48934c6b76774"><div class="ttname"><a href="classCCmpUnitMotion.html#a80b08f69fe05b1bd23b48934c6b76774">CCmpUnitMotion::m_DebugOverlayShortPathLines</a></div><div class="ttdeci">std::vector&lt; SOverlayLine &gt; m_DebugOverlayShortPathLines</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00118">CCmpUnitMotion.cpp:118</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_af00dcfe76180ea96cec7adb5b07bfa58a867756a642e461e201ac6670cc2a0ecc"><div class="ttname"><a href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a867756a642e461e201ac6670cc2a0ecc">CCmpUnitMotion::PATHSTATE_WAITING_REQUESTING_SHORT</a></div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00185">CCmpUnitMotion.cpp:185</a></div></div>
<div class="ttc" id="classICmpPosition_html_ae75e1a79434f7ce9cdefa7f674a01541"><div class="ttname"><a href="classICmpPosition.html#ae75e1a79434f7ce9cdefa7f674a01541">ICmpPosition::GetRotation</a></div><div class="ttdeci">virtual CFixedVector3D GetRotation()=0</div><div class="ttdoc">Returns the current rotation (relative to the upwards axis), as Euler angles with X=pitch...</div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a48b34e624ebc23ab7530fd6188b9fc78a78b9f8c8a2e428e2032a90ccace9a78d"><div class="ttname"><a href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a78b9f8c8a2e428e2032a90ccace9a78d">CCmpUnitMotion::STATE_FORMATIONMEMBER_PATH</a></div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00152">CCmpUnitMotion.cpp:152</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_af00dcfe76180ea96cec7adb5b07bfa58a96299aed9d35a4ccbea5932d05f786c5"><div class="ttname"><a href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a96299aed9d35a4ccbea5932d05f786c5">CCmpUnitMotion::PATHSTATE_MAX</a></div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00218">CCmpUnitMotion.cpp:218</a></div></div>
<div class="ttc" id="structICmpPathfinder_1_1Goal_html_a56759efe217d039b0c3e75fd8bed5ed2ae7f0a446ab32d214949b2aa73f76916c"><div class="ttname"><a href="structICmpPathfinder_1_1Goal.html#a56759efe217d039b0c3e75fd8bed5ed2ae7f0a446ab32d214949b2aa73f76916c">ICmpPathfinder::Goal::SQUARE</a></div><div class="ttdef"><b>Definition:</b> <a href="ICmpPathfinder_8h_source.html#l00059">ICmpPathfinder.h:59</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_ae8ebde6c1f1881b22c134e59f83d5a10"><div class="ttname"><a href="classCCmpUnitMotion.html#ae8ebde6c1f1881b22c134e59f83d5a10">CCmpUnitMotion::GetCurrentSpeed</a></div><div class="ttdeci">virtual fixed GetCurrentSpeed()</div><div class="ttdoc">Get the current movement speed. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00425">CCmpUnitMotion.cpp:425</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a3ba0e2c1fcff8d7c3c16dc8e28ab7d7e"><div class="ttname"><a href="classCCmpUnitMotion.html#a3ba0e2c1fcff8d7c3c16dc8e28ab7d7e">CCmpUnitMotion::SetUnitRadius</a></div><div class="ttdeci">virtual void SetUnitRadius(fixed radius)</div><div class="ttdoc">Override the default obstruction radius, used for planning paths and checking for collisions...</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00463">CCmpUnitMotion.cpp:463</a></div></div>
<div class="ttc" id="structICmpPathfinder_1_1Path_html"><div class="ttname"><a href="structICmpPathfinder_1_1Path.html">ICmpPathfinder::Path</a></div><div class="ttdoc">Returned path. </div><div class="ttdef"><b>Definition:</b> <a href="ICmpPathfinder_8h_source.html#l00075">ICmpPathfinder.h:75</a></div></div>
<div class="ttc" id="structICmpPathfinder_1_1Path_html_afe455e5634e3530359d15a4c02fb806d"><div class="ttname"><a href="structICmpPathfinder_1_1Path.html#afe455e5634e3530359d15a4c02fb806d">ICmpPathfinder::Path::m_Waypoints</a></div><div class="ttdeci">std::vector&lt; Waypoint &gt; m_Waypoints</div><div class="ttdef"><b>Definition:</b> <a href="ICmpPathfinder_8h_source.html#l00077">ICmpPathfinder.h:77</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_abd775349e9bd09eb24a03f5756a2d696"><div class="ttname"><a href="classCCmpUnitMotion.html#abd775349e9bd09eb24a03f5756a2d696">CCmpUnitMotion::FaceTowardsPoint</a></div><div class="ttdeci">virtual void FaceTowardsPoint(entity_pos_t x, entity_pos_t z)</div><div class="ttdoc">Turn to look towards the given point. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01123">CCmpUnitMotion.cpp:1123</a></div></div>
<div class="ttc" id="classICmpObstruction_html_a1d209c77994fe29f576199f20329b323"><div class="ttname"><a href="classICmpObstruction.html#a1d209c77994fe29f576199f20329b323">ICmpObstruction::GetObstructionSquare</a></div><div class="ttdeci">virtual bool GetObstructionSquare(ICmpObstructionManager::ObstructionSquare &amp;out)=0</div><div class="ttdoc">Gets the square corresponding to this obstruction shape. </div></div>
<div class="ttc" id="classICmpPathfinder_html_acbe58c38e20ec855b2af1e942d0bc34c"><div class="ttname"><a href="classICmpPathfinder.html#acbe58c38e20ec855b2af1e942d0bc34c">ICmpPathfinder::GetCostClass</a></div><div class="ttdeci">virtual cost_class_t GetCostClass(const std::string &amp;name)=0</div><div class="ttdoc">Get the tag for a given movement cost class name. </div></div>
<div class="ttc" id="ICmpObstructionManager_8h_html"><div class="ttname"><a href="ICmpObstructionManager_8h.html">ICmpObstructionManager.h</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_aaff2376439831c72219d6d071c0f0f18"><div class="ttname"><a href="classCCmpUnitMotion.html#aaff2376439831c72219d6d071c0f0f18">CCmpUnitMotion::GetWalkSpeed</a></div><div class="ttdeci">virtual fixed GetWalkSpeed()</div><div class="ttdoc">Get the default speed that this unit will have when walking, in metres per second. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00410">CCmpUnitMotion.cpp:410</a></div></div>
<div class="ttc" id="classCFixedVector3D_html_a7c66fe9ac2cc5beaafdd54a3b6dc7372"><div class="ttname"><a href="classCFixedVector3D.html#a7c66fe9ac2cc5beaafdd54a3b6dc7372">CFixedVector3D::Y</a></div><div class="ttdeci">fixed Y</div><div class="ttdef"><b>Definition:</b> <a href="FixedVector3D_8h_source.html#l00027">FixedVector3D.h:27</a></div></div>
<div class="ttc" id="Component_8h_html"><div class="ttname"><a href="Component_8h.html">Component.h</a></div></div>
<div class="ttc" id="Scene_8h_html"><div class="ttname"><a href="Scene_8h.html">Scene.h</a></div></div>
<div class="ttc" id="classCMessageUpdate__MotionUnit_html"><div class="ttname"><a href="classCMessageUpdate__MotionUnit.html">CMessageUpdate_MotionUnit</a></div><div class="ttdoc">Update phase for non-formation-controller unit movement. </div><div class="ttdef"><b>Definition:</b> <a href="MessageTypes_8h_source.html#l00090">MessageTypes.h:90</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a31f1235e72ec4d199b78e17e31c00328"><div class="ttname"><a href="classCCmpUnitMotion.html#a31f1235e72ec4d199b78e17e31c00328">CCmpUnitMotion::m_TargetMinRange</a></div><div class="ttdeci">entity_pos_t m_TargetMinRange</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00227">CCmpUnitMotion.cpp:227</a></div></div>
<div class="ttc" id="structICmpObstructionManager_1_1ObstructionSquare_html_a8b0c1584a68e10193569694ad763b48b"><div class="ttname"><a href="structICmpObstructionManager_1_1ObstructionSquare.html#a8b0c1584a68e10193569694ad763b48b">ICmpObstructionManager::ObstructionSquare::hh</a></div><div class="ttdeci">entity_pos_t hh</div><div class="ttdef"><b>Definition:</b> <a href="ICmpObstructionManager_8h_source.html#l00236">ICmpObstructionManager.h:236</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a251b047d9350fa8cbe8e036fe8cdd0ba"><div class="ttname"><a href="classCCmpUnitMotion.html#a251b047d9350fa8cbe8e036fe8cdd0ba">CCmpUnitMotion::FaceTowardsPointFromPos</a></div><div class="ttdeci">void FaceTowardsPointFromPos(CFixedVector2D pos, entity_pos_t x, entity_pos_t z)</div><div class="ttdoc">Rotate to face towards the target point, given the current pos. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01133">CCmpUnitMotion.cpp:1133</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a7f6b33d410aeaeacc616df8950d715fb"><div class="ttname"><a href="classCCmpUnitMotion.html#a7f6b33d410aeaeacc616df8950d715fb">CCmpUnitMotion::GetRunSpeed</a></div><div class="ttdeci">virtual fixed GetRunSpeed()</div><div class="ttdoc">Get the default speed that this unit will have when running, in metres per second. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00415">CCmpUnitMotion.cpp:415</a></div></div>
<div class="ttc" id="CCmpUnitMotion_8cpp_html_a848861e02cf85f5856b3a072072be671"><div class="ttname"><a href="CCmpUnitMotion_8cpp.html#a848861e02cf85f5856b3a072072be671">WAYPOINT_ADVANCE_MAX</a></div><div class="ttdeci">static const entity_pos_t WAYPOINT_ADVANCE_MAX</div><div class="ttdoc">When advancing along the long path, and picking a new waypoint to move towards, we&amp;#39;ll pick one that&amp;#39;s...</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00046">CCmpUnitMotion.cpp:46</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_ae4be8cae9512c2bc3fca01238366b138"><div class="ttname"><a href="classCCmpUnitMotion.html#ae4be8cae9512c2bc3fca01238366b138">CCmpUnitMotion::MoveToFormationOffset</a></div><div class="ttdeci">virtual void MoveToFormationOffset(entity_id_t target, entity_pos_t x, entity_pos_t z)</div><div class="ttdoc">Join a formation, and move towards a given offset relative to the formation controller entity...</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01629">CCmpUnitMotion.cpp:1629</a></div></div>
<div class="ttc" id="classCFixedVector2D_html_aa26e242458145bc27475b2349e465238"><div class="ttname"><a href="classCFixedVector2D.html#aa26e242458145bc27475b2349e465238">CFixedVector2D::Rotate</a></div><div class="ttdeci">CFixedVector2D Rotate(fixed angle)</div><div class="ttdoc">Rotate the vector by the given angle (anticlockwise). </div><div class="ttdef"><b>Definition:</b> <a href="FixedVector2D_8h_source.html#l00217">FixedVector2D.h:217</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a81ec5b62fa9271f89491dec73690062a"><div class="ttname"><a href="classCCmpUnitMotion.html#a81ec5b62fa9271f89491dec73690062a">CCmpUnitMotion::m_DebugOverlayEnabled</a></div><div class="ttdeci">bool m_DebugOverlayEnabled</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00116">CCmpUnitMotion.cpp:116</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a5fd594984644e67cbbc05dc8bf33124b"><div class="ttname"><a href="classCCmpUnitMotion.html#a5fd594984644e67cbbc05dc8bf33124b">CCmpUnitMotion::Serialize</a></div><div class="ttdeci">virtual void Serialize(ISerializer &amp;serialize)</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00356">CCmpUnitMotion.cpp:356</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_ac89d86e77ccc627aadaf3d38e1850034"><div class="ttname"><a href="classCCmpUnitMotion.html#ac89d86e77ccc627aadaf3d38e1850034">CCmpUnitMotion::MoveToTargetRange</a></div><div class="ttdeci">virtual bool MoveToTargetRange(entity_id_t target, entity_pos_t minRange, entity_pos_t maxRange)</div><div class="ttdoc">Attempt to walk into range of a given target entity, or as close as possible. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01417">CCmpUnitMotion.cpp:1417</a></div></div>
<div class="ttc" id="classICmpPosition_html_a822657906318eb50ede0ca757c9cbebf"><div class="ttname"><a href="classICmpPosition.html#a822657906318eb50ede0ca757c9cbebf">ICmpPosition::IsInWorld</a></div><div class="ttdeci">virtual bool IsInWorld()=0</div><div class="ttdoc">Returns true if the entity currently exists at a defined position in the world. </div></div>
<div class="ttc" id="Terrain_8h_html"><div class="ttname"><a href="Terrain_8h.html">Terrain.h</a></div></div>
<div class="ttc" id="classICmpPathfinder_html"><div class="ttname"><a href="classICmpPathfinder.html">ICmpPathfinder</a></div><div class="ttdoc">Pathfinder algorithms. </div><div class="ttdef"><b>Definition:</b> <a href="ICmpPathfinder_8h_source.html#l00048">ICmpPathfinder.h:48</a></div></div>
<div class="ttc" id="classICmpRangeManager_html_aeeafbf48f450cac7f02edff3f51ff8aa"><div class="ttname"><a href="classICmpRangeManager.html#aeeafbf48f450cac7f02edff3f51ff8aa">ICmpRangeManager::GetLosVisibility</a></div><div class="ttdeci">virtual ELosVisibility GetLosVisibility(CEntityHandle ent, player_id_t player, bool forceRetainInFog=false)=0</div><div class="ttdoc">Returns the visibility status of the given entity, with respect to the given player. </div></div>
<div class="ttc" id="structSerializeVector_html"><div class="ttname"><a href="structSerializeVector.html">SerializeVector</a></div><div class="ttdef"><b>Definition:</b> <a href="SerializeTemplates_8h_source.html#l00029">SerializeTemplates.h:29</a></div></div>
<div class="ttc" id="classCFixedVector2D_html_a814f82a51edea75e7066d03663c33d8f"><div class="ttname"><a href="classCFixedVector2D.html#a814f82a51edea75e7066d03663c33d8f">CFixedVector2D::Y</a></div><div class="ttdeci">fixed Y</div><div class="ttdef"><b>Definition:</b> <a href="FixedVector2D_8h_source.html#l00027">FixedVector2D.h:27</a></div></div>
<div class="ttc" id="classSceneCollector_html"><div class="ttname"><a href="classSceneCollector.html">SceneCollector</a></div><div class="ttdoc">This interface accepts renderable objects. </div><div class="ttdef"><b>Definition:</b> <a href="Scene_8h_source.html#l00082">Scene.h:82</a></div></div>
<div class="ttc" id="classICmpUnitMotion_html"><div class="ttname"><a href="classICmpUnitMotion.html">ICmpUnitMotion</a></div><div class="ttdoc">Motion interface for entities with complex movement capabilities. </div><div class="ttdef"><b>Definition:</b> <a href="ICmpUnitMotion_8h_source.html#l00035">ICmpUnitMotion.h:35</a></div></div>
<div class="ttc" id="CLogger_8h_html_a95f38715fd9690db0907bb5f6d6a51c4"><div class="ttname"><a href="CLogger_8h.html#a95f38715fd9690db0907bb5f6d6a51c4">LOGWARNING</a></div><div class="ttdeci">#define LOGWARNING</div><div class="ttdef"><b>Definition:</b> <a href="CLogger_8h_source.html#l00034">CLogger.h:34</a></div></div>
<div class="ttc" id="classIComponent_html_a67e2894e43dc8d141702644072f3c3ca"><div class="ttname"><a href="classIComponent.html#a67e2894e43dc8d141702644072f3c3ca">IComponent::GetEntityHandle</a></div><div class="ttdeci">CEntityHandle GetEntityHandle() const </div><div class="ttdef"><b>Definition:</b> <a href="IComponent_8h_source.html#l00045">IComponent.h:45</a></div></div>
<div class="ttc" id="classCParamNode_html_a1dc59ac4c42ec4c5ca6a3d2542f4d795"><div class="ttname"><a href="classCParamNode.html#a1dc59ac4c42ec4c5ca6a3d2542f4d795">CParamNode::ToFixed</a></div><div class="ttdeci">fixed ToFixed() const </div><div class="ttdoc">Parses the content of this node as a fixed-point number. </div><div class="ttdef"><b>Definition:</b> <a href="ParamNode_8cpp_source.html#l00222">ParamNode.cpp:222</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_aa2713917c3fc648d9cdaef853ba9a7ab"><div class="ttname"><a href="classCCmpUnitMotion.html#aa2713917c3fc648d9cdaef853ba9a7ab">CCmpUnitMotion::StopMoving</a></div><div class="ttdeci">virtual void StopMoving()</div><div class="ttdoc">Stop moving immediately. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00453">CCmpUnitMotion.cpp:453</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a16cca606908bbfacbb70b9799dc52889"><div class="ttname"><a href="classCCmpUnitMotion.html#a16cca606908bbfacbb70b9799dc52889">CCmpUnitMotion::PickNextLongWaypoint</a></div><div class="ttdeci">bool PickNextLongWaypoint(const CFixedVector2D &amp;pos, bool avoidMovingUnits)</div><div class="ttdoc">Select a next long waypoint, given the current unit position. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01215">CCmpUnitMotion.cpp:1215</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a21dc2aa1cdaa82062dc6aec2ce660743"><div class="ttname"><a href="classCCmpUnitMotion.html#a21dc2aa1cdaa82062dc6aec2ce660743">CCmpUnitMotion::HandleMessage</a></div><div class="ttdeci">virtual void HandleMessage(const CMessage &amp;msg, bool global)</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00368">CCmpUnitMotion.cpp:368</a></div></div>
<div class="ttc" id="CCmpUnitMotion_8cpp_html_a0a1358d5dc22275d15595e9315b76b1e"><div class="ttname"><a href="CCmpUnitMotion_8cpp.html#a0a1358d5dc22275d15595e9315b76b1e">CHECK_TARGET_MOVEMENT_AT_MAX_DIST</a></div><div class="ttdeci">static const entity_pos_t CHECK_TARGET_MOVEMENT_AT_MAX_DIST</div><div class="ttdoc">If we&amp;#39;re following something but it&amp;#39;s more than this distance away along our path, then don&amp;#39;t bother trying to repath regardless of how much it has moved, until we get this close to the end of our old path. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00096">CCmpUnitMotion.cpp:96</a></div></div>
<div class="ttc" id="structICmpPathfinder_1_1Goal_html_aafab18228cd3cc155f04c4bfd34525b3"><div class="ttname"><a href="structICmpPathfinder_1_1Goal.html#aafab18228cd3cc155f04c4bfd34525b3">ICmpPathfinder::Goal::z</a></div><div class="ttdeci">entity_pos_t z</div><div class="ttdef"><b>Definition:</b> <a href="ICmpPathfinder_8h_source.html#l00061">ICmpPathfinder.h:61</a></div></div>
<div class="ttc" id="classICmpPosition_html_ad94c06fd3e95da3a3fd6a41b6d61a2d8"><div class="ttname"><a href="classICmpPosition.html#ad94c06fd3e95da3a3fd6a41b6d61a2d8">ICmpPosition::GetDistanceTravelled</a></div><div class="ttdeci">virtual fixed GetDistanceTravelled()=0</div><div class="ttdoc">Returns the distance that the unit will be interpolated over, i.e. </div></div>
<div class="ttc" id="classIComponent_html_a9b13f60a69a6571edebba6338812527f"><div class="ttname"><a href="classIComponent.html#a9b13f60a69a6571edebba6338812527f">IComponent::GetEntityId</a></div><div class="ttdeci">entity_id_t GetEntityId() const </div><div class="ttdef"><b>Definition:</b> <a href="IComponent_8h_source.html#l00048">IComponent.h:48</a></div></div>
<div class="ttc" id="classICmpObstruction_html_a6931dd07e31dbbb44ae2a6e70c4e32f1"><div class="ttname"><a href="classICmpObstruction.html#a6931dd07e31dbbb44ae2a6e70c4e32f1">ICmpObstruction::SetMovingFlag</a></div><div class="ttdeci">virtual void SetMovingFlag(bool enabled)=0</div></div>
<div class="ttc" id="classCCmpUnitMotion_html_addcb402597964a3b2211406858b9e8bf"><div class="ttname"><a href="classCCmpUnitMotion.html#addcb402597964a3b2211406858b9e8bf">CCmpUnitMotion::IsInPointRange</a></div><div class="ttdeci">virtual bool IsInPointRange(entity_pos_t x, entity_pos_t z, entity_pos_t minRange, entity_pos_t maxRange)</div><div class="ttdoc">Determine wether the givven point is within the given range, using the same measurement as MoveToPoin...</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01353">CCmpUnitMotion.cpp:1353</a></div></div>
<div class="ttc" id="Components_8h_html_aeed5f0d6bf70b510e5eb09522ea8fb6fadcd319267a030b23b69294967f29731c"><div class="ttname"><a href="Components_8h.html#aeed5f0d6bf70b510e5eb09522ea8fb6fadcd319267a030b23b69294967f29731c">MT_RenderSubmit</a></div><div class="ttdef"><b>Definition:</b> <a href="Components_8h_source.html#l00070">Components.h:70</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_ac7205b6f7d51adeb2ae1c887e8c74f91"><div class="ttname"><a href="classCCmpUnitMotion.html#ac7205b6f7d51adeb2ae1c887e8c74f91">CCmpUnitMotion::m_TargetMaxRange</a></div><div class="ttdeci">entity_pos_t m_TargetMaxRange</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00228">CCmpUnitMotion.cpp:228</a></div></div>
<div class="ttc" id="classCMessage_html_a1a02400beff0f7dff88156e05ce387d2"><div class="ttname"><a href="classCMessage.html#a1a02400beff0f7dff88156e05ce387d2">CMessage::GetType</a></div><div class="ttdeci">virtual int GetType() const =0</div></div>
<div class="ttc" id="classCCmpUnitMotion_html_aaa865a1a5b657f08cf05ad4b82436554"><div class="ttname"><a href="classCCmpUnitMotion.html#aaa865a1a5b657f08cf05ad4b82436554">CCmpUnitMotion::ComputeTargetPosition</a></div><div class="ttdeci">bool ComputeTargetPosition(CFixedVector2D &amp;out)</div><div class="ttdoc">Computes the current location of our target entity (plus offset). </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01000">CCmpUnitMotion.cpp:1000</a></div></div>
<div class="ttc" id="classCParamNode_html_adb2692c0fbf3c367c110318f96a8d32f"><div class="ttname"><a href="classCParamNode.html#adb2692c0fbf3c367c110318f96a8d32f">CParamNode::GetChild</a></div><div class="ttdeci">const CParamNode &amp; GetChild(const char *name) const </div><div class="ttdoc">Returns the (unique) child node with the given name, or a node with IsOk() == false if there is none...</div><div class="ttdef"><b>Definition:</b> <a href="ParamNode_8cpp_source.html#l00185">ParamNode.cpp:185</a></div></div>
<div class="ttc" id="classICmpPathfinder_html_a9d88d9e1c1f9fe6bede8b23dc217815e"><div class="ttname"><a href="classICmpPathfinder.html#a9d88d9e1c1f9fe6bede8b23dc217815e">ICmpPathfinder::CheckMovement</a></div><div class="ttdeci">virtual bool CheckMovement(const IObstructionTestFilter &amp;filter, entity_pos_t x0, entity_pos_t z0, entity_pos_t x1, entity_pos_t z1, entity_pos_t r, pass_class_t passClass)=0</div><div class="ttdoc">Check whether the given movement line is valid and doesn&amp;#39;t hit any obstructions or impassable terrain...</div></div>
<div class="ttc" id="structICmpPathfinder_1_1Goal_html_a56759efe217d039b0c3e75fd8bed5ed2a961bc01193c0dc37d49ce65f3e00d93f"><div class="ttname"><a href="structICmpPathfinder_1_1Goal.html#a56759efe217d039b0c3e75fd8bed5ed2a961bc01193c0dc37d49ce65f3e00d93f">ICmpPathfinder::Goal::CIRCLE</a></div><div class="ttdef"><b>Definition:</b> <a href="ICmpPathfinder_8h_source.html#l00058">ICmpPathfinder.h:58</a></div></div>
<div class="ttc" id="structICmpObstructionManager_1_1ObstructionSquare_html_a3c7fc08553617b08fd8a1e2daf9ab889"><div class="ttname"><a href="structICmpObstructionManager_1_1ObstructionSquare.html#a3c7fc08553617b08fd8a1e2daf9ab889">ICmpObstructionManager::ObstructionSquare::hw</a></div><div class="ttdeci">entity_pos_t hw</div><div class="ttdef"><b>Definition:</b> <a href="ICmpObstructionManager_8h_source.html#l00236">ICmpObstructionManager.h:236</a></div></div>
<div class="ttc" id="namespaceSimRender_html_ac4ca10b2735aa8e5acf696dc4c730fcd"><div class="ttname"><a href="namespaceSimRender.html#ac4ca10b2735aa8e5acf696dc4c730fcd">SimRender::ConstructLineOnGround</a></div><div class="ttdeci">void ConstructLineOnGround(const CSimContext &amp;context, const std::vector&lt; float &gt; &amp;xz, SOverlayLine &amp;overlay, bool floating, float heightOffset=0.25f)</div><div class="ttdoc">Constructs overlay line from given points, conforming to terrain. </div><div class="ttdef"><b>Definition:</b> <a href="Render_8cpp_source.html#l00035">Render.cpp:35</a></div></div>
<div class="ttc" id="classCComponentManager_html"><div class="ttname"><a href="classCComponentManager.html">CComponentManager</a></div><div class="ttdef"><b>Definition:</b> <a href="ComponentManager_8h_source.html#l00037">ComponentManager.h:37</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_afc440aaae4b07016e3d07a50b821074d"><div class="ttname"><a href="classCCmpUnitMotion.html#afc440aaae4b07016e3d07a50b821074d">CCmpUnitMotion::MoveToPointRange</a></div><div class="ttdeci">virtual bool MoveToPointRange(entity_pos_t x, entity_pos_t z, entity_pos_t minRange, entity_pos_t maxRange)</div><div class="ttdoc">Attempt to walk into range of a to a given point, or as close as possible. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01266">CCmpUnitMotion.cpp:1266</a></div></div>
<div class="ttc" id="structICmpPathfinder_1_1Goal_html_a689861f0cfc43726913e0bd24f8d4fd4"><div class="ttname"><a href="structICmpPathfinder_1_1Goal.html#a689861f0cfc43726913e0bd24f8d4fd4">ICmpPathfinder::Goal::u</a></div><div class="ttdeci">CFixedVector2D u</div><div class="ttdef"><b>Definition:</b> <a href="ICmpPathfinder_8h_source.html#l00062">ICmpPathfinder.h:62</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a49f1a918829acfe2163cdf30d7a873bd"><div class="ttname"><a href="classCCmpUnitMotion.html#a49f1a918829acfe2163cdf30d7a873bd">CCmpUnitMotion::ClassInit</a></div><div class="ttdeci">static void ClassInit(CComponentManager &amp;componentManager)</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00106">CCmpUnitMotion.cpp:106</a></div></div>
<div class="ttc" id="classPath_html"><div class="ttname"><a href="classPath.html">Path</a></div><div class="ttdef"><b>Definition:</b> <a href="path_8h_source.html#l00075">path.h:75</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a48b34e624ebc23ab7530fd6188b9fc78a2481807626d5f42bc11e7df57aba2a85"><div class="ttname"><a href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a2481807626d5f42bc11e7df57aba2a85">CCmpUnitMotion::STATE_IDLE</a></div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00139">CCmpUnitMotion.cpp:139</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a9ebfc4ba23b7c236e2c7ecf4ed6ebb7b"><div class="ttname"><a href="classCCmpUnitMotion.html#a9ebfc4ba23b7c236e2c7ecf4ed6ebb7b">CCmpUnitMotion::m_Radius</a></div><div class="ttdeci">entity_pos_t m_Radius</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00130">CCmpUnitMotion.cpp:130</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a1f983633f40a4bd208e082fe38ac9781"><div class="ttname"><a href="classCCmpUnitMotion.html#a1f983633f40a4bd208e082fe38ac9781">CCmpUnitMotion::Move</a></div><div class="ttdeci">void Move(fixed dt)</div><div class="ttdoc">Do the per-turn movement and other updates. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00765">CCmpUnitMotion.cpp:765</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_ab238b2fb474eabc0707fea7c2e97efc1"><div class="ttname"><a href="classCCmpUnitMotion.html#ab238b2fb474eabc0707fea7c2e97efc1">CCmpUnitMotion::m_FacePointAfterMove</a></div><div class="ttdeci">bool m_FacePointAfterMove</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00132">CCmpUnitMotion.cpp:132</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a14e2efe8f4340f9b576fb0fa9a0ce5c8"><div class="ttname"><a href="classCCmpUnitMotion.html#a14e2efe8f4340f9b576fb0fa9a0ce5c8">CCmpUnitMotion::Init</a></div><div class="ttdeci">virtual void Init(const CParamNode &amp;paramNode)</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00280">CCmpUnitMotion.cpp:280</a></div></div>
<div class="ttc" id="classICmpPosition_html_aaba4662965bcabb138c71fcdfa9ab046"><div class="ttname"><a href="classICmpPosition.html#aaba4662965bcabb138c71fcdfa9ab046">ICmpPosition::TurnTo</a></div><div class="ttdeci">virtual void TurnTo(entity_angle_t y)=0</div><div class="ttdoc">Rotate smoothly to the given angle around the upwards axis. </div></div>
<div class="ttc" id="classCCmpUnitMotion_html_ad9745fae3fa07459a54d9e5777e6ec17"><div class="ttname"><a href="classCCmpUnitMotion.html#ad9745fae3fa07459a54d9e5777e6ec17">CCmpUnitMotion::ShouldTreatTargetAsCircle</a></div><div class="ttdeci">bool ShouldTreatTargetAsCircle(entity_pos_t range, entity_pos_t hw, entity_pos_t hh, entity_pos_t circleRadius)</div><div class="ttdoc">Decide whether to approximate the given range from a square target as a circle, rather than as a squa...</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01402">CCmpUnitMotion.cpp:1402</a></div></div>
<div class="ttc" id="CCmpUnitMotion_8cpp_html_aca59310c919f89103b78623ffa11d3b0"><div class="ttname"><a href="CCmpUnitMotion_8cpp.html#aca59310c919f89103b78623ffa11d3b0">DIRECT_PATH_RANGE</a></div><div class="ttdeci">static const entity_pos_t DIRECT_PATH_RANGE</div><div class="ttdoc">If we are this close to our target entity/point, then think about heading for it in a straight line i...</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00074">CCmpUnitMotion.cpp:74</a></div></div>
<div class="ttc" id="classCFixed_html_a6afc8cf5ad319792f761496171a563ae"><div class="ttname"><a href="classCFixed.html#a6afc8cf5ad319792f761496171a563ae">CFixed::Multiply</a></div><div class="ttdeci">CFixed Multiply(CFixed n) const </div><div class="ttdoc">Multiply by a CFixed. </div><div class="ttdef"><b>Definition:</b> <a href="Fixed_8h_source.html#l00290">Fixed.h:290</a></div></div>
<div class="ttc" id="structICmpPathfinder_1_1Goal_html_a1ca6426d0e4b1a6f213c1afa2f6d6c45"><div class="ttname"><a href="structICmpPathfinder_1_1Goal.html#a1ca6426d0e4b1a6f213c1afa2f6d6c45">ICmpPathfinder::Goal::x</a></div><div class="ttdeci">entity_pos_t x</div><div class="ttdef"><b>Definition:</b> <a href="ICmpPathfinder_8h_source.html#l00061">ICmpPathfinder.h:61</a></div></div>
<div class="ttc" id="CCmpUnitMotion_8cpp_html_acf4138fa5566aed8028505f3734d6d26"><div class="ttname"><a href="CCmpUnitMotion_8cpp.html#acf4138fa5566aed8028505f3734d6d26">CHECK_TARGET_MOVEMENT_MIN_DELTA_FORMATION</a></div><div class="ttdeci">static const entity_pos_t CHECK_TARGET_MOVEMENT_MIN_DELTA_FORMATION</div><div class="ttdoc">If we&amp;#39;re following as part of a formation, but can&amp;#39;t move to our assigned target point in a straight ...</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00089">CCmpUnitMotion.cpp:89</a></div></div>
<div class="ttc" id="graphics_2Overlay_8h_html"><div class="ttname"><a href="graphics_2Overlay_8h.html">Overlay.h</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_aa43d05cead87e28df1a4b338db18a9b5"><div class="ttname"><a href="classCCmpUnitMotion.html#aa43d05cead87e28df1a4b338db18a9b5">CCmpUnitMotion::m_TargetPos</a></div><div class="ttdeci">CFixedVector2D m_TargetPos</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00225">CCmpUnitMotion.cpp:225</a></div></div>
<div class="ttc" id="classICmpPosition_html_a59f810055dd3dea45b11703a00c6eeb1"><div class="ttname"><a href="classICmpPosition.html#a59f810055dd3dea45b11703a00c6eeb1">ICmpPosition::GetPosition2D</a></div><div class="ttdeci">virtual CFixedVector2D GetPosition2D()=0</div><div class="ttdoc">Returns the current x,z position (no interpolation). </div></div>
<div class="ttc" id="classCCmpUnitMotion_html_aad8c201a4e2f7e222dd181f49ef9bb24"><div class="ttname"><a href="classCCmpUnitMotion.html#aad8c201a4e2f7e222dd181f49ef9bb24">CCmpUnitMotion::SerializeCommon</a></div><div class="ttdeci">void SerializeCommon(S &amp;serialize)</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00328">CCmpUnitMotion.cpp:328</a></div></div>
<div class="ttc" id="classICmpOwnership_html_a2e3174bd9f4b90e8be78c5a9b7a9f13c"><div class="ttname"><a href="classICmpOwnership.html#a2e3174bd9f4b90e8be78c5a9b7a9f13c">ICmpOwnership::GetOwner</a></div><div class="ttdeci">virtual player_id_t GetOwner()=0</div></div>
<div class="ttc" id="classCCmpUnitMotion_html_aef428849d159e01e39fa7321f0dc1850"><div class="ttname"><a href="classCCmpUnitMotion.html#aef428849d159e01e39fa7321f0dc1850">CCmpUnitMotion::CheckTargetMovement</a></div><div class="ttdeci">bool CheckTargetMovement(CFixedVector2D from, entity_pos_t minDelta)</div><div class="ttdoc">Returns whether the target entity has moved more than minDelta since our last path computations...</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01062">CCmpUnitMotion.cpp:1062</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a4c9674f431deba1076d4f0e36ae9744f"><div class="ttname"><a href="classCCmpUnitMotion.html#a4c9674f431deba1076d4f0e36ae9744f">CCmpUnitMotion::RenderPath</a></div><div class="ttdeci">void RenderPath(const ICmpPathfinder::Path &amp;path, std::vector&lt; SOverlayLine &gt; &amp;lines, CColor color)</div><div class="ttdoc">Convert a path into a renderable list of lines. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01656">CCmpUnitMotion.cpp:1656</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a6553c525ac36ba2cf3b5af7a28aae61a"><div class="ttname"><a href="classCCmpUnitMotion.html#a6553c525ac36ba2cf3b5af7a28aae61a">CCmpUnitMotion::m_FormationController</a></div><div class="ttdeci">bool m_FormationController</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00122">CCmpUnitMotion.cpp:122</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a678ec156458630a0061ac7163b1f41ad"><div class="ttname"><a href="classCCmpUnitMotion.html#a678ec156458630a0061ac7163b1f41ad">CCmpUnitMotion::m_RunSpeed</a></div><div class="ttdeci">fixed m_RunSpeed</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00124">CCmpUnitMotion.cpp:124</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a0072593d0385b4695cc79da493868cc0"><div class="ttname"><a href="classCCmpUnitMotion.html#a0072593d0385b4695cc79da493868cc0">CCmpUnitMotion::PathIsShort</a></div><div class="ttdeci">bool PathIsShort(const ICmpPathfinder::Path &amp;path, CFixedVector2D from, entity_pos_t minDistance)</div><div class="ttdoc">Returns whether the length of the given path, plus the distance from &amp;#39;from&amp;#39; to the first waypoints...</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01101">CCmpUnitMotion.cpp:1101</a></div></div>
<div class="ttc" id="classICmpPosition_html_a89b65c2d715514228248d6f86fe20a0d"><div class="ttname"><a href="classICmpPosition.html#a89b65c2d715514228248d6f86fe20a0d">ICmpPosition::MoveTo</a></div><div class="ttdeci">virtual void MoveTo(entity_pos_t x, entity_pos_t z)=0</div><div class="ttdoc">Move smoothly to the given location. </div></div>
<div class="ttc" id="CCmpUnitMotion_8cpp_html_ab2c6620256cf5c2e37cf150b2a4f8063"><div class="ttname"><a href="CCmpUnitMotion_8cpp.html#ab2c6620256cf5c2e37cf150b2a4f8063">g_GoalDelta</a></div><div class="ttdeci">static const entity_pos_t g_GoalDelta</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00101">CCmpUnitMotion.cpp:101</a></div></div>
<div class="ttc" id="Profile_8h_html_a6766aaa4b64ace39c242f179d917c746"><div class="ttname"><a href="Profile_8h.html#a6766aaa4b64ace39c242f179d917c746">PROFILE</a></div><div class="ttdeci">#define PROFILE(name)</div><div class="ttdef"><b>Definition:</b> <a href="Profile_8h_source.html#l00195">Profile.h:195</a></div></div>
<div class="ttc" id="Component_8h_html_a802718af26c925716144a7eb72441e6f"><div class="ttname"><a href="Component_8h.html#a802718af26c925716144a7eb72441e6f">DEFAULT_COMPONENT_ALLOCATOR</a></div><div class="ttdeci">#define DEFAULT_COMPONENT_ALLOCATOR(cname)</div><div class="ttdef"><b>Definition:</b> <a href="Component_8h_source.html#l00044">Component.h:44</a></div></div>
<div class="ttc" id="Components_8h_html_aeed5f0d6bf70b510e5eb09522ea8fb6faacb54dda3f3589bfb5be5c8c5e49c46a"><div class="ttname"><a href="Components_8h.html#aeed5f0d6bf70b510e5eb09522ea8fb6faacb54dda3f3589bfb5be5c8c5e49c46a">MT_PathResult</a></div><div class="ttdef"><b>Definition:</b> <a href="Components_8h_source.html#l00080">Components.h:80</a></div></div>
<div class="ttc" id="classICmpPathfinder_html_acf52d00dca18cc834a97eef4e614c46f"><div class="ttname"><a href="classICmpPathfinder.html#acf52d00dca18cc834a97eef4e614c46f">ICmpPathfinder::ComputePathAsync</a></div><div class="ttdeci">virtual u32 ComputePathAsync(entity_pos_t x0, entity_pos_t z0, const Goal &amp;goal, pass_class_t passClass, cost_class_t costClass, entity_id_t notify)=0</div><div class="ttdoc">Asynchronous version of ComputePath. </div></div>
<div class="ttc" id="classIComponent_html_adecb3e6a4da223d0b028401b8519c424"><div class="ttname"><a href="classIComponent.html#adecb3e6a4da223d0b028401b8519c424">IComponent::GetSimContext</a></div><div class="ttdeci">const CSimContext &amp; GetSimContext() const </div><div class="ttdef"><b>Definition:</b> <a href="IComponent_8h_source.html#l00052">IComponent.h:52</a></div></div>
<div class="ttc" id="classICmpRangeManager_html_a7fee710a4a6a1053773f621e16300291a6754b0a097f05a82044462fc67da74d5"><div class="ttname"><a href="classICmpRangeManager.html#a7fee710a4a6a1053773f621e16300291a6754b0a097f05a82044462fc67da74d5">ICmpRangeManager::VIS_HIDDEN</a></div><div class="ttdef"><b>Definition:</b> <a href="ICmpRangeManager_8h_source.html#l00199">ICmpRangeManager.h:199</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a96ee6c4ce3cbe23a59cae462349df890"><div class="ttname"><a href="classCCmpUnitMotion.html#a96ee6c4ce3cbe23a59cae462349df890">CCmpUnitMotion::IsInTargetRange</a></div><div class="ttdeci">virtual bool IsInTargetRange(entity_id_t target, entity_pos_t minRange, entity_pos_t maxRange)</div><div class="ttdoc">Determine whether the target is within the given range, using the same measurement as MoveToTargetRan...</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01563">CCmpUnitMotion.cpp:1563</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a676d0fa1e26f6cc0971369b2db98e925"><div class="ttname"><a href="classCCmpUnitMotion.html#a676d0fa1e26f6cc0971369b2db98e925">CCmpUnitMotion::StartSucceeded</a></div><div class="ttdeci">void StartSucceeded()</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00504">CCmpUnitMotion.cpp:504</a></div></div>
<div class="ttc" id="classCMessagePathResult_html_a299f88426e8dec2734f6a2a03f4900ea"><div class="ttname"><a href="classCMessagePathResult.html#a299f88426e8dec2734f6a2a03f4900ea">CMessagePathResult::ticket</a></div><div class="ttdeci">u32 ticket</div><div class="ttdef"><b>Definition:</b> <a href="MessageTypes_8h_source.html#l00364">MessageTypes.h:364</a></div></div>
<div class="ttc" id="Components_8h_html_aeed5f0d6bf70b510e5eb09522ea8fb6faf51beea244290e2655654c92646b88e2"><div class="ttname"><a href="Components_8h.html#aeed5f0d6bf70b510e5eb09522ea8fb6faf51beea244290e2655654c92646b88e2">MT_Update_MotionUnit</a></div><div class="ttdef"><b>Definition:</b> <a href="Components_8h_source.html#l00067">Components.h:67</a></div></div>
<div class="ttc" id="classCmpPtr_html"><div class="ttname"><a href="classCmpPtr.html">CmpPtr</a></div><div class="ttdoc">A simplified syntax for accessing entity components. </div><div class="ttdef"><b>Definition:</b> <a href="CmpPtr_8h_source.html#l00055">CmpPtr.h:55</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_af00dcfe76180ea96cec7adb5b07bfa58a5823441be899123f667b039ce0fbd994"><div class="ttname"><a href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a5823441be899123f667b039ce0fbd994">CCmpUnitMotion::PATHSTATE_FOLLOWING_REQUESTING_SHORT</a></div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00207">CCmpUnitMotion.cpp:207</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_af00dcfe76180ea96cec7adb5b07bfa58a9c25c36c5a1beff0f26a6c03868acfbd"><div class="ttname"><a href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a9c25c36c5a1beff0f26a6c03868acfbd">CCmpUnitMotion::PATHSTATE_FOLLOWING</a></div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00191">CCmpUnitMotion.cpp:191</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a8723b6cafab3423d1d8d423e17c27f34"><div class="ttname"><a href="classCCmpUnitMotion.html#a8723b6cafab3423d1d8d423e17c27f34">CCmpUnitMotion::IsMoving</a></div><div class="ttdeci">virtual bool IsMoving()</div><div class="ttdoc">Get whether the unit is moving. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00405">CCmpUnitMotion.cpp:405</a></div></div>
<div class="ttc" id="wposix__types_8h_html_af10f4c58d91a6fa30ccc8a19d0ecbf48"><div class="ttname"><a href="wposix__types_8h.html#af10f4c58d91a6fa30ccc8a19d0ecbf48">ssize_t</a></div><div class="ttdeci">intptr_t ssize_t</div><div class="ttdef"><b>Definition:</b> <a href="wposix__types_8h_source.html#l00082">wposix_types.h:82</a></div></div>
<div class="ttc" id="classIComponent_html_ad24e00d357aade9c7c7973c8303bc618"><div class="ttname"><a href="classIComponent.html#ad24e00d357aade9c7c7973c8303bc618">IComponent::GetSystemEntity</a></div><div class="ttdeci">CEntityHandle GetSystemEntity() const </div><div class="ttdef"><b>Definition:</b> <a href="IComponent_8h_source.html#l00050">IComponent.h:50</a></div></div>
<div class="ttc" id="classCFixed_html_a504183a15db764dc9e5416f7f4916037"><div class="ttname"><a href="classCFixed.html#a504183a15db764dc9e5416f7f4916037">CFixed::FromInt</a></div><div class="ttdeci">static CFixed FromInt(int n)</div><div class="ttdef"><b>Definition:</b> <a href="Fixed_8h_source.html#l00136">Fixed.h:136</a></div></div>
<div class="ttc" id="Render_8h_html"><div class="ttname"><a href="Render_8h.html">Render.h</a></div><div class="ttdoc">Helper functions related to rendering. </div></div>
<div class="ttc" id="ICmpRangeManager_8h_html"><div class="ttname"><a href="ICmpRangeManager_8h.html">ICmpRangeManager.h</a></div></div>
<div class="ttc" id="classICmpObstruction_html_ac79f23ea652401c66dc4b5211b655ffb"><div class="ttname"><a href="classICmpObstruction.html#ac79f23ea652401c66dc4b5211b655ffb">ICmpObstruction::GetUnitRadius</a></div><div class="ttdeci">virtual entity_pos_t GetUnitRadius()=0</div></div>
<div class="ttc" id="classCComponentManager_html_a5477e1ed6d204a35035386ff924af2c9"><div class="ttname"><a href="classCComponentManager.html#a5477e1ed6d204a35035386ff924af2c9">CComponentManager::PostMessage</a></div><div class="ttdeci">void PostMessage(entity_id_t ent, const CMessage &amp;msg) const </div><div class="ttdoc">Send a message, targeted at a particular entity. </div><div class="ttdef"><b>Definition:</b> <a href="ComponentManager_8cpp_source.html#l00848">ComponentManager.cpp:848</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a1198bb1bc6d082ea3a4cc5432d30249d"><div class="ttname"><a href="classCCmpUnitMotion.html#a1198bb1bc6d082ea3a4cc5432d30249d">CCmpUnitMotion::m_ShortPath</a></div><div class="ttdeci">ICmpPathfinder::Path m_ShortPath</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00238">CCmpUnitMotion.cpp:238</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_af00dcfe76180ea96cec7adb5b07bfa58a87c26345fd39dbf9fe41dd983ff9d5fe"><div class="ttname"><a href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a87c26345fd39dbf9fe41dd983ff9d5fe">CCmpUnitMotion::PATHSTATE_FOLLOWING_REQUESTING_SHORT_APPEND</a></div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00216">CCmpUnitMotion.cpp:216</a></div></div>
<div class="ttc" id="classCFixedVector2D_html_a55fcaadc177fb4bd7fcde641cbe32deb"><div class="ttname"><a href="classCFixedVector2D.html#a55fcaadc177fb4bd7fcde641cbe32deb">CFixedVector2D::Length</a></div><div class="ttdeci">fixed Length() const </div><div class="ttdoc">Returns the length of the vector. </div><div class="ttdef"><b>Definition:</b> <a href="FixedVector2D_8h_source.html#l00095">FixedVector2D.h:95</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_addb7828843c29e56cf2785af6d430a06"><div class="ttname"><a href="classCCmpUnitMotion.html#addb7828843c29e56cf2785af6d430a06">CCmpUnitMotion::TryGoingStraightToTargetEntity</a></div><div class="ttdeci">bool TryGoingStraightToTargetEntity(CFixedVector2D from)</div><div class="ttdoc">Attempts to replace the current path with a straight line to the target entity, if it&amp;#39;s close enough ...</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01024">CCmpUnitMotion.cpp:1024</a></div></div>
<div class="ttc" id="classICmpPathfinder_html_ad04ecab269686efa86276a95d16985e2"><div class="ttname"><a href="classICmpPathfinder.html#ad04ecab269686efa86276a95d16985e2">ICmpPathfinder::SetDebugPath</a></div><div class="ttdeci">virtual void SetDebugPath(entity_pos_t x0, entity_pos_t z0, const Goal &amp;goal, pass_class_t passClass, cost_class_t costClass)=0</div><div class="ttdoc">If the debug overlay is enabled, render the path that will computed by ComputePath. </div></div>
<div class="ttc" id="structICmpPathfinder_1_1Goal_html_a33c4acbb567eb85a4afa7504468d4f53"><div class="ttname"><a href="structICmpPathfinder_1_1Goal.html#a33c4acbb567eb85a4afa7504468d4f53">ICmpPathfinder::Goal::type</a></div><div class="ttdeci">enum ICmpPathfinder::Goal::Type type</div></div>
<div class="ttc" id="classCCmpUnitMotion_html_af00dcfe76180ea96cec7adb5b07bfa58a572497d6361a275d18b442d62fc9d939"><div class="ttname"><a href="classCCmpUnitMotion.html#af00dcfe76180ea96cec7adb5b07bfa58a572497d6361a275d18b442d62fc9d939">CCmpUnitMotion::PATHSTATE_FOLLOWING_REQUESTING_LONG</a></div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00199">CCmpUnitMotion.cpp:199</a></div></div>
<div class="ttc" id="types_8h_html_a332ccd83dfe2973e6cb2b61e4f3ab7e6"><div class="ttname"><a href="types_8h.html#a332ccd83dfe2973e6cb2b61e4f3ab7e6">u32</a></div><div class="ttdeci">#define u32</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00041">types.h:41</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a450a4492346d1a7719ae689ef73ec223"><div class="ttname"><a href="classCCmpUnitMotion.html#a450a4492346d1a7719ae689ef73ec223">CCmpUnitMotion::m_TargetEntity</a></div><div class="ttdeci">entity_id_t m_TargetEntity</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00224">CCmpUnitMotion.cpp:224</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a48b34e624ebc23ab7530fd6188b9fc78a7769f8af2865e068ac2a3e3d8b456630"><div class="ttname"><a href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78a7769f8af2865e068ac2a3e3d8b456630">CCmpUnitMotion::STATE_STOPPING</a></div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00145">CCmpUnitMotion.cpp:145</a></div></div>
<div class="ttc" id="classCMessagePathResult_html"><div class="ttname"><a href="classCMessagePathResult.html">CMessagePathResult</a></div><div class="ttdoc">Sent by CCmpPathfinder after async path requests. </div><div class="ttdef"><b>Definition:</b> <a href="MessageTypes_8h_source.html#l00354">MessageTypes.h:354</a></div></div>
<div class="ttc" id="classCFixed_html_a189317861aacedc60b7d5317cea07f44"><div class="ttname"><a href="classCFixed.html#a189317861aacedc60b7d5317cea07f44">CFixed::IsZero</a></div><div class="ttdeci">bool IsZero() const </div><div class="ttdoc">Returns true if the number is precisely 0. </div><div class="ttdef"><b>Definition:</b> <a href="Fixed_8h_source.html#l00199">Fixed.h:199</a></div></div>
<div class="ttc" id="classCMessageRenderSubmit_html_a240c34c2e2a70a770995617eebf57250"><div class="ttname"><a href="classCMessageRenderSubmit.html#a240c34c2e2a70a770995617eebf57250">CMessageRenderSubmit::collector</a></div><div class="ttdeci">SceneCollector &amp; collector</div><div class="ttdef"><b>Definition:</b> <a href="MessageTypes_8h_source.html#l00155">MessageTypes.h:155</a></div></div>
<div class="ttc" id="structSerializeGoal_html"><div class="ttname"><a href="structSerializeGoal.html">SerializeGoal</a></div><div class="ttdef"><b>Definition:</b> <a href="SerializeTemplates_8h_source.html#l00221">SerializeTemplates.h:221</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a758b9abd0782f12aba62d4b3b91c06eb"><div class="ttname"><a href="classCCmpUnitMotion.html#a758b9abd0782f12aba62d4b3b91c06eb">CCmpUnitMotion::m_WalkSpeed</a></div><div class="ttdeci">fixed m_WalkSpeed</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00123">CCmpUnitMotion.cpp:123</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a58a5c83b5107e3924170a3aa6cd8a3f5"><div class="ttname"><a href="classCCmpUnitMotion.html#a58a5c83b5107e3924170a3aa6cd8a3f5">CCmpUnitMotion::SetSpeed</a></div><div class="ttdeci">virtual void SetSpeed(fixed speed)</div><div class="ttdoc">Set the current movement speed. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00430">CCmpUnitMotion.cpp:430</a></div></div>
<div class="ttc" id="classICmpUnitMotion_html_ac83142f17946fbc1ba42f63453810fb7"><div class="ttname"><a href="classICmpUnitMotion.html#ac83142f17946fbc1ba42f63453810fb7">ICmpUnitMotion::IsMoving</a></div><div class="ttdeci">virtual bool IsMoving()=0</div><div class="ttdoc">Get whether the unit is moving. </div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a48b34e624ebc23ab7530fd6188b9fc78ac145ee9f79f7f5c9ab2049c92902cb0e"><div class="ttname"><a href="classCCmpUnitMotion.html#a48b34e624ebc23ab7530fd6188b9fc78ac145ee9f79f7f5c9ab2049c92902cb0e">CCmpUnitMotion::STATE_MAX</a></div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00162">CCmpUnitMotion.cpp:162</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_ae0b59de7ce5ab1788b1c22cc98b84e51"><div class="ttname"><a href="classCCmpUnitMotion.html#ae0b59de7ce5ab1788b1c22cc98b84e51">CCmpUnitMotion::m_PathState</a></div><div class="ttdeci">u8 m_PathState</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00220">CCmpUnitMotion.cpp:220</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a41b088cbfba75f1535c38e023562726c"><div class="ttname"><a href="classCCmpUnitMotion.html#a41b088cbfba75f1535c38e023562726c">CCmpUnitMotion::SetFacePointAfterMove</a></div><div class="ttdeci">virtual void SetFacePointAfterMove(bool facePointAfterMove)</div><div class="ttdoc">Set whether the unit will turn to face the target point after finishing moving. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00435">CCmpUnitMotion.cpp:435</a></div></div>
<div class="ttc" id="namespaceSimRender_html_a1501f3f2b57f9aab2263a226a73b39f9"><div class="ttname"><a href="namespaceSimRender.html#a1501f3f2b57f9aab2263a226a73b39f9">SimRender::ConstructSquareOnGround</a></div><div class="ttdeci">void ConstructSquareOnGround(const CSimContext &amp;context, float x, float z, float w, float h, float a, SOverlayLine &amp;overlay, bool floating, float heightOffset=0.25f)</div><div class="ttdoc">Constructs overlay line as rectangle with given center and dimensions, conforming to terrain...</div><div class="ttdef"><b>Definition:</b> <a href="Render_8cpp_source.html#l00121">Render.cpp:121</a></div></div>
<div class="ttc" id="CCmpUnitMotion_8cpp_html_ae834109294e10f1dfb96d13ce8d164de"><div class="ttname"><a href="CCmpUnitMotion_8cpp.html#ae834109294e10f1dfb96d13ce8d164de">OVERLAY_COLOUR_SHORT_PATH</a></div><div class="ttdeci">static const CColor OVERLAY_COLOUR_SHORT_PATH(1, 0, 0, 1)</div></div>
<div class="ttc" id="ICmpUnitMotion_8h_html"><div class="ttname"><a href="ICmpUnitMotion_8h.html">ICmpUnitMotion.h</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a84c3817741ac83093d499beb8f877356"><div class="ttname"><a href="classCCmpUnitMotion.html#a84c3817741ac83093d499beb8f877356">CCmpUnitMotion::m_ExpectedPathTicket</a></div><div class="ttdeci">u32 m_ExpectedPathTicket</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00222">CCmpUnitMotion.cpp:222</a></div></div>
<div class="ttc" id="classCFixedVector2D_html_a0014c0852a3007df5a249653ed2453db"><div class="ttname"><a href="classCFixedVector2D.html#a0014c0852a3007df5a249653ed2453db">CFixedVector2D::X</a></div><div class="ttdeci">fixed X</div><div class="ttdef"><b>Definition:</b> <a href="FixedVector2D_8h_source.html#l00027">FixedVector2D.h:27</a></div></div>
<div class="ttc" id="structICmpObstructionManager_1_1ObstructionSquare_html_a2066c7cadb51baab72d43e410c6ac399"><div class="ttname"><a href="structICmpObstructionManager_1_1ObstructionSquare.html#a2066c7cadb51baab72d43e410c6ac399">ICmpObstructionManager::ObstructionSquare::z</a></div><div class="ttdeci">entity_pos_t z</div><div class="ttdef"><b>Definition:</b> <a href="ICmpObstructionManager_8h_source.html#l00234">ICmpObstructionManager.h:234</a></div></div>
<div class="ttc" id="namespaceGeometry_html_a5b9ba13a5e6757ae3da6a575bd95bf52"><div class="ttname"><a href="namespaceGeometry.html#a5b9ba13a5e6757ae3da6a575bd95bf52">Geometry::DistanceToSquare</a></div><div class="ttdeci">fixed DistanceToSquare(CFixedVector2D point, CFixedVector2D u, CFixedVector2D v, CFixedVector2D halfSize)</div><div class="ttdef"><b>Definition:</b> <a href="Geometry_8cpp_source.html#l00053">Geometry.cpp:53</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_abba09bd178e8bc968ff60ae38a925693"><div class="ttname"><a href="classCCmpUnitMotion.html#abba09bd178e8bc968ff60ae38a925693">CCmpUnitMotion::MoveSucceeded</a></div><div class="ttdeci">void MoveSucceeded()</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00510">CCmpUnitMotion.cpp:510</a></div></div>
<div class="ttc" id="classCMessagePathResult_html_a2520f0a6cdf64d2d962e964d17d97556"><div class="ttname"><a href="classCMessagePathResult.html#a2520f0a6cdf64d2d962e964d17d97556">CMessagePathResult::path</a></div><div class="ttdeci">ICmpPathfinder::Path path</div><div class="ttdef"><b>Definition:</b> <a href="MessageTypes_8h_source.html#l00365">MessageTypes.h:365</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a9820f999ea19f1b2ba57a5d9bff5485d"><div class="ttname"><a href="classCCmpUnitMotion.html#a9820f999ea19f1b2ba57a5d9bff5485d">CCmpUnitMotion::m_Speed</a></div><div class="ttdeci">fixed m_Speed</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00230">CCmpUnitMotion.cpp:230</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_ab047430688adc99a66b6ce63e6a73958"><div class="ttname"><a href="classCCmpUnitMotion.html#ab047430688adc99a66b6ce63e6a73958">CCmpUnitMotion::BeginPathing</a></div><div class="ttdeci">void BeginPathing(CFixedVector2D from, const ICmpPathfinder::Goal &amp;goal)</div><div class="ttdoc">Start moving to the given goal, from our current position &amp;#39;from&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l01161">CCmpUnitMotion.cpp:1161</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a435cc60cf8dc29e7ffbceb050bdbddf9"><div class="ttname"><a href="classCCmpUnitMotion.html#a435cc60cf8dc29e7ffbceb050bdbddf9">CCmpUnitMotion::m_CurSpeed</a></div><div class="ttdeci">fixed m_CurSpeed</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00233">CCmpUnitMotion.cpp:233</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a8aa7550bc719e664ef38e29c1d73afad"><div class="ttname"><a href="classCCmpUnitMotion.html#a8aa7550bc719e664ef38e29c1d73afad">CCmpUnitMotion::Deinit</a></div><div class="ttdeci">virtual void Deinit()</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00323">CCmpUnitMotion.cpp:323</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a16e5d08df6279e07afad6649504db5d6"><div class="ttname"><a href="classCCmpUnitMotion.html#a16e5d08df6279e07afad6649504db5d6">CCmpUnitMotion::m_State</a></div><div class="ttdeci">u8 m_State</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00164">CCmpUnitMotion.cpp:164</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a1e119344300ac55d4f121d02719cb83b"><div class="ttname"><a href="classCCmpUnitMotion.html#a1e119344300ac55d4f121d02719cb83b">CCmpUnitMotion::GetPassabilityClass</a></div><div class="ttdeci">virtual ICmpPathfinder::pass_class_t GetPassabilityClass()</div><div class="ttdoc">Get the unit&amp;#39;s passability class. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00420">CCmpUnitMotion.cpp:420</a></div></div>
<div class="ttc" id="Fixed_8cpp_html_a936e2617eba952e705d5b0c42367f965"><div class="ttname"><a href="Fixed_8cpp.html#a936e2617eba952e705d5b0c42367f965">atan2_approx</a></div><div class="ttdeci">CFixed_15_16 atan2_approx(CFixed_15_16 y, CFixed_15_16 x)</div><div class="ttdoc">Inaccurate approximation of atan2 over fixed-point numbers. </div><div class="ttdef"><b>Definition:</b> <a href="Fixed_8cpp_source.html#l00147">Fixed.cpp:147</a></div></div>
<div class="ttc" id="structICmpPathfinder_1_1Waypoint_html"><div class="ttname"><a href="structICmpPathfinder_1_1Waypoint.html">ICmpPathfinder::Waypoint</a></div><div class="ttdef"><b>Definition:</b> <a href="ICmpPathfinder_8h_source.html#l00066">ICmpPathfinder.h:66</a></div></div>
<div class="ttc" id="classICmpPathfinder_html_aca615c664f02e1a2ca00dbd6e4fc4a58"><div class="ttname"><a href="classICmpPathfinder.html#aca615c664f02e1a2ca00dbd6e4fc4a58">ICmpPathfinder::GetNearestPointOnGoal</a></div><div class="ttdeci">virtual CFixedVector2D GetNearestPointOnGoal(CFixedVector2D pos, const Goal &amp;goal)=0</div><div class="ttdoc">Returns the coordinates of the point on the goal that is closest to pos in a straight line...</div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a936459784cec5e2eb0e1c22cc22bc9dd"><div class="ttname"><a href="classCCmpUnitMotion.html#a936459784cec5e2eb0e1c22cc22bc9dd">CCmpUnitMotion::MoveFailed</a></div><div class="ttdeci">void MoveFailed()</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00492">CCmpUnitMotion.cpp:492</a></div></div>
<div class="ttc" id="classICmpObstructionManager_html_acee26248d15747cbe5205447aad32d12"><div class="ttname"><a href="classICmpObstructionManager.html#acee26248d15747cbe5205447aad32d12">ICmpObstructionManager::FindMostImportantObstruction</a></div><div class="ttdeci">virtual bool FindMostImportantObstruction(const IObstructionTestFilter &amp;filter, entity_pos_t x, entity_pos_t z, entity_pos_t r, ObstructionSquare &amp;square)=0</div><div class="ttdoc">Find a single obstruction that blocks a unit at the given point with the given radius. </div></div>
<div class="ttc" id="mikktspace_8cpp_html_acbe63d298ee3ff491978b66b68308efc"><div class="ttname"><a href="mikktspace_8cpp.html#acbe63d298ee3ff491978b66b68308efc">Length</a></div><div class="ttdeci">static float Length(const SVec3 v)</div><div class="ttdef"><b>Definition:</b> <a href="mikktspace_8cpp_source.html#l00112">mikktspace.cpp:112</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_afffc94ff3bdbf7c5790c005af2db461a"><div class="ttname"><a href="classCCmpUnitMotion.html#afffc94ff3bdbf7c5790c005af2db461a">CCmpUnitMotion::StartFailed</a></div><div class="ttdeci">void StartFailed()</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00479">CCmpUnitMotion.cpp:479</a></div></div>
<div class="ttc" id="simulation2_2system_2Entity_8h_html_a1367d00ed40eb3c86920997c86e70b59"><div class="ttname"><a href="simulation2_2system_2Entity_8h.html#a1367d00ed40eb3c86920997c86e70b59">INVALID_ENTITY</a></div><div class="ttdeci">const entity_id_t INVALID_ENTITY</div><div class="ttdoc">Invalid entity ID. </div><div class="ttdef"><b>Definition:</b> <a href="simulation2_2system_2Entity_8h_source.html#l00036">Entity.h:36</a></div></div>
<div class="ttc" id="structICmpPathfinder_1_1Goal_html_abc726e50a5be06efb047fcaac02b81a6"><div class="ttname"><a href="structICmpPathfinder_1_1Goal.html#abc726e50a5be06efb047fcaac02b81a6">ICmpPathfinder::Goal::hw</a></div><div class="ttdeci">entity_pos_t hw</div><div class="ttdef"><b>Definition:</b> <a href="ICmpPathfinder_8h_source.html#l00063">ICmpPathfinder.h:63</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html"><div class="ttname"><a href="classCCmpUnitMotion.html">CCmpUnitMotion</a></div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00103">CCmpUnitMotion.cpp:103</a></div></div>
<div class="ttc" id="simulation2_2system_2Entity_8h_html_a70961dc0512c70c6de7c8f95d4500260"><div class="ttname"><a href="simulation2_2system_2Entity_8h.html#a70961dc0512c70c6de7c8f95d4500260">entity_id_t</a></div><div class="ttdeci">u32 entity_id_t</div><div class="ttdoc">Entity ID type. </div><div class="ttdef"><b>Definition:</b> <a href="simulation2_2system_2Entity_8h_source.html#l00024">Entity.h:24</a></div></div>
<div class="ttc" id="classSceneCollector_html_add461437a15a8d5bfabe39f7104f6741"><div class="ttname"><a href="classSceneCollector.html#add461437a15a8d5bfabe39f7104f6741">SceneCollector::Submit</a></div><div class="ttdeci">virtual void Submit(CPatch *patch)=0</div><div class="ttdoc">Submit a terrain patch that is part of the scene. </div></div>
<div class="ttc" id="classCCmpUnitMotion_html_aed3aacb1208e5f0cb5fc5570a6f71ea3"><div class="ttname"><a href="classCCmpUnitMotion.html#aed3aacb1208e5f0cb5fc5570a6f71ea3">CCmpUnitMotion::SetDebugOverlay</a></div><div class="ttdeci">virtual void SetDebugOverlay(bool enabled)</div><div class="ttdoc">Toggle the rendering of debug info. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00440">CCmpUnitMotion.cpp:440</a></div></div>
<div class="ttc" id="structICmpPathfinder_1_1Goal_html_a56759efe217d039b0c3e75fd8bed5ed2a0f92429c19d8f061aa5bc6efb7d51ac8"><div class="ttname"><a href="structICmpPathfinder_1_1Goal.html#a56759efe217d039b0c3e75fd8bed5ed2a0f92429c19d8f061aa5bc6efb7d51ac8">ICmpPathfinder::Goal::POINT</a></div><div class="ttdef"><b>Definition:</b> <a href="ICmpPathfinder_8h_source.html#l00057">ICmpPathfinder.h:57</a></div></div>
<div class="ttc" id="CCmpUnitMotion_8cpp_html_acc7728eae8f21e4c3332c532aef7c3b6"><div class="ttname"><a href="CCmpUnitMotion_8cpp.html#acc7728eae8f21e4c3332c532aef7c3b6">CHECK_TARGET_MOVEMENT_MIN_DELTA</a></div><div class="ttdeci">static const entity_pos_t CHECK_TARGET_MOVEMENT_MIN_DELTA</div><div class="ttdoc">If we&amp;#39;re following a target entity, we will recompute our path if the target has moved more than this...</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00081">CCmpUnitMotion.cpp:81</a></div></div>
<div class="ttc" id="CCmpUnitMotion_8cpp_html_ae4b3ad47946affd837ef8db3a308a4ea"><div class="ttname"><a href="CCmpUnitMotion_8cpp.html#ae4b3ad47946affd837ef8db3a308a4ea">SHORT_PATH_GOAL_RADIUS</a></div><div class="ttdeci">static const entity_pos_t SHORT_PATH_GOAL_RADIUS</div><div class="ttdoc">When short-pathing to an intermediate waypoint, we aim for a circle of this radius around the waypoin...</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00068">CCmpUnitMotion.cpp:68</a></div></div>
<div class="ttc" id="structICmpObstructionManager_1_1ObstructionSquare_html_a043e0544bb7e58f5418d1c699a48e643"><div class="ttname"><a href="structICmpObstructionManager_1_1ObstructionSquare.html#a043e0544bb7e58f5418d1c699a48e643">ICmpObstructionManager::ObstructionSquare::u</a></div><div class="ttdeci">CFixedVector2D u</div><div class="ttdef"><b>Definition:</b> <a href="ICmpObstructionManager_8h_source.html#l00235">ICmpObstructionManager.h:235</a></div></div>
<div class="ttc" id="structICmpObstructionManager_1_1ObstructionSquare_html"><div class="ttname"><a href="structICmpObstructionManager_1_1ObstructionSquare.html">ICmpObstructionManager::ObstructionSquare</a></div><div class="ttdoc">Standard representation for all types of shapes, for use with geometry processing code...</div><div class="ttdef"><b>Definition:</b> <a href="ICmpObstructionManager_8h_source.html#l00232">ICmpObstructionManager.h:232</a></div></div>
<div class="ttc" id="CLogger_8h_html"><div class="ttname"><a href="CLogger_8h.html">CLogger.h</a></div></div>
<div class="ttc" id="CCmpUnitMotion_8cpp_html_a5a1d29d82321920b3d9d216f12662e3f"><div class="ttname"><a href="CCmpUnitMotion_8cpp.html#a5a1d29d82321920b3d9d216f12662e3f">OVERLAY_COLOUR_LONG_PATH</a></div><div class="ttdeci">static const CColor OVERLAY_COLOUR_LONG_PATH(1, 1, 1, 1)</div></div>
<div class="ttc" id="Geometry_8h_html"><div class="ttname"><a href="Geometry_8h.html">Geometry.h</a></div><div class="ttdoc">Helper functions related to geometry algorithms. </div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a882244efda407ab44364464359187860"><div class="ttname"><a href="classCCmpUnitMotion.html#a882244efda407ab44364464359187860">CCmpUnitMotion::m_DebugOverlayLongPathLines</a></div><div class="ttdeci">std::vector&lt; SOverlayLine &gt; m_DebugOverlayLongPathLines</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00117">CCmpUnitMotion.cpp:117</a></div></div>
<div class="ttc" id="classCSimContext_html_aca4aa944392b2d6282fa37975c3f0b0b"><div class="ttname"><a href="classCSimContext.html#aca4aa944392b2d6282fa37975c3f0b0b">CSimContext::GetComponentManager</a></div><div class="ttdeci">CComponentManager &amp; GetComponentManager() const </div><div class="ttdef"><b>Definition:</b> <a href="SimContext_8cpp_source.html#l00035">SimContext.cpp:35</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a6e5bde87dc6dcfd34fc55496c6f650dd"><div class="ttname"><a href="classCCmpUnitMotion.html#a6e5bde87dc6dcfd34fc55496c6f650dd">CCmpUnitMotion::m_Moving</a></div><div class="ttdeci">bool m_Moving</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00131">CCmpUnitMotion.cpp:131</a></div></div>
<div class="ttc" id="ICmpPathfinder_8h_html"><div class="ttname"><a href="ICmpPathfinder_8h.html">ICmpPathfinder.h</a></div></div>
<div class="ttc" id="Profile_8h_html"><div class="ttname"><a href="Profile_8h.html">Profile.h</a></div></div>
<div class="ttc" id="classIDeserializer_html"><div class="ttname"><a href="classIDeserializer.html">IDeserializer</a></div><div class="ttdoc">Deserialization interface; see serialization overview. </div><div class="ttdef"><b>Definition:</b> <a href="IDeserializer_8h_source.html#l00034">IDeserializer.h:34</a></div></div>
<div class="ttc" id="classCMessage_html"><div class="ttname"><a href="classCMessage.html">CMessage</a></div><div class="ttdef"><b>Definition:</b> <a href="Message_8h_source.html#l00024">Message.h:24</a></div></div>
<div class="ttc" id="structICmpObstructionManager_1_1ObstructionSquare_html_abd31b33c563c412e21358fe255ce51d9"><div class="ttname"><a href="structICmpObstructionManager_1_1ObstructionSquare.html#abd31b33c563c412e21358fe255ce51d9">ICmpObstructionManager::ObstructionSquare::v</a></div><div class="ttdeci">CFixedVector2D v</div><div class="ttdef"><b>Definition:</b> <a href="ICmpObstructionManager_8h_source.html#l00235">ICmpObstructionManager.h:235</a></div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a2cbb3eea8db350a3f2e18683a3babf01"><div class="ttname"><a href="classCCmpUnitMotion.html#a2cbb3eea8db350a3f2e18683a3babf01">CCmpUnitMotion::m_FinalGoal</a></div><div class="ttdeci">ICmpPathfinder::Goal m_FinalGoal</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00240">CCmpUnitMotion.cpp:240</a></div></div>
<div class="ttc" id="structICmpPathfinder_1_1Goal_html"><div class="ttname"><a href="structICmpPathfinder_1_1Goal.html">ICmpPathfinder::Goal</a></div><div class="ttdef"><b>Definition:</b> <a href="ICmpPathfinder_8h_source.html#l00054">ICmpPathfinder.h:54</a></div></div>
<div class="ttc" id="CCmpUnitMotion_8cpp_html_a988a5848b0f3521a55aec39e7ccec426"><div class="ttname"><a href="CCmpUnitMotion_8cpp.html#a988a5848b0f3521a55aec39e7ccec426">SHORT_PATH_SEARCH_RANGE</a></div><div class="ttdeci">static const entity_pos_t SHORT_PATH_SEARCH_RANGE</div><div class="ttdoc">Maximum range to restrict short path queries to. </div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00061">CCmpUnitMotion.cpp:61</a></div></div>
<div class="ttc" id="classICmpPosition_html_a2bac72ab929078355ea08e64cb2b1f0c"><div class="ttname"><a href="classICmpPosition.html#a2bac72ab929078355ea08e64cb2b1f0c">ICmpPosition::IsFloating</a></div><div class="ttdeci">virtual bool IsFloating()=0</div><div class="ttdoc">Returns whether the entity floats on water. </div></div>
<div class="ttc" id="classCCmpUnitMotion_html_a4b80cadeba97790c2a2c2375af2007e7"><div class="ttname"><a href="classCCmpUnitMotion.html#a4b80cadeba97790c2a2c2375af2007e7">CCmpUnitMotion::m_PassClass</a></div><div class="ttdeci">ICmpPathfinder::pass_class_t m_PassClass</div><div class="ttdef"><b>Definition:</b> <a href="CCmpUnitMotion_8cpp_source.html#l00125">CCmpUnitMotion.cpp:125</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Oct 14 2013 00:58:09 for Pyrogenesis by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
