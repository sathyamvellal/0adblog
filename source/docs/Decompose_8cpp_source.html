<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Pyrogenesis: /home/sathyam/0ad.svn/source/collada/Decompose.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Pyrogenesis
   &#160;<span id="projectnumber">13997</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_b2f33c71d4aa5e7af42a1ca61ff5af1b.html">source</a></li><li class="navelem"><a class="el" href="dir_d196d55958f86acf0c255b16363d7821.html">collada</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Decompose.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="Decompose_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* Copyright (C) 2013 Wildfire Games.</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * This file is part of 0 A.D.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * 0 A.D. is free software: you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * the Free Software Foundation, either version 2 of the License, or</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * (at your option) any later version.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * 0 A.D. is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * GNU General Public License for more details.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * along with 0 A.D.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="collada_2precompiled_8h.html">precompiled.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#ifdef _MSC_VER</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor"></span><span class="preprocessor"># pragma warning(disable: 4244 4305 4127 4701)</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">/**** Decompose.c ****/</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">/* Ken Shoemake, 1993 */</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Decompose_8h.html">Decompose.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">/******* Matrix Preliminaries *******/</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">/** Fill out 3x3 matrix to 4x4 **/</span></div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#a6e77b46d645e6a6866c3260d7389976a">   32</a></span>&#160;<span class="preprocessor">#define mat_pad(A) (A[W][X]=A[X][W]=A[W][Y]=A[Y][W]=A[W][Z]=A[Z][W]=0,A[W][W]=1)</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor"></span><span class="comment"></span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/** Copy nxn matrix A to C using &quot;gets&quot; for assignment **/</span></div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#a0eb958b865b3083981030654274ce09e">   35</a></span>&#160;<span class="preprocessor">#define mat_copy(C,gets,A,n) {int i,j; for(i=0;i&lt;n;i++) for(j=0;j&lt;n;j++)\</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">    C[i][j] gets (A[i][j]);}</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor"></span><span class="comment"></span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">/** Copy transpose of nxn matrix A to C using &quot;gets&quot; for assignment **/</span></div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#a14951b3900fb3530b2f9d2752443d3f2">   39</a></span>&#160;<span class="preprocessor">#define mat_tpose(AT,gets,A,n) {int i,j; for(i=0;i&lt;n;i++) for(j=0;j&lt;n;j++)\</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">    AT[i][j] gets (A[j][i]);}</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor"></span><span class="comment"></span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">/** Assign nxn matrix C the element-wise combination of A and B using &quot;op&quot; **/</span></div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#afefe0cd67712bd5ad28c11631d9c9301">   43</a></span>&#160;<span class="preprocessor">#define mat_binop(C,gets,A,op,B,n) {int i,j; for(i=0;i&lt;n;i++) for(j=0;j&lt;n;j++)\</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">    C[i][j] gets (A[i][j]) op (B[i][j]);}</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor"></span><span class="comment"></span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">/** Multiply the upper left 3x3 parts of A and B to get AB **/</span></div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#a999000523190d36c73eea7b882e8c36c">   47</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="Decompose_8cpp.html#a999000523190d36c73eea7b882e8c36c">mat_mult</a>(<a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> A, <a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> B, <a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> AB)</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;{</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordtype">int</span> i, j;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;3; i++) <span class="keywordflow">for</span> (j=0; j&lt;3; j++)</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    AB[i][j] = A[i][0]*B[0][j] + A[i][1]*B[1][j] + A[i][2]*B[2][j];</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">/** Return dot product of length 3 vectors va and vb **/</span></div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#a1946d69616189dfce2de28adcb58d58e">   55</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="Decompose_8cpp.html#a1946d69616189dfce2de28adcb58d58e">vdot</a>(<span class="keywordtype">float</span> *va, <span class="keywordtype">float</span> *vb)</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;{</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">return</span> (va[0]*vb[0] + va[1]*vb[1] + va[2]*vb[2]);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;}</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">/** Set v to cross product of length 3 vectors va and vb **/</span></div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#a881986a77d1ecf1bec09764c083e6b6c">   61</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="Decompose_8cpp.html#a881986a77d1ecf1bec09764c083e6b6c">vcross</a>(<span class="keywordtype">float</span> *va, <span class="keywordtype">float</span> *vb, <span class="keywordtype">float</span> *v)</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;{</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    v[0] = va[1]*vb[2] - va[2]*vb[1];</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    v[1] = va[2]*vb[0] - va[0]*vb[2];</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    v[2] = va[0]*vb[1] - va[1]*vb[0];</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;}</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">/** Set MadjT to transpose of inverse of M times determinant of M **/</span></div>
<div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#af40876efd26b10d7e2171f1432bfb4bd">   69</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="Decompose_8cpp.html#af40876efd26b10d7e2171f1432bfb4bd">adjoint_transpose</a>(<a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> M, <a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> MadjT)</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;{</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="Decompose_8cpp.html#a881986a77d1ecf1bec09764c083e6b6c">vcross</a>(M[1], M[2], MadjT[0]);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="Decompose_8cpp.html#a881986a77d1ecf1bec09764c083e6b6c">vcross</a>(M[2], M[0], MadjT[1]);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a class="code" href="Decompose_8cpp.html#a881986a77d1ecf1bec09764c083e6b6c">vcross</a>(M[0], M[1], MadjT[2]);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;}</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">/******* Quaternion Preliminaries *******/</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">/* Construct a (possibly non-unit) quaternion from real components. */</span></div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#afc58623ccd7f6293b73b9181b1c647da">   79</a></span>&#160;<a class="code" href="structQuat.html">Quat</a> <a class="code" href="Decompose_8cpp.html#afc58623ccd7f6293b73b9181b1c647da">Qt_</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">float</span> z, <span class="keywordtype">float</span> w)</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;{</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <a class="code" href="structQuat.html">Quat</a> qq;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    qq.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a> = x; qq.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a> = y; qq.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a> = z; qq.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a> = w;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">return</span> (qq);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">/* Return conjugate of quaternion. */</span></div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#abb49adb3b77cb0e9a4be911e1e15f9f9">   87</a></span>&#160;<a class="code" href="structQuat.html">Quat</a> <a class="code" href="Decompose_8cpp.html#abb49adb3b77cb0e9a4be911e1e15f9f9">Qt_Conj</a>(<a class="code" href="structQuat.html">Quat</a> q)</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;{</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <a class="code" href="structQuat.html">Quat</a> qq;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    qq.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a> = -q.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a>; qq.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a> = -q.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a>; qq.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a> = -q.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>; qq.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a> = q.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">return</span> (qq);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;}</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">/* Return quaternion product qL * qR.  Note: order is important!</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"> * To combine rotations, use the product Mul(qSecond, qFirst),</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment"> * which gives the effect of rotating by qFirst then qSecond. */</span></div>
<div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#ae2c61a5c8edc3f499553088f3011b932">   97</a></span>&#160;<a class="code" href="structQuat.html">Quat</a> <a class="code" href="Decompose_8cpp.html#ae2c61a5c8edc3f499553088f3011b932">Qt_Mul</a>(<a class="code" href="structQuat.html">Quat</a> qL, <a class="code" href="structQuat.html">Quat</a> qR)</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;{</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="structQuat.html">Quat</a> qq;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    qq.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a> = qL.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a>*qR.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a> - qL.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a>*qR.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a> - qL.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a>*qR.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a> - qL.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>*qR.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    qq.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a> = qL.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a>*qR.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a> + qL.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a>*qR.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a> + qL.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a>*qR.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a> - qL.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>*qR.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    qq.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a> = qL.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a>*qR.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a> + qL.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a>*qR.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a> + qL.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>*qR.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a> - qL.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a>*qR.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    qq.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a> = qL.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a>*qR.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a> + qL.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>*qR.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a> + qL.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a>*qR.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a> - qL.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a>*qR.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a>;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">return</span> (qq);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;}</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">/* Return product of quaternion q by scalar w. */</span></div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#a449765b0cc04a4d3392bf94d1b8b0a59">  108</a></span>&#160;<a class="code" href="structQuat.html">Quat</a> <a class="code" href="Decompose_8cpp.html#a449765b0cc04a4d3392bf94d1b8b0a59">Qt_Scale</a>(<a class="code" href="structQuat.html">Quat</a> q, <span class="keywordtype">float</span> w)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;{</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <a class="code" href="structQuat.html">Quat</a> qq;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    qq.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a> = q.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a>*w; qq.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a> = q.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a>*w; qq.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a> = q.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a>*w; qq.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a> = q.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>*w;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">return</span> (qq);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;}</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">/* Construct a unit quaternion from rotation matrix.  Assumes matrix is</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment"> * used to multiply column vector on the left: vnew = mat vold.  Works</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"> * correctly for right-handed coordinate system and right-handed rotations.</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment"> * Translation and perspective components ignored. */</span></div>
<div class="line"><a name="l00119"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#a1b7e3263125ead38d0c94c3158788a55">  119</a></span>&#160;<a class="code" href="structQuat.html">Quat</a> <a class="code" href="Decompose_8cpp.html#a1b7e3263125ead38d0c94c3158788a55">Qt_FromMatrix</a>(<a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> mat)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;{</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment">/* This algorithm avoids near-zero divides by looking for a large component</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">     * - first w, then x, y, or z.  When the trace is greater than zero,</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">     * |w| is greater than 1/2, which is as small as a largest component can be.</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">     * Otherwise, the largest diagonal entry corresponds to the largest of |x|,</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">     * |y|, or |z|, one of which must be larger than |w|, and at least 1/2. */</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <a class="code" href="structQuat.html">Quat</a> qu;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keyword">register</span> <span class="keywordtype">double</span> tr, s;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    tr = mat[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>] + mat[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>]+ mat[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>];</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">if</span> (tr &gt;= 0.0) {</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        s = sqrt(tr + mat[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6ab722ceeb601c72cd78fbd35f3581fdf7">W</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6ab722ceeb601c72cd78fbd35f3581fdf7">W</a>]);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        qu.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a> = s*0.5;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        s = 0.5 / s;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        qu.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a> = (mat[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>] - mat[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>]) * s;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        qu.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a> = (mat[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>] - mat[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>]) * s;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        qu.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a> = (mat[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>] - mat[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>]) * s;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="keywordtype">int</span> h = <a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordflow">if</span> (mat[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>] &gt; mat[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>]) h = <a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">if</span> (mat[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>] &gt; mat[h][h]) h = <a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keywordflow">switch</span> (h) {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="preprocessor">#define caseMacro(i,j,k,I,J,K) \</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="preprocessor">        case I:\</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="preprocessor">        s = sqrt( (mat[I][I] - (mat[J][J]+mat[K][K])) + mat[W][W] );\</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="preprocessor">        qu.i = s*0.5;\</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="preprocessor">        s = 0.5 / s;\</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="preprocessor">        qu.j = (mat[I][J] + mat[J][I]) * s;\</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="preprocessor">        qu.k = (mat[K][I] + mat[I][K]) * s;\</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="preprocessor">        qu.w = (mat[K][J] - mat[J][K]) * s;\</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="preprocessor">        break</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="preprocessor"></span>        <a class="code" href="Decompose_8cpp.html#a680c8bc94fb11bd684b4edab2d6e48d3">caseMacro</a>(x,y,z,X,<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>,<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <a class="code" href="Decompose_8cpp.html#a680c8bc94fb11bd684b4edab2d6e48d3">caseMacro</a>(y,z,x,<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>,<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>,X);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <a class="code" href="Decompose_8cpp.html#a680c8bc94fb11bd684b4edab2d6e48d3">caseMacro</a>(z,x,y,<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>,X,<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">if</span> (mat[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6ab722ceeb601c72cd78fbd35f3581fdf7">W</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6ab722ceeb601c72cd78fbd35f3581fdf7">W</a>] != 1.0) qu = <a class="code" href="Decompose_8cpp.html#a449765b0cc04a4d3392bf94d1b8b0a59">Qt_Scale</a>(qu, 1/sqrt(mat[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6ab722ceeb601c72cd78fbd35f3581fdf7">W</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6ab722ceeb601c72cd78fbd35f3581fdf7">W</a>]));</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">return</span> (qu);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;}</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">/******* Decomp Auxiliaries *******/</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#af168980514ee73c4970441bdcfe3e618">  161</a></span>&#160;<span class="keyword">static</span> <a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> <a class="code" href="Decompose_8cpp.html#af168980514ee73c4970441bdcfe3e618">mat_id</a> = {{1,0,0,0},{0,1,0,0},{0,0,1,0},{0,0,0,1}};</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">/** Compute either the 1 or infinity norm of M, depending on tpose **/</span></div>
<div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#ac6ccf9784e5440507d88f82d056a29ea">  164</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="Decompose_8cpp.html#ac6ccf9784e5440507d88f82d056a29ea">mat_norm</a>(<a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> M, <span class="keywordtype">int</span> tpose)</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;{</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordtype">float</span> sum, max;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    max = 0.0;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;3; i++) {</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">if</span> (tpose) sum = fabs(M[0][i])+fabs(M[1][i])+fabs(M[2][i]);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">else</span>       sum = fabs(M[i][0])+fabs(M[i][1])+fabs(M[i][2]);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">if</span> (max&lt;sum) max = sum;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">return</span> max;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;}</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#a08953def9317ac094b2cd0f4ab056706">  177</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="Decompose_8cpp.html#a08953def9317ac094b2cd0f4ab056706">norm_inf</a>(<a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> M) {<span class="keywordflow">return</span> <a class="code" href="Decompose_8cpp.html#ac6ccf9784e5440507d88f82d056a29ea">mat_norm</a>(M, 0);}</div>
<div class="line"><a name="l00178"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#a2e8a58dabbe86bf9000fe3f1d10bad0e">  178</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="Decompose_8cpp.html#a2e8a58dabbe86bf9000fe3f1d10bad0e">norm_one</a>(<a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> M) {<span class="keywordflow">return</span> <a class="code" href="Decompose_8cpp.html#ac6ccf9784e5440507d88f82d056a29ea">mat_norm</a>(M, 1);}</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">/** Return index of column of M containing maximum abs entry, or -1 if M=0 **/</span></div>
<div class="line"><a name="l00181"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#a23d9f9add72e9530eda90fd602b96abf">  181</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="Decompose_8cpp.html#a23d9f9add72e9530eda90fd602b96abf">find_max_col</a>(<a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> M)</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;{</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordtype">float</span> abs, max;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordtype">int</span> i, j, col;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    max = 0.0; col = -1;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;3; i++) <span class="keywordflow">for</span> (j=0; j&lt;3; j++) {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    abs = M[i][j]; <span class="keywordflow">if</span> (abs&lt;0.0) abs = -abs;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">if</span> (abs&gt;max) {max = abs; col = j;}</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    }</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordflow">return</span> col;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;}</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">/** Setup u for Household reflection to zero all v components but first **/</span></div>
<div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#abfdeef77067f50404058e591a757fe5d">  194</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="Decompose_8cpp.html#abfdeef77067f50404058e591a757fe5d">make_reflector</a>(<span class="keywordtype">float</span> *v, <span class="keywordtype">float</span> *u)</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;{</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordtype">float</span> s = sqrt(<a class="code" href="Decompose_8cpp.html#a1946d69616189dfce2de28adcb58d58e">vdot</a>(v, v));</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    u[0] = v[0]; u[1] = v[1];</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    u[2] = v[2] + ((v[2]&lt;0.0) ? -s : s);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    s = sqrt(2.0/<a class="code" href="Decompose_8cpp.html#a1946d69616189dfce2de28adcb58d58e">vdot</a>(u, u));</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    u[0] = u[0]*s; u[1] = u[1]*s; u[2] = u[2]*s;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;}</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">/** Apply Householder reflection represented by u to column vectors of M **/</span></div>
<div class="line"><a name="l00204"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#ae0fd5b60df7f2605802f9f26327c003d">  204</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="Decompose_8cpp.html#ae0fd5b60df7f2605802f9f26327c003d">reflect_cols</a>(<a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> M, <span class="keywordtype">float</span> *u)</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;{</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordtype">int</span> i, j;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;3; i++) {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordtype">float</span> s = u[0]*M[0][i] + u[1]*M[1][i] + u[2]*M[2][i];</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">for</span> (j=0; j&lt;3; j++) M[j][i] -= u[j]*s;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;}<span class="comment"></span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">/** Apply Householder reflection represented by u to row vectors of M **/</span></div>
<div class="line"><a name="l00213"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#a540588638fd235160a901ed086f399d0">  213</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="Decompose_8cpp.html#a540588638fd235160a901ed086f399d0">reflect_rows</a>(<a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> M, <span class="keywordtype">float</span> *u)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;{</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordtype">int</span> i, j;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;3; i++) {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keywordtype">float</span> s = <a class="code" href="Decompose_8cpp.html#a1946d69616189dfce2de28adcb58d58e">vdot</a>(u, M[i]);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">for</span> (j=0; j&lt;3; j++) M[i][j] -= u[j]*s;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;}</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">/** Find orthogonal factor Q of rank 1 (or less) M **/</span></div>
<div class="line"><a name="l00223"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#a5a50ee36aa24c17675db41e72e2c7375">  223</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="Decompose_8cpp.html#a5a50ee36aa24c17675db41e72e2c7375">do_rank1</a>(<a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> M, <a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> Q)</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;{</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordtype">float</span> v1[3], v2[3], s;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordtype">int</span> col;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <a class="code" href="Decompose_8cpp.html#a0eb958b865b3083981030654274ce09e">mat_copy</a>(Q,=,<a class="code" href="Decompose_8cpp.html#af168980514ee73c4970441bdcfe3e618">mat_id</a>,4);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">/* If rank(M) is 1, we should find a non-zero column in M */</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    col = <a class="code" href="Decompose_8cpp.html#a23d9f9add72e9530eda90fd602b96abf">find_max_col</a>(M);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">if</span> (col&lt;0) <span class="keywordflow">return</span>; <span class="comment">/* Rank is 0 */</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    v1[0] = M[0][col]; v1[1] = M[1][col]; v1[2] = M[2][col];</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <a class="code" href="Decompose_8cpp.html#abfdeef77067f50404058e591a757fe5d">make_reflector</a>(v1, v1); <a class="code" href="Decompose_8cpp.html#ae0fd5b60df7f2605802f9f26327c003d">reflect_cols</a>(M, v1);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    v2[0] = M[2][0]; v2[1] = M[2][1]; v2[2] = M[2][2];</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="Decompose_8cpp.html#abfdeef77067f50404058e591a757fe5d">make_reflector</a>(v2, v2); <a class="code" href="Decompose_8cpp.html#a540588638fd235160a901ed086f399d0">reflect_rows</a>(M, v2);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    s = M[2][2];</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">if</span> (s&lt;0.0) Q[2][2] = -1.0;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <a class="code" href="Decompose_8cpp.html#ae0fd5b60df7f2605802f9f26327c003d">reflect_cols</a>(Q, v1); <a class="code" href="Decompose_8cpp.html#a540588638fd235160a901ed086f399d0">reflect_rows</a>(Q, v2);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;}</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">/** Find orthogonal factor Q of rank 2 (or less) M using adjoint transpose **/</span></div>
<div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="Decompose_8cpp.html#ac8af7bb2cd4f6b977ccae650ac7d646c">  241</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="Decompose_8cpp.html#ac8af7bb2cd4f6b977ccae650ac7d646c">do_rank2</a>(<a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> M, <a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> MadjT, <a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> Q)</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;{</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordtype">float</span> v1[3], v2[3];</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordtype">float</span> w, x, y, z, c, s, d;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordtype">int</span> col;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="comment">/* If rank(M) is 2, we should find a non-zero column in MadjT */</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    col = <a class="code" href="Decompose_8cpp.html#a23d9f9add72e9530eda90fd602b96abf">find_max_col</a>(MadjT);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordflow">if</span> (col&lt;0) {<a class="code" href="Decompose_8cpp.html#a5a50ee36aa24c17675db41e72e2c7375">do_rank1</a>(M, Q); <span class="keywordflow">return</span>;} <span class="comment">/* Rank&lt;2 */</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    v1[0] = MadjT[0][col]; v1[1] = MadjT[1][col]; v1[2] = MadjT[2][col];</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <a class="code" href="Decompose_8cpp.html#abfdeef77067f50404058e591a757fe5d">make_reflector</a>(v1, v1); <a class="code" href="Decompose_8cpp.html#ae0fd5b60df7f2605802f9f26327c003d">reflect_cols</a>(M, v1);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <a class="code" href="Decompose_8cpp.html#a881986a77d1ecf1bec09764c083e6b6c">vcross</a>(M[0], M[1], v2);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <a class="code" href="Decompose_8cpp.html#abfdeef77067f50404058e591a757fe5d">make_reflector</a>(v2, v2); <a class="code" href="Decompose_8cpp.html#a540588638fd235160a901ed086f399d0">reflect_rows</a>(M, v2);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    w = M[0][0]; x = M[0][1]; y = M[1][0]; z = M[1][1];</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">if</span> (w*z&gt;x*y) {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    c = z+w; s = y-x; d = sqrt(c*c+s*s); c = c/d; s = s/d;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    Q[0][0] = Q[1][1] = c; Q[0][1] = -(Q[1][0] = s);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    c = z-w; s = y+x; d = sqrt(c*c+s*s); c = c/d; s = s/d;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    Q[0][0] = -(Q[1][1] = c); Q[0][1] = Q[1][0] = s;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    Q[0][2] = Q[2][0] = Q[1][2] = Q[2][1] = 0.0; Q[2][2] = 1.0;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <a class="code" href="Decompose_8cpp.html#ae0fd5b60df7f2605802f9f26327c003d">reflect_cols</a>(Q, v1); <a class="code" href="Decompose_8cpp.html#a540588638fd235160a901ed086f399d0">reflect_rows</a>(Q, v2);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;}</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">/******* Polar Decomposition *******/</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">/* Polar Decomposition of 3x3 matrix in 4x4,</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment"> * M = QS.  See Nicholas Higham and Robert S. Schreiber,</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment"> * Fast Polar Decomposition of An Arbitrary Matrix,</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment"> * Technical Report 88-942, October 1988,</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment"> * Department of Computer Science, Cornell University.</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="Decompose_8h.html#a5cdb5296d759c4c321d2a7ecf44a2aed">  274</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="Decompose_8cpp.html#a5cdb5296d759c4c321d2a7ecf44a2aed">polar_decomp</a>(<a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> M, <a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> Q, <a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> S)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;{</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="preprocessor">#define TOL 1.0e-6</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="preprocessor"></span>    <a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> Mk, MadjTk, Ek;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordtype">float</span> det, M_one, M_inf, MadjT_one, MadjT_inf, E_one, gamma, g1, g2;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordtype">int</span> i, j;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <a class="code" href="Decompose_8cpp.html#a14951b3900fb3530b2f9d2752443d3f2">mat_tpose</a>(Mk,=,M,3);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    M_one = <a class="code" href="Decompose_8cpp.html#a2e8a58dabbe86bf9000fe3f1d10bad0e">norm_one</a>(Mk);  M_inf = <a class="code" href="Decompose_8cpp.html#a08953def9317ac094b2cd0f4ab056706">norm_inf</a>(Mk);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <a class="code" href="Decompose_8cpp.html#af40876efd26b10d7e2171f1432bfb4bd">adjoint_transpose</a>(Mk, MadjTk);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    det = <a class="code" href="Decompose_8cpp.html#a1946d69616189dfce2de28adcb58d58e">vdot</a>(Mk[0], MadjTk[0]);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">if</span> (det==0.0) {<a class="code" href="Decompose_8cpp.html#ac8af7bb2cd4f6b977ccae650ac7d646c">do_rank2</a>(Mk, MadjTk, Mk); <span class="keywordflow">break</span>;}</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    MadjT_one = <a class="code" href="Decompose_8cpp.html#a2e8a58dabbe86bf9000fe3f1d10bad0e">norm_one</a>(MadjTk); MadjT_inf = <a class="code" href="Decompose_8cpp.html#a08953def9317ac094b2cd0f4ab056706">norm_inf</a>(MadjTk);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    gamma = sqrt(sqrt((MadjT_one*MadjT_inf)/(M_one*M_inf))/fabs(det));</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    g1 = gamma*0.5;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    g2 = 0.5/(gamma*det);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="Decompose_8cpp.html#a0eb958b865b3083981030654274ce09e">mat_copy</a>(Ek,=,Mk,3);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="Decompose_8cpp.html#afefe0cd67712bd5ad28c11631d9c9301">mat_binop</a>(Mk,=,g1*Mk,+,g2*MadjTk,3);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <a class="code" href="Decompose_8cpp.html#a0eb958b865b3083981030654274ce09e">mat_copy</a>(Ek,-=,Mk,3);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    E_one = <a class="code" href="Decompose_8cpp.html#a2e8a58dabbe86bf9000fe3f1d10bad0e">norm_one</a>(Ek);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    M_one = <a class="code" href="Decompose_8cpp.html#a2e8a58dabbe86bf9000fe3f1d10bad0e">norm_one</a>(Mk);  M_inf = <a class="code" href="Decompose_8cpp.html#a08953def9317ac094b2cd0f4ab056706">norm_inf</a>(Mk);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    } <span class="keywordflow">while</span> (E_one&gt;(M_one*<a class="code" href="Decompose_8cpp.html#a156b862ebf6d213f5da19b9e3ccb779e">TOL</a>));</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <a class="code" href="Decompose_8cpp.html#a14951b3900fb3530b2f9d2752443d3f2">mat_tpose</a>(Q,=,Mk,3); <a class="code" href="Decompose_8cpp.html#a6e77b46d645e6a6866c3260d7389976a">mat_pad</a>(Q);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <a class="code" href="Decompose_8cpp.html#a999000523190d36c73eea7b882e8c36c">mat_mult</a>(Mk, M, S);  <a class="code" href="Decompose_8cpp.html#a6e77b46d645e6a6866c3260d7389976a">mat_pad</a>(S);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;3; i++) <span class="keywordflow">for</span> (j=i; j&lt;3; j++)</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    S[i][j] = S[j][i] = 0.5*(S[i][j]+S[j][i]);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">return</span> (det);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">/******* Spectral Decomposition *******/</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">/* Compute the spectral decomposition of symmetric positive semi-definite S.</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment"> * Returns rotation in U and scale factors in result, so that if K is a diagonal</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment"> * matrix of the scale factors, then S = U K (U transpose). Uses Jacobi method.</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment"> * See Gene H. Golub and Charles F. Van Loan. Matrix Computations. Hopkins 1983.</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00326"></a><span class="lineno"><a class="line" href="Decompose_8h.html#a9988f0b6c5f665fd49841ab3be81e9e0">  326</a></span>&#160;<a class="code" href="structQuat.html">HVect</a> <a class="code" href="Decompose_8cpp.html#a9988f0b6c5f665fd49841ab3be81e9e0">spect_decomp</a>(<a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> S, <a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> <a class="code" href="namespacex86__x64_1_1CPUID2.html#a3917d6143f871daa4671068a43e433c0a11be6f91f789b0949ac5b822708364b7">U</a>)</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;{</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <a class="code" href="structQuat.html">HVect</a> kv;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordtype">double</span> Diag[3],OffD[3]; <span class="comment">/* OffD is off-diag (by omitted index) */</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordtype">double</span> g,h,fabsh,fabsOffDi,t,theta,c,s,tau,ta,OffDq,a,b;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">char</span> nxt[] = {<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>,<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>,<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>};</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordtype">int</span> sweep, i, j;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="Decompose_8cpp.html#a0eb958b865b3083981030654274ce09e">mat_copy</a>(U,=,<a class="code" href="Decompose_8cpp.html#af168980514ee73c4970441bdcfe3e618">mat_id</a>,4);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    Diag[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>] = S[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>]; Diag[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>] = S[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>]; Diag[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>] = S[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>];</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    OffD[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>] = S[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>]; OffD[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>] = S[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>]; OffD[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>] = S[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>];</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">for</span> (sweep=20; sweep&gt;0; sweep--) {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordtype">float</span> sm = fabs(OffD[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>])+fabs(OffD[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>])+fabs(OffD[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>]);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">if</span> (sm==0.0) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">for</span> (i=Z; i&gt;=<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>; i--) {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keywordtype">int</span> p = nxt[i]; <span class="keywordtype">int</span> q = nxt[p];</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        fabsOffDi = fabs(OffD[i]);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        g = 100.0*fabsOffDi;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="keywordflow">if</span> (fabsOffDi&gt;0.0) {</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        h = Diag[q] - Diag[p];</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        fabsh = fabs(h);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="keywordflow">if</span> (fabsh+g==fabsh) {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            t = OffD[i]/h;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            theta = 0.5*h/OffD[i];</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            t = 1.0/(fabs(theta)+sqrt(theta*theta+1.0));</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            <span class="keywordflow">if</span> (theta&lt;0.0) t = -t;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        c = 1.0/sqrt(t*t+1.0); s = t*c;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        tau = s/(c+1.0);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        ta = t*OffD[i]; OffD[i] = 0.0;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        Diag[p] -= ta; Diag[q] += ta;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        OffDq = OffD[q];</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        OffD[q] -= s*(OffD[p] + tau*OffD[q]);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        OffD[p] += s*(OffDq   - tau*OffD[p]);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <span class="keywordflow">for</span> (j=Z; j&gt;=<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>; j--) {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            a = U[j][p]; b = U[j][q];</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            U[j][p] -= s*(b + tau*a);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            U[j][q] += s*(a - tau*b);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    kv.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a> = Diag[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>]; kv.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a> = Diag[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>]; kv.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a> = Diag[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>]; kv.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a> = 1.0;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">return</span> (kv);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;}</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">/******* Spectral Axis Adjustment *******/</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">/* Given a unit quaternion, q, and a scale vector, k, find a unit quaternion, p,</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment"> * which permutes the axes and turns freely in the plane of duplicate scale</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment"> * factors, such that q p has the largest possible w component, i.e. the</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment"> * smallest possible angle. Permutes k&#39;s components to go with q p instead of q.</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment"> * See Ken Shoemake and Tom Duff. Matrix Animation and Polar Decomposition.</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment"> * Proceedings of Graphics Interface 1992. Details on p. 262-263.</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00381"></a><span class="lineno"><a class="line" href="Decompose_8h.html#aa02b9c79f6cd71904d06095e537f8b12">  381</a></span>&#160;<a class="code" href="structQuat.html">Quat</a> <a class="code" href="Decompose_8cpp.html#aa02b9c79f6cd71904d06095e537f8b12">snuggle</a>(<a class="code" href="structQuat.html">Quat</a> q, <a class="code" href="structQuat.html">HVect</a> *k)</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;{</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="preprocessor">#define SQRTHALF (0.7071067811865475244)</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define sgn(n,v)    ((n)?-(v):(v))</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define swap(a,i,j) {a[3]=a[i]; a[i]=a[j]; a[j]=a[3];}</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define cycle(a,p)  if (p) {a[3]=a[0]; a[0]=a[1]; a[1]=a[2]; a[2]=a[3];}\</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="preprocessor">            else   {a[3]=a[2]; a[2]=a[1]; a[1]=a[0]; a[0]=a[3];}</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="preprocessor"></span>    <a class="code" href="structQuat.html">Quat</a> p;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keywordtype">float</span> ka[4];</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordtype">int</span> i, turn = -1;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    ka[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>] = k-&gt;<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a>; ka[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>] = k-&gt;<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a>; ka[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>] = k-&gt;<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">if</span> (ka[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>]==ka[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>]) {<span class="keywordflow">if</span> (ka[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>]==ka[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>]) turn = <a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6ab722ceeb601c72cd78fbd35f3581fdf7">W</a>; <span class="keywordflow">else</span> turn = <a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>;}</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordflow">else</span> {<span class="keywordflow">if</span> (ka[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>]==ka[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>]) turn = <a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>; <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ka[Y]==ka[Z]) turn = <a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>;}</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">if</span> (turn&gt;=0) {</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <a class="code" href="structQuat.html">Quat</a> qtoz, qp;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordtype">unsigned</span> neg[3], win;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordtype">double</span> mag[3], t;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keyword">static</span> <a class="code" href="structQuat.html">Quat</a> qxtoz = {0,<a class="code" href="Decompose_8cpp.html#abc0d7ca08089f78a080423c15de6c2fa">SQRTHALF</a>,0,<a class="code" href="Decompose_8cpp.html#abc0d7ca08089f78a080423c15de6c2fa">SQRTHALF</a>};</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keyword">static</span> <a class="code" href="structQuat.html">Quat</a> qytoz = {<a class="code" href="Decompose_8cpp.html#abc0d7ca08089f78a080423c15de6c2fa">SQRTHALF</a>,0,0,<a class="code" href="Decompose_8cpp.html#abc0d7ca08089f78a080423c15de6c2fa">SQRTHALF</a>};</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keyword">static</span> <a class="code" href="structQuat.html">Quat</a> qppmm = { 0.5, 0.5,-0.5,-0.5};</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keyword">static</span> <a class="code" href="structQuat.html">Quat</a> qpppp = { 0.5, 0.5, 0.5, 0.5};</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keyword">static</span> <a class="code" href="structQuat.html">Quat</a> qmpmm = {-0.5, 0.5,-0.5,-0.5};</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keyword">static</span> <a class="code" href="structQuat.html">Quat</a> qpppm = { 0.5, 0.5, 0.5,-0.5};</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keyword">static</span> <a class="code" href="structQuat.html">Quat</a> q0001 = { 0.0, 0.0, 0.0, 1.0};</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keyword">static</span> <a class="code" href="structQuat.html">Quat</a> q1000 = { 1.0, 0.0, 0.0, 0.0};</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordflow">switch</span> (turn) {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keywordflow">default</span>: <span class="keywordflow">return</span> (<a class="code" href="Decompose_8cpp.html#abb49adb3b77cb0e9a4be911e1e15f9f9">Qt_Conj</a>(q));</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>: q = <a class="code" href="Decompose_8cpp.html#ae2c61a5c8edc3f499553088f3011b932">Qt_Mul</a>(q, qtoz = qxtoz); <a class="code" href="Decompose_8cpp.html#afe418d2ee4c27f9916c687ebe48968bb">swap</a>(ka,<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>,<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">case</span> Y: q = <a class="code" href="Decompose_8cpp.html#ae2c61a5c8edc3f499553088f3011b932">Qt_Mul</a>(q, qtoz = qytoz); <a class="code" href="Decompose_8cpp.html#afe418d2ee4c27f9916c687ebe48968bb">swap</a>(ka,Y,<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>: qtoz = q0001; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    }</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    q = <a class="code" href="Decompose_8cpp.html#abb49adb3b77cb0e9a4be911e1e15f9f9">Qt_Conj</a>(q);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    mag[0] = (double)q.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>*q.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>+(<span class="keywordtype">double</span>)q.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a>*q.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a>-0.5;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    mag[1] = (double)q.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a>*q.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>-(<span class="keywordtype">double</span>)q.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a>*q.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a>;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    mag[2] = (double)q.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a>*q.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>+(<span class="keywordtype">double</span>)q.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a>*q.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a>;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;3; i++) <span class="keywordflow">if</span> ((neg[i] = (mag[i]&lt;0.0)) != 0) mag[i] = -mag[i];</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordflow">if</span> (mag[0]&gt;mag[1]) {<span class="keywordflow">if</span> (mag[0]&gt;mag[2]) win = 0; <span class="keywordflow">else</span> win = 2;}</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">else</span>           {<span class="keywordflow">if</span> (mag[1]&gt;mag[2]) win = 1; <span class="keywordflow">else</span> win = 2;}</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordflow">switch</span> (win) {</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keywordflow">case</span> 0: <span class="keywordflow">if</span> (neg[0]) p = q1000; <span class="keywordflow">else</span> p = q0001; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">case</span> 1: <span class="keywordflow">if</span> (neg[1]) p = qppmm; <span class="keywordflow">else</span> p = qpppp; <a class="code" href="Decompose_8cpp.html#a439791da41fdc56e3544e3012da5e78b">cycle</a>(ka,0) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keywordflow">case</span> 2: <span class="keywordflow">if</span> (neg[2]) p = qmpmm; <span class="keywordflow">else</span> p = qpppm; <a class="code" href="Decompose_8cpp.html#a439791da41fdc56e3544e3012da5e78b">cycle</a>(ka,1) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    qp = <a class="code" href="Decompose_8cpp.html#ae2c61a5c8edc3f499553088f3011b932">Qt_Mul</a>(q, p);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    t = sqrt(mag[win]+0.5);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    p = <a class="code" href="Decompose_8cpp.html#ae2c61a5c8edc3f499553088f3011b932">Qt_Mul</a>(p, <a class="code" href="Decompose_8cpp.html#afc58623ccd7f6293b73b9181b1c647da">Qt_</a>(0.0,0.0,-qp.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>/t,qp.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a>/t));</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    p = <a class="code" href="Decompose_8cpp.html#ae2c61a5c8edc3f499553088f3011b932">Qt_Mul</a>(qtoz, <a class="code" href="Decompose_8cpp.html#abb49adb3b77cb0e9a4be911e1e15f9f9">Qt_Conj</a>(p));</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordtype">float</span> qa[4], pa[4];</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keywordtype">unsigned</span> lo, hi, neg[4], par = 0;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordtype">double</span> all, big, two;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    qa[0] = q.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a>; qa[1] = q.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a>; qa[2] = q.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>; qa[3] = q.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a>;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;4; i++) {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        pa[i] = 0.0;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="keywordflow">if</span> ((neg[i] = (qa[i]&lt;0.0)) != 0) qa[i] = -qa[i];</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        par ^= neg[i];</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="comment">/* Find two largest components, indices in hi and lo */</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keywordflow">if</span> (qa[0]&gt;qa[1]) lo = 0; <span class="keywordflow">else</span> lo = 1;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">if</span> (qa[2]&gt;qa[3]) hi = 2; <span class="keywordflow">else</span> hi = 3;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">if</span> (qa[lo]&gt;qa[hi]) {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="keywordflow">if</span> (qa[lo^1]&gt;qa[hi]) {hi = lo; lo ^= 1;}</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="keywordflow">else</span> {hi ^= lo; lo ^= hi; hi ^= lo;}</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    } <span class="keywordflow">else</span> {<span class="keywordflow">if</span> (qa[hi^1]&gt;qa[lo]) lo = hi^1;}</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    all = (qa[0]+qa[1]+qa[2]+qa[3])*0.5;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    two = (qa[hi]+qa[lo])*<a class="code" href="Decompose_8cpp.html#abc0d7ca08089f78a080423c15de6c2fa">SQRTHALF</a>;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    big = qa[hi];</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordflow">if</span> (all&gt;two) {</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="keywordflow">if</span> (all&gt;big) {<span class="comment">/*all*/</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        {<span class="keywordtype">int</span> i; <span class="keywordflow">for</span> (i=0; i&lt;4; i++) pa[i] = <a class="code" href="Decompose_8cpp.html#a455057e8062f0978e7cfc4c88b244c82">sgn</a>(neg[i], 0.5);}</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <a class="code" href="Decompose_8cpp.html#a439791da41fdc56e3544e3012da5e78b">cycle</a>(ka,par)</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        } <span class="keywordflow">else</span> {<span class="comment">/*big*/</span> pa[hi] = <a class="code" href="Decompose_8cpp.html#a455057e8062f0978e7cfc4c88b244c82">sgn</a>(neg[hi],1.0);}</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <span class="keywordflow">if</span> (two&gt;big) {<span class="comment">/*two*/</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        pa[hi] = <a class="code" href="Decompose_8cpp.html#a455057e8062f0978e7cfc4c88b244c82">sgn</a>(neg[hi],<a class="code" href="Decompose_8cpp.html#abc0d7ca08089f78a080423c15de6c2fa">SQRTHALF</a>); pa[lo] = <a class="code" href="Decompose_8cpp.html#a455057e8062f0978e7cfc4c88b244c82">sgn</a>(neg[lo], <a class="code" href="Decompose_8cpp.html#abc0d7ca08089f78a080423c15de6c2fa">SQRTHALF</a>);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="keywordflow">if</span> (lo&gt;hi) {hi ^= lo; lo ^= hi; hi ^= lo;}</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="keywordflow">if</span> (hi==<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6ab722ceeb601c72cd78fbd35f3581fdf7">W</a>) {hi = <span class="stringliteral">&quot;\001\002\000&quot;</span>[lo]; lo = 3-hi-lo;}</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <a class="code" href="Decompose_8cpp.html#afe418d2ee4c27f9916c687ebe48968bb">swap</a>(ka,hi,lo)</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        } <span class="keywordflow">else</span> {<span class="comment">/*big*/</span> pa[hi] = <a class="code" href="Decompose_8cpp.html#a455057e8062f0978e7cfc4c88b244c82">sgn</a>(neg[hi],1.0);}</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    p.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a> = -pa[0]; p.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a> = -pa[1]; p.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a> = -pa[2]; p.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a> = pa[3];</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    }</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    k-&gt;<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a> = ka[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>]; k-&gt;<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a> = ka[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>]; k-&gt;<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a> = ka[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>];</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keywordflow">return</span> (p);</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;}</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">/******* Decompose Affine Matrix *******/</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">/* Decompose 4x4 affine matrix A as TFRUK(U transpose), where t contains the</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment"> * translation components, q contains the rotation R, u contains U, k contains</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment"> * scale factors, and f contains the sign of the determinant.</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment"> * Assumes A transforms column vectors in right-handed coordinates.</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment"> * See Ken Shoemake and Tom Duff. Matrix Animation and Polar Decomposition.</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment"> * Proceedings of Graphics Interface 1992.</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00486"></a><span class="lineno"><a class="line" href="Decompose_8h.html#adace46202324114c1ba8da2fa24b1bcd">  486</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="Decompose_8cpp.html#adace46202324114c1ba8da2fa24b1bcd">decomp_affine</a>(<a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> A, <a class="code" href="structAffineParts.html">AffineParts</a> *parts)</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;{</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <a class="code" href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a> Q, S, <a class="code" href="namespacex86__x64_1_1CPUID2.html#a3917d6143f871daa4671068a43e433c0a11be6f91f789b0949ac5b822708364b7">U</a>;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <a class="code" href="structQuat.html">Quat</a> p;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordtype">float</span> det;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    parts-&gt;<a class="code" href="structAffineParts.html#a397d129c9adceaa948e5906178248117">t</a> = <a class="code" href="Decompose_8cpp.html#afc58623ccd7f6293b73b9181b1c647da">Qt_</a>(A[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a>][<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6ab722ceeb601c72cd78fbd35f3581fdf7">W</a>], A[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a>][W], A[<a class="code" href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a>][W], 0);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    det = <a class="code" href="Decompose_8cpp.html#a5cdb5296d759c4c321d2a7ecf44a2aed">polar_decomp</a>(A, Q, S);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">if</span> (det&lt;0.0) {</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <a class="code" href="Decompose_8cpp.html#a0eb958b865b3083981030654274ce09e">mat_copy</a>(Q,=,-Q,3);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    parts-&gt;<a class="code" href="structAffineParts.html#a16a1fe95f523cd55504abbdb3e32b85f">f</a> = -1;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    } <span class="keywordflow">else</span> parts-&gt;<a class="code" href="structAffineParts.html#a16a1fe95f523cd55504abbdb3e32b85f">f</a> = 1;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    parts-&gt;<a class="code" href="structAffineParts.html#a6a17bd540d3805d50101f15780a153a8">q</a> = <a class="code" href="Decompose_8cpp.html#a1b7e3263125ead38d0c94c3158788a55">Qt_FromMatrix</a>(Q);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    parts-&gt;<a class="code" href="structAffineParts.html#ad8e58d53b4213e91ef0b1c47a1fcb18c">k</a> = <a class="code" href="Decompose_8cpp.html#a9988f0b6c5f665fd49841ab3be81e9e0">spect_decomp</a>(S, U);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    parts-&gt;<a class="code" href="structAffineParts.html#a48aa60a6e3ebef5d134f43da9af7066f">u</a> = <a class="code" href="Decompose_8cpp.html#a1b7e3263125ead38d0c94c3158788a55">Qt_FromMatrix</a>(U);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    p = <a class="code" href="Decompose_8cpp.html#aa02b9c79f6cd71904d06095e537f8b12">snuggle</a>(parts-&gt;<a class="code" href="structAffineParts.html#a48aa60a6e3ebef5d134f43da9af7066f">u</a>, &amp;parts-&gt;<a class="code" href="structAffineParts.html#ad8e58d53b4213e91ef0b1c47a1fcb18c">k</a>);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    parts-&gt;<a class="code" href="structAffineParts.html#a48aa60a6e3ebef5d134f43da9af7066f">u</a> = <a class="code" href="Decompose_8cpp.html#ae2c61a5c8edc3f499553088f3011b932">Qt_Mul</a>(parts-&gt;<a class="code" href="structAffineParts.html#a48aa60a6e3ebef5d134f43da9af7066f">u</a>, p);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;}</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">/******* Invert Affine Decomposition *******/</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">/* Compute inverse of affine decomposition.</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00508"></a><span class="lineno"><a class="line" href="Decompose_8h.html#adff8a2010ac88249259e5343de11ce7d">  508</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="Decompose_8cpp.html#adff8a2010ac88249259e5343de11ce7d">invert_affine</a>(<a class="code" href="structAffineParts.html">AffineParts</a> *parts, <a class="code" href="structAffineParts.html">AffineParts</a> *inverse)</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;{</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <a class="code" href="structQuat.html">Quat</a> t, p;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    inverse-&gt;<a class="code" href="structAffineParts.html#a16a1fe95f523cd55504abbdb3e32b85f">f</a> = parts-&gt;<a class="code" href="structAffineParts.html#a16a1fe95f523cd55504abbdb3e32b85f">f</a>;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    inverse-&gt;<a class="code" href="structAffineParts.html#a6a17bd540d3805d50101f15780a153a8">q</a> = <a class="code" href="Decompose_8cpp.html#abb49adb3b77cb0e9a4be911e1e15f9f9">Qt_Conj</a>(parts-&gt;<a class="code" href="structAffineParts.html#a6a17bd540d3805d50101f15780a153a8">q</a>);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    inverse-&gt;<a class="code" href="structAffineParts.html#a48aa60a6e3ebef5d134f43da9af7066f">u</a> = <a class="code" href="Decompose_8cpp.html#ae2c61a5c8edc3f499553088f3011b932">Qt_Mul</a>(parts-&gt;<a class="code" href="structAffineParts.html#a6a17bd540d3805d50101f15780a153a8">q</a>, parts-&gt;<a class="code" href="structAffineParts.html#a48aa60a6e3ebef5d134f43da9af7066f">u</a>);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    inverse-&gt;<a class="code" href="structAffineParts.html#ad8e58d53b4213e91ef0b1c47a1fcb18c">k</a>.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a> = (parts-&gt;<a class="code" href="structAffineParts.html#ad8e58d53b4213e91ef0b1c47a1fcb18c">k</a>.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a>==0.0) ? 0.0 : 1.0/parts-&gt;<a class="code" href="structAffineParts.html#ad8e58d53b4213e91ef0b1c47a1fcb18c">k</a>.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a>;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    inverse-&gt;<a class="code" href="structAffineParts.html#ad8e58d53b4213e91ef0b1c47a1fcb18c">k</a>.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a> = (parts-&gt;<a class="code" href="structAffineParts.html#ad8e58d53b4213e91ef0b1c47a1fcb18c">k</a>.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a>==0.0) ? 0.0 : 1.0/parts-&gt;<a class="code" href="structAffineParts.html#ad8e58d53b4213e91ef0b1c47a1fcb18c">k</a>.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a>;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    inverse-&gt;<a class="code" href="structAffineParts.html#ad8e58d53b4213e91ef0b1c47a1fcb18c">k</a>.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a> = (parts-&gt;<a class="code" href="structAffineParts.html#ad8e58d53b4213e91ef0b1c47a1fcb18c">k</a>.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>==0.0) ? 0.0 : 1.0/parts-&gt;<a class="code" href="structAffineParts.html#ad8e58d53b4213e91ef0b1c47a1fcb18c">k</a>.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    inverse-&gt;<a class="code" href="structAffineParts.html#ad8e58d53b4213e91ef0b1c47a1fcb18c">k</a>.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a> = parts-&gt;<a class="code" href="structAffineParts.html#ad8e58d53b4213e91ef0b1c47a1fcb18c">k</a>.<a class="code" href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">w</a>;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    t = <a class="code" href="Decompose_8cpp.html#afc58623ccd7f6293b73b9181b1c647da">Qt_</a>(-parts-&gt;<a class="code" href="structAffineParts.html#a397d129c9adceaa948e5906178248117">t</a>.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a>, -parts-&gt;<a class="code" href="structAffineParts.html#a397d129c9adceaa948e5906178248117">t</a>.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a>, -parts-&gt;<a class="code" href="structAffineParts.html#a397d129c9adceaa948e5906178248117">t</a>.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>, 0);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    t = <a class="code" href="Decompose_8cpp.html#ae2c61a5c8edc3f499553088f3011b932">Qt_Mul</a>(<a class="code" href="Decompose_8cpp.html#abb49adb3b77cb0e9a4be911e1e15f9f9">Qt_Conj</a>(inverse-&gt;<a class="code" href="structAffineParts.html#a48aa60a6e3ebef5d134f43da9af7066f">u</a>), <a class="code" href="Decompose_8cpp.html#ae2c61a5c8edc3f499553088f3011b932">Qt_Mul</a>(t, inverse-&gt;<a class="code" href="structAffineParts.html#a48aa60a6e3ebef5d134f43da9af7066f">u</a>));</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    t = <a class="code" href="Decompose_8cpp.html#afc58623ccd7f6293b73b9181b1c647da">Qt_</a>(inverse-&gt;<a class="code" href="structAffineParts.html#ad8e58d53b4213e91ef0b1c47a1fcb18c">k</a>.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a>*t.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a>, inverse-&gt;<a class="code" href="structAffineParts.html#ad8e58d53b4213e91ef0b1c47a1fcb18c">k</a>.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a>*t.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a>, inverse-&gt;<a class="code" href="structAffineParts.html#ad8e58d53b4213e91ef0b1c47a1fcb18c">k</a>.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>*t.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>, 0);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    p = <a class="code" href="Decompose_8cpp.html#ae2c61a5c8edc3f499553088f3011b932">Qt_Mul</a>(inverse-&gt;<a class="code" href="structAffineParts.html#a6a17bd540d3805d50101f15780a153a8">q</a>, inverse-&gt;<a class="code" href="structAffineParts.html#a48aa60a6e3ebef5d134f43da9af7066f">u</a>);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    t = <a class="code" href="Decompose_8cpp.html#ae2c61a5c8edc3f499553088f3011b932">Qt_Mul</a>(p, <a class="code" href="Decompose_8cpp.html#ae2c61a5c8edc3f499553088f3011b932">Qt_Mul</a>(t, <a class="code" href="Decompose_8cpp.html#abb49adb3b77cb0e9a4be911e1e15f9f9">Qt_Conj</a>(p)));</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    inverse-&gt;<a class="code" href="structAffineParts.html#a397d129c9adceaa948e5906178248117">t</a> = (inverse-&gt;<a class="code" href="structAffineParts.html#a16a1fe95f523cd55504abbdb3e32b85f">f</a>&gt;0.0) ? t : <a class="code" href="Decompose_8cpp.html#afc58623ccd7f6293b73b9181b1c647da">Qt_</a>(-t.<a class="code" href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">x</a>, -t.<a class="code" href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">y</a>, -t.<a class="code" href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">z</a>, 0);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;}</div>
<div class="ttc" id="structAffineParts_html_a48aa60a6e3ebef5d134f43da9af7066f"><div class="ttname"><a href="structAffineParts.html#a48aa60a6e3ebef5d134f43da9af7066f">AffineParts::u</a></div><div class="ttdeci">Quat u</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8h_source.html#l00028">Decompose.h:28</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_afefe0cd67712bd5ad28c11631d9c9301"><div class="ttname"><a href="Decompose_8cpp.html#afefe0cd67712bd5ad28c11631d9c9301">mat_binop</a></div><div class="ttdeci">#define mat_binop(C, gets, A, op, B, n)</div><div class="ttdoc">Assign nxn matrix C the element-wise combination of A and B using &amp;quot;op&amp;quot;. </div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00043">Decompose.cpp:43</a></div></div>
<div class="ttc" id="structQuat_html_a15db053bd6750a53e33bf30a0250c288"><div class="ttname"><a href="structQuat.html#a15db053bd6750a53e33bf30a0250c288">Quat::x</a></div><div class="ttdeci">float x</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8h_source.html#l00021">Decompose.h:21</a></div></div>
<div class="ttc" id="Decompose_8h_html_a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84"><div class="ttname"><a href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a5596231eabd6cf29050967d5ac83ad84">Y</a></div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8h_source.html#l00022">Decompose.h:22</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_a23d9f9add72e9530eda90fd602b96abf"><div class="ttname"><a href="Decompose_8cpp.html#a23d9f9add72e9530eda90fd602b96abf">find_max_col</a></div><div class="ttdeci">int find_max_col(HMatrix M)</div><div class="ttdoc">Return index of column of M containing maximum abs entry, or -1 if M=0. </div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00181">Decompose.cpp:181</a></div></div>
<div class="ttc" id="structAffineParts_html_ad8e58d53b4213e91ef0b1c47a1fcb18c"><div class="ttname"><a href="structAffineParts.html#ad8e58d53b4213e91ef0b1c47a1fcb18c">AffineParts::k</a></div><div class="ttdeci">HVect k</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8h_source.html#l00029">Decompose.h:29</a></div></div>
<div class="ttc" id="structQuat_html_a611fbb79f7b802da4f1c65a31c2c5fea"><div class="ttname"><a href="structQuat.html#a611fbb79f7b802da4f1c65a31c2c5fea">Quat::z</a></div><div class="ttdeci">float z</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8h_source.html#l00021">Decompose.h:21</a></div></div>
<div class="ttc" id="Decompose_8h_html_a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4"><div class="ttname"><a href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6a58833a3110c570fb05130d40c365d1e4">X</a></div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8h_source.html#l00022">Decompose.h:22</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_ae2c61a5c8edc3f499553088f3011b932"><div class="ttname"><a href="Decompose_8cpp.html#ae2c61a5c8edc3f499553088f3011b932">Qt_Mul</a></div><div class="ttdeci">Quat Qt_Mul(Quat qL, Quat qR)</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00097">Decompose.cpp:97</a></div></div>
<div class="ttc" id="structAffineParts_html_a397d129c9adceaa948e5906178248117"><div class="ttname"><a href="structAffineParts.html#a397d129c9adceaa948e5906178248117">AffineParts::t</a></div><div class="ttdeci">HVect t</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8h_source.html#l00026">Decompose.h:26</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_a2e8a58dabbe86bf9000fe3f1d10bad0e"><div class="ttname"><a href="Decompose_8cpp.html#a2e8a58dabbe86bf9000fe3f1d10bad0e">norm_one</a></div><div class="ttdeci">float norm_one(HMatrix M)</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00178">Decompose.cpp:178</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_a5cdb5296d759c4c321d2a7ecf44a2aed"><div class="ttname"><a href="Decompose_8cpp.html#a5cdb5296d759c4c321d2a7ecf44a2aed">polar_decomp</a></div><div class="ttdeci">float polar_decomp(HMatrix M, HMatrix Q, HMatrix S)</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00274">Decompose.cpp:274</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_af40876efd26b10d7e2171f1432bfb4bd"><div class="ttname"><a href="Decompose_8cpp.html#af40876efd26b10d7e2171f1432bfb4bd">adjoint_transpose</a></div><div class="ttdeci">void adjoint_transpose(HMatrix M, HMatrix MadjT)</div><div class="ttdoc">Set MadjT to transpose of inverse of M times determinant of M. </div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00069">Decompose.cpp:69</a></div></div>
<div class="ttc" id="Decompose_8h_html_a41b36dd8e8660c9616d9e19e9b828b38"><div class="ttname"><a href="Decompose_8h.html#a41b36dd8e8660c9616d9e19e9b828b38">HMatrix</a></div><div class="ttdeci">float HMatrix[4][4]</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8h_source.html#l00024">Decompose.h:24</a></div></div>
<div class="ttc" id="structAffineParts_html_a16a1fe95f523cd55504abbdb3e32b85f"><div class="ttname"><a href="structAffineParts.html#a16a1fe95f523cd55504abbdb3e32b85f">AffineParts::f</a></div><div class="ttdeci">float f</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8h_source.html#l00030">Decompose.h:30</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_a1946d69616189dfce2de28adcb58d58e"><div class="ttname"><a href="Decompose_8cpp.html#a1946d69616189dfce2de28adcb58d58e">vdot</a></div><div class="ttdeci">float vdot(float *va, float *vb)</div><div class="ttdoc">Return dot product of length 3 vectors va and vb. </div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00055">Decompose.cpp:55</a></div></div>
<div class="ttc" id="structQuat_html_ac6045ee4149a978a4ce429c132e46fa2"><div class="ttname"><a href="structQuat.html#ac6045ee4149a978a4ce429c132e46fa2">Quat::y</a></div><div class="ttdeci">float y</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8h_source.html#l00021">Decompose.h:21</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_a14951b3900fb3530b2f9d2752443d3f2"><div class="ttname"><a href="Decompose_8cpp.html#a14951b3900fb3530b2f9d2752443d3f2">mat_tpose</a></div><div class="ttdeci">#define mat_tpose(AT, gets, A, n)</div><div class="ttdoc">Copy transpose of nxn matrix A to C using &amp;quot;gets&amp;quot; for assignment. </div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00039">Decompose.cpp:39</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_a0eb958b865b3083981030654274ce09e"><div class="ttname"><a href="Decompose_8cpp.html#a0eb958b865b3083981030654274ce09e">mat_copy</a></div><div class="ttdeci">#define mat_copy(C, gets, A, n)</div><div class="ttdoc">Copy nxn matrix A to C using &amp;quot;gets&amp;quot; for assignment. </div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00035">Decompose.cpp:35</a></div></div>
<div class="ttc" id="Decompose_8h_html_a4bf755a23876ecc5d9b3897316b968e6ab722ceeb601c72cd78fbd35f3581fdf7"><div class="ttname"><a href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6ab722ceeb601c72cd78fbd35f3581fdf7">W</a></div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8h_source.html#l00022">Decompose.h:22</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_a881986a77d1ecf1bec09764c083e6b6c"><div class="ttname"><a href="Decompose_8cpp.html#a881986a77d1ecf1bec09764c083e6b6c">vcross</a></div><div class="ttdeci">void vcross(float *va, float *vb, float *v)</div><div class="ttdoc">Set v to cross product of length 3 vectors va and vb. </div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00061">Decompose.cpp:61</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_a680c8bc94fb11bd684b4edab2d6e48d3"><div class="ttname"><a href="Decompose_8cpp.html#a680c8bc94fb11bd684b4edab2d6e48d3">caseMacro</a></div><div class="ttdeci">#define caseMacro(i, j, k, I, J, K)</div></div>
<div class="ttc" id="Decompose_8cpp_html_adff8a2010ac88249259e5343de11ce7d"><div class="ttname"><a href="Decompose_8cpp.html#adff8a2010ac88249259e5343de11ce7d">invert_affine</a></div><div class="ttdeci">void invert_affine(AffineParts *parts, AffineParts *inverse)</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00508">Decompose.cpp:508</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_ae0fd5b60df7f2605802f9f26327c003d"><div class="ttname"><a href="Decompose_8cpp.html#ae0fd5b60df7f2605802f9f26327c003d">reflect_cols</a></div><div class="ttdeci">void reflect_cols(HMatrix M, float *u)</div><div class="ttdoc">Apply Householder reflection represented by u to column vectors of M. </div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00204">Decompose.cpp:204</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_ac8af7bb2cd4f6b977ccae650ac7d646c"><div class="ttname"><a href="Decompose_8cpp.html#ac8af7bb2cd4f6b977ccae650ac7d646c">do_rank2</a></div><div class="ttdeci">void do_rank2(HMatrix M, HMatrix MadjT, HMatrix Q)</div><div class="ttdoc">Find orthogonal factor Q of rank 2 (or less) M using adjoint transpose. </div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00241">Decompose.cpp:241</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_af168980514ee73c4970441bdcfe3e618"><div class="ttname"><a href="Decompose_8cpp.html#af168980514ee73c4970441bdcfe3e618">mat_id</a></div><div class="ttdeci">static HMatrix mat_id</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00161">Decompose.cpp:161</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_a1b7e3263125ead38d0c94c3158788a55"><div class="ttname"><a href="Decompose_8cpp.html#a1b7e3263125ead38d0c94c3158788a55">Qt_FromMatrix</a></div><div class="ttdeci">Quat Qt_FromMatrix(HMatrix mat)</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00119">Decompose.cpp:119</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_a08953def9317ac094b2cd0f4ab056706"><div class="ttname"><a href="Decompose_8cpp.html#a08953def9317ac094b2cd0f4ab056706">norm_inf</a></div><div class="ttdeci">float norm_inf(HMatrix M)</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00177">Decompose.cpp:177</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_a540588638fd235160a901ed086f399d0"><div class="ttname"><a href="Decompose_8cpp.html#a540588638fd235160a901ed086f399d0">reflect_rows</a></div><div class="ttdeci">void reflect_rows(HMatrix M, float *u)</div><div class="ttdoc">Apply Householder reflection represented by u to row vectors of M. </div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00213">Decompose.cpp:213</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_afc58623ccd7f6293b73b9181b1c647da"><div class="ttname"><a href="Decompose_8cpp.html#afc58623ccd7f6293b73b9181b1c647da">Qt_</a></div><div class="ttdeci">Quat Qt_(float x, float y, float z, float w)</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00079">Decompose.cpp:79</a></div></div>
<div class="ttc" id="structAffineParts_html_a6a17bd540d3805d50101f15780a153a8"><div class="ttname"><a href="structAffineParts.html#a6a17bd540d3805d50101f15780a153a8">AffineParts::q</a></div><div class="ttdeci">Quat q</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8h_source.html#l00027">Decompose.h:27</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_a9988f0b6c5f665fd49841ab3be81e9e0"><div class="ttname"><a href="Decompose_8cpp.html#a9988f0b6c5f665fd49841ab3be81e9e0">spect_decomp</a></div><div class="ttdeci">HVect spect_decomp(HMatrix S, HMatrix U)</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00326">Decompose.cpp:326</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_a999000523190d36c73eea7b882e8c36c"><div class="ttname"><a href="Decompose_8cpp.html#a999000523190d36c73eea7b882e8c36c">mat_mult</a></div><div class="ttdeci">void mat_mult(HMatrix A, HMatrix B, HMatrix AB)</div><div class="ttdoc">Multiply the upper left 3x3 parts of A and B to get AB. </div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00047">Decompose.cpp:47</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_abb49adb3b77cb0e9a4be911e1e15f9f9"><div class="ttname"><a href="Decompose_8cpp.html#abb49adb3b77cb0e9a4be911e1e15f9f9">Qt_Conj</a></div><div class="ttdeci">Quat Qt_Conj(Quat q)</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00087">Decompose.cpp:87</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_abfdeef77067f50404058e591a757fe5d"><div class="ttname"><a href="Decompose_8cpp.html#abfdeef77067f50404058e591a757fe5d">make_reflector</a></div><div class="ttdeci">void make_reflector(float *v, float *u)</div><div class="ttdoc">Setup u for Household reflection to zero all v components but first. </div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00194">Decompose.cpp:194</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_a156b862ebf6d213f5da19b9e3ccb779e"><div class="ttname"><a href="Decompose_8cpp.html#a156b862ebf6d213f5da19b9e3ccb779e">TOL</a></div><div class="ttdeci">#define TOL</div></div>
<div class="ttc" id="Decompose_8cpp_html_abc0d7ca08089f78a080423c15de6c2fa"><div class="ttname"><a href="Decompose_8cpp.html#abc0d7ca08089f78a080423c15de6c2fa">SQRTHALF</a></div><div class="ttdeci">#define SQRTHALF</div></div>
<div class="ttc" id="Decompose_8cpp_html_aa02b9c79f6cd71904d06095e537f8b12"><div class="ttname"><a href="Decompose_8cpp.html#aa02b9c79f6cd71904d06095e537f8b12">snuggle</a></div><div class="ttdeci">Quat snuggle(Quat q, HVect *k)</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00381">Decompose.cpp:381</a></div></div>
<div class="ttc" id="structQuat_html_ad3aeee2134443ec0897793834209b0c0"><div class="ttname"><a href="structQuat.html#ad3aeee2134443ec0897793834209b0c0">Quat::w</a></div><div class="ttdeci">float w</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8h_source.html#l00021">Decompose.h:21</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_adace46202324114c1ba8da2fa24b1bcd"><div class="ttname"><a href="Decompose_8cpp.html#adace46202324114c1ba8da2fa24b1bcd">decomp_affine</a></div><div class="ttdeci">void decomp_affine(HMatrix A, AffineParts *parts)</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00486">Decompose.cpp:486</a></div></div>
<div class="ttc" id="Decompose_8h_html_a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355"><div class="ttname"><a href="Decompose_8h.html#a4bf755a23876ecc5d9b3897316b968e6aa70478ce277ffc322f8e1e3418e07355">Z</a></div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8h_source.html#l00022">Decompose.h:22</a></div></div>
<div class="ttc" id="structQuat_html"><div class="ttname"><a href="structQuat.html">Quat</a></div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8h_source.html#l00021">Decompose.h:21</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_a455057e8062f0978e7cfc4c88b244c82"><div class="ttname"><a href="Decompose_8cpp.html#a455057e8062f0978e7cfc4c88b244c82">sgn</a></div><div class="ttdeci">#define sgn(n, v)</div></div>
<div class="ttc" id="Decompose_8h_html"><div class="ttname"><a href="Decompose_8h.html">Decompose.h</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_a6e77b46d645e6a6866c3260d7389976a"><div class="ttname"><a href="Decompose_8cpp.html#a6e77b46d645e6a6866c3260d7389976a">mat_pad</a></div><div class="ttdeci">#define mat_pad(A)</div><div class="ttdoc">Fill out 3x3 matrix to 4x4. </div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00032">Decompose.cpp:32</a></div></div>
<div class="ttc" id="namespacex86__x64_1_1CPUID2_html_a3917d6143f871daa4671068a43e433c0a11be6f91f789b0949ac5b822708364b7"><div class="ttname"><a href="namespacex86__x64_1_1CPUID2.html#a3917d6143f871daa4671068a43e433c0a11be6f91f789b0949ac5b822708364b7">x86_x64::CPUID2::U</a></div><div class="ttdef"><b>Definition:</b> <a href="cache_8cpp_source.html#l00318">cache.cpp:318</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_a449765b0cc04a4d3392bf94d1b8b0a59"><div class="ttname"><a href="Decompose_8cpp.html#a449765b0cc04a4d3392bf94d1b8b0a59">Qt_Scale</a></div><div class="ttdeci">Quat Qt_Scale(Quat q, float w)</div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00108">Decompose.cpp:108</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_afe418d2ee4c27f9916c687ebe48968bb"><div class="ttname"><a href="Decompose_8cpp.html#afe418d2ee4c27f9916c687ebe48968bb">swap</a></div><div class="ttdeci">#define swap(a, i, j)</div></div>
<div class="ttc" id="collada_2precompiled_8h_html"><div class="ttname"><a href="collada_2precompiled_8h.html">precompiled.h</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_ac6ccf9784e5440507d88f82d056a29ea"><div class="ttname"><a href="Decompose_8cpp.html#ac6ccf9784e5440507d88f82d056a29ea">mat_norm</a></div><div class="ttdeci">float mat_norm(HMatrix M, int tpose)</div><div class="ttdoc">Compute either the 1 or infinity norm of M, depending on tpose. </div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00164">Decompose.cpp:164</a></div></div>
<div class="ttc" id="Decompose_8cpp_html_a439791da41fdc56e3544e3012da5e78b"><div class="ttname"><a href="Decompose_8cpp.html#a439791da41fdc56e3544e3012da5e78b">cycle</a></div><div class="ttdeci">#define cycle(a, p)</div></div>
<div class="ttc" id="Decompose_8cpp_html_a5a50ee36aa24c17675db41e72e2c7375"><div class="ttname"><a href="Decompose_8cpp.html#a5a50ee36aa24c17675db41e72e2c7375">do_rank1</a></div><div class="ttdeci">void do_rank1(HMatrix M, HMatrix Q)</div><div class="ttdoc">Find orthogonal factor Q of rank 1 (or less) M. </div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8cpp_source.html#l00223">Decompose.cpp:223</a></div></div>
<div class="ttc" id="structAffineParts_html"><div class="ttname"><a href="structAffineParts.html">AffineParts</a></div><div class="ttdef"><b>Definition:</b> <a href="Decompose_8h_source.html#l00025">Decompose.h:25</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Oct 14 2013 00:58:06 for Pyrogenesis by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
