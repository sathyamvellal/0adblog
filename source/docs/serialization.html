<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Pyrogenesis: Component serialization</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Pyrogenesis
   &#160;<span id="projectnumber">13997</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Component serialization </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page gives a high-level description of <a class="el" href="classISerializer.html" title="Serialization interface; see serialization overview. ">ISerializer</a> and <a class="el" href="classIDeserializer.html" title="Deserialization interface; see serialization overview. ">IDeserializer</a>.</p>
<h1><a class="anchor" id="design"></a>
Rough design notes</h1>
<p>We want to handle the following serialization-related features:</p>
<ul>
<li>Out-of-sync detection: Based on hash of simulation state. Must be fast.</li>
<li>Debugging OOS failures: Human-readable output of simulation state, that can be diffed against other states.</li>
<li>Saving and loading games to disk: Machine-readable output of state. Should remain usable after patches to the game.</li>
<li>Joining in-progress network games: Machine-readable output of state. Must be compact (minimise network traffic). Must be secure (no remote code execution from invalid network data).</li>
</ul>
<p>All cases must be portable across OSes, CPU architectures (endianness, bitness), compilers, compiler settings, etc.</p>
<p>This is designed for serializing components, which we consider to have three main kinds of state:</p>
<ul>
<li>Basic deterministic state: Stuff that's critical to the simulation state, and is identical between all players in a network game. Always needs to be saved and loaded and hashed and dumped etc.</li>
<li>Derived deterministic state: Stuff that can be identically recomputed from the basic deterministic state, but typically is stored in memory as an optimisation (e.g. caches). Shouldn't be saved to disk/network (to save space), and should be recomputed on loading. Should be included in hashes and debug dumps, to detect errors sooner.</li>
<li>Non-deterministic state: Stuff that's not part of the simulation state, and may vary between players in a network game, but is kept for graphics or for optimisations etc. Shouldn't be saved or hashed or dumped or anything.</li>
</ul>
<p>(TODO: Versioning (for saved games to survive patches) is not yet implemented.)</p>
<p>We have separate serialization and deserialization APIs (thus requiring components to implement separate serialize/deserialize functions), rather than a single unified API (that can either serialize or deserialize depending on the particular instance). This means more work for simple components, but it simplifies complex components (those which have versioning, or recompute derived state) since they don't need lots of "if (IsDeserializing()) ..." checks.</p>
<p>Callers must use the same sequence of <a class="el" href="classIDeserializer.html" title="Deserialization interface; see serialization overview. ">IDeserializer</a> calls as they used <a class="el" href="classISerializer.html" title="Serialization interface; see serialization overview. ">ISerializer</a> calls. For efficiency, serializations typically don't encode the data type, and so mismatches will make them read bogus values and hopefully hit an out-of-bounds exception.</p>
<p>The <a class="el" href="classISerializable.html" title="An interface for serializable objects. ">ISerializable</a> interface used by some code in the engine is irrelevant here. Serialization of interesting classes is implemented in this module, not in the classes themselves, so that the serialization system has greater control (e.g. the human-readable debug output can handle classes very differently to binary output).</p>
<p>To encourage portability, only fixed-size types are exposed in the API (e.g. int32_t, not int). Components should use fixed-size types internally, to ensure deterministic simulation across 32-bit and 64-bit architectures.</p>
<p>TODO: At least some compound types like lists ought to be supported somehow.</p>
<p>To encourage security, the API accepts bounds on numbers and string lengths etc, and will fail if the data exceeds the bounds. Callers should provide sensible bounds (they must never be exceeded, but the caller should be able to safely cope with any values within the bounds and not crash or run out of memory etc).</p>
<p>For the OOS debugging output, the API requires field names for all values. These are only used for human-readable output, so they should be readable but don't have to be unique or follow any particular pattern.</p>
<p>The APIs throw exceptions whenever something fails (all errors are fatal). Component (de)serialization functions must be exception-safe. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Oct 14 2013 00:58:11 for Pyrogenesis by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
